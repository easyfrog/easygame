"use strict";THREE.GLNode=function(a){this.uuid=THREE.Math.generateUUID(),this.allow={},this.requestUpdate=!1,this.type=a},THREE.GLNode.prototype.verify=function(a,b,c){a.isVerify=!0;var d=a.material;this.build(a.addCache(b,c),"v4"),d.clearVertexNode(),d.clearFragmentNode(),a.removeCache(),a.isVerify=!1},THREE.GLNode.prototype.verifyAndBuildCode=function(a,b,c,d){return this.verify(a,c,d),this.buildCode(a,b,c,d)},THREE.GLNode.prototype.buildCode=function(a,b,c,d){var e=a.material,f={result:this.build(a.addCache(c,d),b)};return a.isShader("vertex")?f.code=e.clearVertexNode():f.code=e.clearFragmentNode(),a.removeCache(),f},THREE.GLNode.prototype.verifyDepsNode=function(a,b,c){b.deps=(b.deps||0)+1;var d=a.getFormatLength(c);(d>(b.outputMax||0)||this.getType(a))&&(b.outputMax=d,b.output=c)},THREE.GLNode.prototype.build=function(a,b,c){var d=a.material,e=d.getDataNode(c||this.uuid);if(a.isShader("verify")&&this.verifyDepsNode(a,e,b),this.allow[a.shader]===!1)throw new Error("Shader "+shader+" is not compatible with this node.");return this.requestUpdate&&!e.requestUpdate&&(d.requestUpdate.push(this),e.requestUpdate=!0),this.generate(a,b,c)},THREE.GLNode.prototype.getType=function(a){return this.type},THREE.PhongNode=function(){THREE.GLNode.call(this),this.color=new THREE.ColorNode(15658734),this.specular=new THREE.ColorNode(1118481),this.shininess=new THREE.FloatNode(30)},THREE.PhongNode.prototype=Object.create(THREE.GLNode.prototype),THREE.PhongNode.prototype.constructor=THREE.PhongNode,THREE.PhongNode.prototype.build=function(a){var b,c=a.material;if(c.define("PHONG"),c.define("ALPHATEST","0.0"),c.requestAttrib.light=!0,a.isShader("vertex")){var d=this.transform?this.transform.verifyAndBuildCode(a,"v3","transform"):void 0;c.mergeUniform(THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights])),c.addVertexPars(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","	varying vec3 vNormal;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex].join("\n"));var e=[THREE.ShaderChunk.beginnormal_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"#ifndef FLAT_SHADED","	vNormal = normalize( transformedNormal );","#endif",THREE.ShaderChunk.begin_vertex];d&&e.push(d.code,"transformed = "+d.result+";"),e.push(THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"	vViewPosition = - mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex),b=e.join("\n")}else{this.color.verify(a),this.specular.verify(a),this.shininess.verify(a),this.alpha&&this.alpha.verify(a),this.light&&this.light.verify(a,"light"),this.ao&&this.ao.verify(a),this.ambient&&this.ambient.verify(a),this.shadow&&this.shadow.verify(a),this.emissive&&this.emissive.verify(a),this.normal&&this.normal.verify(a),this.normalScale&&this.normal&&this.normalScale.verify(a),this.environment&&this.environment.verify(a),this.environmentAlpha&&this.environment&&this.environmentAlpha.verify(a);var f=this.color.buildCode(a,"c"),g=this.specular.buildCode(a,"c"),h=this.shininess.buildCode(a,"fv1"),i=this.alpha?this.alpha.buildCode(a,"fv1"):void 0,j=this.light?this.light.buildCode(a,"v3","light"):void 0,k=this.ao?this.ao.buildCode(a,"fv1"):void 0,l=this.ambient?this.ambient.buildCode(a,"c"):void 0,m=this.shadow?this.shadow.buildCode(a,"c"):void 0,n=this.emissive?this.emissive.buildCode(a,"c"):void 0,o=this.normal?this.normal.buildCode(a,"v3"):void 0,p=this.normalScale&&this.normal?this.normalScale.buildCode(a,"v2"):void 0,q=this.environment?this.environment.buildCode(a,"c"):void 0,r=this.environmentAlpha&&this.environment?this.environmentAlpha.buildCode(a,"fv1"):void 0;c.requestAttrib.transparent=void 0!=i,c.addFragmentPars([THREE.ShaderChunk.common,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.bsdfs,THREE.ShaderChunk.lights_pars,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment].join("\n"));var e=[THREE.ShaderChunk.normal_fragment,"	BlinnPhongMaterial material;",f.code,"	vec3 diffuseColor = "+f.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",THREE.ShaderChunk.logdepthbuf_fragment,g.code,"	vec3 specular = "+g.result+";",h.code,"	float shininess = max(0.0001,"+h.result+");","	float specularStrength = 1.0;"];i&&e.push(i.code,"if ( "+i.result+" <= ALPHATEST ) discard;"),o&&(a.include("perturbNormal2Arb"),e.push(o.code),p&&e.push(p.code),e.push("normal = perturbNormal2Arb(-vViewPosition,normal,"+o.result+","+(new THREE.UVNode).build(a,"v2")+","+(p?p.result:"vec2( 1.0 )")+");")),e.push("material.diffuseColor = "+(j?"vec3( 1.0 )":"diffuseColor")+";"),e.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;",THREE.ShaderChunk.lights_template),j&&(e.push(j.code,"reflectedLight.directDiffuse = "+j.result+";"),e.push("reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),k&&e.push(k.code,"reflectedLight.indirectDiffuse *= "+k.result+";"),l&&e.push(l.code,"reflectedLight.indirectDiffuse += "+l.result+";"),m&&e.push(m.code,"reflectedLight.directDiffuse *= "+m.result+";","reflectedLight.directSpecular *= "+m.result+";"),n&&e.push(n.code,"reflectedLight.directDiffuse += "+n.result+";"),e.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;"),q&&(e.push(q.code),r?e.push(r.code,"outgoingLight = mix(outgoingLight,"+q.result+","+r.result+");"):e.push("outgoingLight = "+q.result+";")),e.push(THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment),i?e.push("gl_FragColor = vec4( outgoingLight, "+i.result+" );"):e.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),b=e.join("\n")}return b},THREE.NodeMaterial=function(a,b){THREE.ShaderMaterial.call(this),this.vertex=a||new THREE.RawNode(new THREE.PositionNode(THREE.PositionNode.PROJECTION)),this.fragment=b||new THREE.RawNode(new THREE.ColorNode(16711680))},THREE.NodeMaterial.types={t:"sampler2D",tc:"samplerCube",bv1:"bool",iv1:"int",fv1:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m4:"mat4"},THREE.NodeMaterial.addShortcuts=function(a,b,c){function d(a,b){return{get:function(){return this[a][b]},set:function(c){this[a][b]=c}}}return function(){for(var e={},f=0;f<c.length;++f){var g=c[f];e[g]=d(b,g)}Object.defineProperties(a,e)}()},THREE.NodeMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype),THREE.NodeMaterial.prototype.constructor=THREE.NodeMaterial,THREE.NodeMaterial.prototype.updateAnimation=function(a){for(var b=0;b<this.requestUpdate.length;++b)this.requestUpdate[b].updateAnimation(a)},THREE.NodeMaterial.prototype.build=function(){var a,b;this.defines={},this.uniforms={},this.nodeData={},this.vertexUniform=[],this.fragmentUniform=[],this.vertexTemps=[],this.fragmentTemps=[],this.uniformList=[],this.consts=[],this.functions=[],this.requestUpdate=[],this.requestAttrib={uv:[],color:[]},this.vertexPars="",this.fragmentPars="",this.vertexCode="",this.fragmentCode="",this.vertexNode="",this.fragmentNode="",this.prefixCode=["#ifdef GL_EXT_shader_texture_lod","#define texCube(a, b) textureCube(a, b)","#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","#define tex2D(a, b) texture2D(a, b)","#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","#define texCube(a, b) textureCube(a, b)","#define texCubeBias(a, b, c) textureCube(a, b, c)","#define tex2D(a, b) texture2D(a, b)","#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif"].join("\n");var c=new THREE.BuilderNode(this);return a=this.vertex.build(c.setShader("vertex"),"v4"),b=this.fragment.build(c.setShader("fragment"),"v4"),this.requestAttrib.uv[0]&&(this.addVertexPars("varying vec2 vUv;"),this.addFragmentPars("varying vec2 vUv;"),this.addVertexCode("vUv = uv;")),this.requestAttrib.uv[1]&&(this.addVertexPars("varying vec2 vUv2; attribute vec2 uv2;"),this.addFragmentPars("varying vec2 vUv2;"),this.addVertexCode("vUv2 = uv2;")),this.requestAttrib.color[0]&&(this.addVertexPars("varying vec4 vColor; attribute vec4 color;"),this.addFragmentPars("varying vec4 vColor;"),this.addVertexCode("vColor = color;")),this.requestAttrib.color[1]&&(this.addVertexPars("varying vec4 vColor2; attribute vec4 color2;"),this.addFragmentPars("varying vec4 vColor2;"),this.addVertexCode("vColor2 = color2;")),this.requestAttrib.position&&(this.addVertexPars("varying vec3 vPosition;"),this.addFragmentPars("varying vec3 vPosition;"),this.addVertexCode("vPosition = transformed;")),this.requestAttrib.worldPosition&&(this.addVertexPars("varying vec3 vWPosition;"),this.addFragmentPars("varying vec3 vWPosition;"),this.addVertexCode("vWPosition = worldPosition.xyz;")),this.requestAttrib.normal&&(this.addVertexPars("varying vec3 vObjectNormal;"),this.addFragmentPars("varying vec3 vObjectNormal;"),this.addVertexCode("vObjectNormal = normal;")),this.requestAttrib.worldNormal&&(this.addVertexPars("varying vec3 vWNormal;"),this.addFragmentPars("varying vec3 vWNormal;"),this.addVertexCode("vWNormal = ( modelMatrix * vec4( objectNormal, 0.0 ) ).xyz;")),this.lights=this.requestAttrib.light,this.transparent=this.requestAttrib.transparent,this.vertexShader=[this.prefixCode,this.vertexPars,this.getCodePars(this.vertexUniform,"uniform"),this.getIncludes(this.consts.vertex),this.getIncludes(this.functions.vertex),"void main(){",this.getCodePars(this.vertexTemps),a,this.vertexCode,"}"].join("\n"),this.fragmentShader=[this.prefixCode,this.fragmentPars,this.getCodePars(this.fragmentUniform,"uniform"),this.getIncludes(this.consts.fragment),this.getIncludes(this.functions.fragment),"void main(){",this.getCodePars(this.fragmentTemps),this.fragmentCode,b,"}"].join("\n"),this.needsUpdate=!0,this.dispose(),this},THREE.NodeMaterial.prototype.define=function(a,b){this.defines[a]=void 0==b?1:b},THREE.NodeMaterial.prototype.isDefined=function(a){return void 0!=this.defines[a]},THREE.NodeMaterial.prototype.mergeUniform=function(a){for(var b in a)this.uniforms[b]=a[b]},THREE.NodeMaterial.prototype.createUniform=function(a,b,c,d){var e=this.uniformList.length,f={type:a,value:b,name:c?c:"nVu"+e,needsUpdate:d};return this.uniformList.push(f),f},THREE.NodeMaterial.prototype.getVertexTemp=function(a,b,c){if(!this.vertexTemps[a]){var d=this.vertexTemps.length,e=c?c:"nVt"+d,f={name:e,type:b};this.vertexTemps.push(f),this.vertexTemps[a]=f}return this.vertexTemps[a]},THREE.NodeMaterial.prototype.getFragmentTemp=function(a,b,c){if(!this.fragmentTemps[a]){var d=this.fragmentTemps.length,e=c?c:"nVt"+d,f={name:e,type:b};this.fragmentTemps.push(f),this.fragmentTemps[a]=f}return this.fragmentTemps[a]},THREE.NodeMaterial.prototype.getIncludes=function(a){function b(a,b){return b.deps-a.deps}return function(a){if(!a)return"";for(var c="",a=a.sort(b),d=0;d<a.length;d++)c+=a[d].node.src+"\n";return c}}(),THREE.NodeMaterial.prototype.addVertexPars=function(a){this.vertexPars+=a+"\n"},THREE.NodeMaterial.prototype.addFragmentPars=function(a){this.fragmentPars+=a+"\n"},THREE.NodeMaterial.prototype.addVertexCode=function(a){this.vertexCode+=a+"\n"},THREE.NodeMaterial.prototype.addFragmentCode=function(a){this.fragmentCode+=a+"\n"},THREE.NodeMaterial.prototype.addVertexNode=function(a){this.vertexNode+=a+"\n"},THREE.NodeMaterial.prototype.clearVertexNode=function(){var a=this.fragmentNode;return this.fragmentNode="",a},THREE.NodeMaterial.prototype.addFragmentNode=function(a){this.fragmentNode+=a+"\n"},THREE.NodeMaterial.prototype.clearFragmentNode=function(){var a=this.fragmentNode;return this.fragmentNode="",a},THREE.NodeMaterial.prototype.getCodePars=function(a,b){b=b||"";for(var c="",d=0,e=a.length;e>d;++d){var f=a[d].type,g=a[d].name,h=a[d].value;"t"==f&&h instanceof THREE.CubeTexture&&(f="tc");var i=THREE.NodeMaterial.types[f];if(void 0==i)throw new Error("Node pars "+f+" not found.");c+=b+" "+i+" "+g+";\n"}return c},THREE.NodeMaterial.prototype.createVertexUniform=function(a,b,c,d){var e=this.createUniform(a,b,c,d);return this.vertexUniform.push(e),this.vertexUniform[e.name]=e,this.uniforms[e.name]=e,e},THREE.NodeMaterial.prototype.createFragmentUniform=function(a,b,c,d){var e=this.createUniform(a,b,c,d);return this.fragmentUniform.push(e),this.fragmentUniform[e.name]=e,this.uniforms[e.name]=e,e},THREE.NodeMaterial.prototype.getDataNode=function(a){return this.nodeData[a]=this.nodeData[a]||{}},THREE.NodeMaterial.prototype.include=function(a,b){var c;if(b="string"==typeof b?THREE.NodeLib.get(b):b,b instanceof THREE.FunctionNode){for(var d=0;d<b.includes.length;d++)this.include(a,b.includes[d]);c=this.functions[a]=this.functions[a]||[]}else b instanceof THREE.ConstNode&&(c=this.consts[a]=this.consts[a]||[]);if(void 0===c[b.name]){for(var e in b.extensions)this.extensions[e]=!0;c[b.name]={node:b,deps:1},c.push(c[b.name])}else++c[b.name].deps},THREE.PhongNodeMaterial=function(){this.node=new THREE.PhongNode,THREE.NodeMaterial.call(this,this.node,this.node)},THREE.PhongNodeMaterial.prototype=Object.create(THREE.NodeMaterial.prototype),THREE.PhongNodeMaterial.prototype.constructor=THREE.PhongNodeMaterial,THREE.NodeMaterial.addShortcuts(THREE.PhongNodeMaterial.prototype,"node",["color","alpha","specular","shininess","normal","normalScale","emissive","ambient","light","shadow","ao","environment","environmentAlpha","transform"]),THREE.StandardNode=function(){THREE.GLNode.call(this),this.color=new THREE.ColorNode(15658734),this.roughness=new THREE.FloatNode(.5),this.metalness=new THREE.FloatNode(.5)},THREE.StandardNode.prototype=Object.create(THREE.GLNode.prototype),THREE.StandardNode.prototype.constructor=THREE.StandardNode,THREE.StandardNode.prototype.build=function(a){var b,c=a.material;if(c.define("STANDARD"),c.define("ALPHATEST","0.0"),c.requestAttrib.light=!0,a.isShader("vertex")){var d=this.transform?this.transform.verifyAndBuildCode(a,"v3","transform"):void 0;c.mergeUniform(THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights])),c.addVertexPars(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","	varying vec3 vNormal;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex].join("\n"));var e=[THREE.ShaderChunk.beginnormal_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"#ifndef FLAT_SHADED","	vNormal = normalize( transformedNormal );","#endif",THREE.ShaderChunk.begin_vertex];d&&e.push(d.code,"transformed = "+d.result+";"),e.push(THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"	vViewPosition = - mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex),b=e.join("\n")}else{var f={bias:new THREE.RoughnessToBlinnExponentNode};this.color.verify(a),this.roughness.verify(a),this.metalness.verify(a),this.alpha&&this.alpha.verify(a),this.light&&this.light.verify(a,"light"),this.ao&&this.ao.verify(a),this.ambient&&this.ambient.verify(a),this.shadow&&this.shadow.verify(a),this.emissive&&this.emissive.verify(a),this.normal&&this.normal.verify(a),this.normalScale&&this.normal&&this.normalScale.verify(a),this.environment&&this.environment.verify(a,"env",f);var g=this.color.buildCode(a,"c"),h=this.roughness.buildCode(a,"fv1"),i=this.metalness.buildCode(a,"fv1"),j=this.alpha?this.alpha.buildCode(a,"fv1"):void 0,k=this.light?this.light.buildCode(a,"v3","light"):void 0,l=this.ao?this.ao.buildCode(a,"fv1"):void 0,m=this.ambient?this.ambient.buildCode(a,"c"):void 0,n=this.shadow?this.shadow.buildCode(a,"c"):void 0,o=this.emissive?this.emissive.buildCode(a,"c"):void 0,p=this.normal?this.normal.buildCode(a,"v3"):void 0,q=this.normalScale&&this.normal?this.normalScale.buildCode(a,"v2"):void 0,r=this.environment?this.environment.buildCode(a,"c","env",f):void 0;c.requestAttrib.transparent=void 0!=j,c.addFragmentPars(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","	varying vec3 vNormal;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.bsdfs,THREE.ShaderChunk.lights_pars,THREE.ShaderChunk.lights_physical_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment].join("\n"));var e=[THREE.ShaderChunk.normal_fragment,"	PhysicalMaterial material;","	material.diffuseColor = vec3( 1.0 );",g.code,"	vec3 diffuseColor = "+g.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",THREE.ShaderChunk.logdepthbuf_fragment,h.code,"	float roughnessFactor = "+h.result+";",i.code,"	float metalnessFactor = "+i.result+";"];j&&e.push(j.code,"if ( "+j.result+" <= ALPHATEST ) discard;"),p&&(a.include("perturbNormal2Arb"),e.push(p.code),q&&e.push(q.code),e.push("normal = perturbNormal2Arb(-vViewPosition,normal,"+p.result+","+(new THREE.UVNode).build(a,"v2")+","+(q?q.result:"vec2( 1.0 )")+");")),e.push("material.diffuseColor = "+(k?"vec3( 1.0 )":"diffuseColor * (1.0 - metalnessFactor)")+";"),e.push("material.specularRoughness = clamp( roughnessFactor, 0.001, 1.0 );","material.specularColor = mix( vec3( 0.001 ), diffuseColor, metalnessFactor );",THREE.ShaderChunk.lights_template),k&&(e.push(k.code,"reflectedLight.directDiffuse = "+k.result+";"),e.push("diffuseColor *= 1.0 - metalnessFactor;","reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),l&&e.push(l.code,"reflectedLight.indirectDiffuse *= "+l.result+";"),m&&e.push(m.code,"reflectedLight.indirectDiffuse += "+m.result+";"),n&&e.push(n.code,"reflectedLight.directDiffuse *= "+n.result+";","reflectedLight.directSpecular *= "+n.result+";"),o&&e.push(o.code,"reflectedLight.directDiffuse += "+o.result+";"),r&&e.push(r.code,"RE_IndirectSpecular("+r.result+", geometry, material, reflectedLight );"),e.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;"),e.push(THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment),j?e.push("gl_FragColor = vec4( outgoingLight, "+j.result+" );"):e.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),b=e.join("\n")}return b},THREE.StandardNodeMaterial=function(){this.node=new THREE.StandardNode,THREE.NodeMaterial.call(this,this.node,this.node)},THREE.StandardNodeMaterial.prototype=Object.create(THREE.NodeMaterial.prototype),THREE.StandardNodeMaterial.prototype.constructor=THREE.StandardNodeMaterial,THREE.NodeMaterial.addShortcuts(THREE.StandardNodeMaterial.prototype,"node",["color","alpha","roughness","metalness","normal","normalScale","emissive","ambient","light","shadow","ao","environment","transform"]),THREE.TempNode=function(a,b){THREE.GLNode.call(this,a),b=b||{},this.shared=void 0!==b.shared?b.shared:!0,this.unique=void 0!==b.unique?b.unique:!1},THREE.TempNode.prototype=Object.create(THREE.GLNode.prototype),THREE.TempNode.prototype.constructor=THREE.TempNode,THREE.TempNode.prototype.build=function(a,b,c,d){var e=a.material;if(this.isShared()){var f=this.isUnique();f&&void 0===this.constructor.uuid&&(this.constructor.uuid=THREE.Math.generateUUID()),c=a.getUuid(c||this.getUuid(),!f);var g=e.getDataNode(c);if(a.isShader("verify"))return g.deps?(this.verifyDepsNode(a,g,b),""):THREE.GLNode.prototype.build.call(this,a,b,c);if(1==g.deps)return THREE.GLNode.prototype.build.call(this,a,b,c);var h=this.getTemp(a,c),i=g.output||this.getType(a);if(h)return a.format(h,i,b);h=THREE.TempNode.prototype.generate.call(this,a,b,c,g.output,d);var j=this.generate(a,i,c);return a.isShader("vertex")?e.addVertexNode(h+"="+j+";"):e.addFragmentNode(h+"="+j+";"),a.format(h,i,b)}return a.format(this.generate(a,this.getType(a),c),this.getType(a),b)},THREE.TempNode.prototype.isShared=function(){return this.shared},THREE.TempNode.prototype.isUnique=function(){return this.unique},THREE.TempNode.prototype.getUuid=function(){var a=this.constructor.uuid||this.uuid;return"string"==typeof this.scope&&(a=this.scope+"-"+a),a},THREE.TempNode.prototype.getTemp=function(a,b){b=b||this.uuid;var c=a.material;return a.isShader("vertex")&&c.vertexTemps[b]?c.vertexTemps[b].name:c.fragmentTemps[b]?c.fragmentTemps[b].name:void 0},THREE.TempNode.prototype.generate=function(a,b,c,d,e){return this.isShared()||console.error("THREE.TempNode is not shared!"),c=c||this.uuid,a.isShader("vertex")?a.material.getVertexTemp(c,d||this.getType(a),e).name:a.material.getFragmentTemp(c,d||this.getType(a),e).name},THREE.CameraNode=function(a,b){THREE.TempNode.call(this,"v3"),this.setScope(a||THREE.CameraNode.POSITION),this.setCamera(b)},THREE.CameraNode.POSITION="position",THREE.CameraNode.DEPTH="depth",THREE.CameraNode.TO_VERTEX="toVertex",THREE.CameraNode.prototype=Object.create(THREE.TempNode.prototype),THREE.CameraNode.prototype.constructor=THREE.CameraNode,THREE.CameraNode.prototype.setCamera=function(a){this.camera=a,this.requestUpdate=void 0!==a},THREE.CameraNode.prototype.setScope=function(a){switch(this.scope){case THREE.CameraNode.DEPTH:delete this.near,delete this.far}switch(this.scope=a,a){case THREE.CameraNode.DEPTH:this.near=new THREE.FloatNode(camera?camera.near:1),this.far=new THREE.FloatNode(camera?camera.far:1200)}},THREE.CameraNode.prototype.getType=function(a){switch(this.scope){case THREE.CameraNode.DEPTH:return"fv1"}return this.type},THREE.CameraNode.prototype.isUnique=function(a){switch(this.scope){case THREE.CameraNode.DEPTH:case THREE.CameraNode.TO_VERTEX:return!0}return!1},THREE.CameraNode.prototype.isShared=function(a){switch(this.scope){case THREE.CameraNode.POSITION:return!1}return!0},THREE.CameraNode.prototype.generate=function(a,b){var c;a.material;switch(this.scope){case THREE.CameraNode.POSITION:c="cameraPosition";break;case THREE.CameraNode.DEPTH:a.include("depthcolor"),c="depthcolor("+this.near.build(a,"fv1")+","+this.far.build(a,"fv1")+")";break;case THREE.CameraNode.TO_VERTEX:c="normalize( "+new THREE.PositionNode(THREE.PositionNode.WORLD).build(a,"v3")+" - cameraPosition )"}return a.format(c,this.getType(a),b)},THREE.CameraNode.prototype.updateAnimation=function(a){switch(this.scope){case THREE.CameraNode.DEPTH:this.near.number=camera.near,this.far.number=camera.far}},THREE.ColorsNode=function(a){THREE.TempNode.call(this,"v4",{share:!1}),this.index=a||0},THREE.ColorsNode.vertexDict=["color","color2"],THREE.ColorsNode.fragmentDict=["vColor","vColor2"],THREE.ColorsNode.prototype=Object.create(THREE.TempNode.prototype),THREE.ColorsNode.prototype.constructor=THREE.ColorsNode,THREE.ColorsNode.prototype.generate=function(a,b){var c,d=a.material;return d.requestAttrib.color[this.index]=!0,c=a.isShader("vertex")?THREE.ColorsNode.vertexDict[this.index]:THREE.ColorsNode.fragmentDict[this.index],a.format(c,this.getType(a),b)},THREE.LightNode=function(){THREE.TempNode.call(this,"v3",{shared:!1})},THREE.LightNode.prototype=Object.create(THREE.TempNode.prototype),THREE.LightNode.prototype.constructor=THREE.LightNode,THREE.LightNode.prototype.generate=function(a,b){return a.isCache("light")?a.format("reflectedLight.directDiffuse",this.getType(a),b):(console.warn('THREE.LightNode is only compatible in "light" channel.'),a.format("vec3( 0.0 )",this.getType(a),b))},THREE.NormalNode=function(a){THREE.TempNode.call(this,"v3"),this.scope=a||THREE.NormalNode.LOCAL},THREE.NormalNode.LOCAL="local",THREE.NormalNode.WORLD="world",THREE.NormalNode.VIEW="view",THREE.NormalNode.prototype=Object.create(THREE.TempNode.prototype),THREE.NormalNode.prototype.constructor=THREE.NormalNode,THREE.NormalNode.prototype.isShared=function(a){switch(this.scope){case THREE.NormalNode.WORLD:return!0}return!1},THREE.NormalNode.prototype.generate=function(a,b){var c,d=a.material;switch(this.scope){case THREE.NormalNode.LOCAL:d.requestAttrib.normal=!0,c=a.isShader("vertex")?"normal":"vObjectNormal";break;case THREE.NormalNode.WORLD:d.requestAttrib.worldNormal=!0,c=a.isShader("vertex")?"( modelMatrix * vec4( objectNormal, 0.0 ) ).xyz":"vWNormal";break;case THREE.NormalNode.VIEW:c="vNormal"}return a.format(c,this.getType(a),b)},THREE.PositionNode=function(a){THREE.TempNode.call(this,"v3"),this.scope=a||THREE.PositionNode.LOCAL},THREE.PositionNode.LOCAL="local",THREE.PositionNode.WORLD="world",THREE.PositionNode.VIEW="view",THREE.PositionNode.PROJECTION="projection",THREE.PositionNode.prototype=Object.create(THREE.TempNode.prototype),THREE.PositionNode.prototype.constructor=THREE.PositionNode,THREE.PositionNode.prototype.getType=function(a){switch(this.scope){case THREE.PositionNode.PROJECTION:return"v4"}return this.type},THREE.PositionNode.prototype.isShared=function(a){switch(this.scope){case THREE.PositionNode.LOCAL:case THREE.PositionNode.WORLD:return!1}return!0},THREE.PositionNode.prototype.generate=function(a,b){var c,d=a.material;switch(this.scope){case THREE.PositionNode.LOCAL:d.requestAttrib.position=!0,c=a.isShader("vertex")?"transformed":"vPosition";break;case THREE.PositionNode.WORLD:d.requestAttrib.worldPosition=!0,c=(a.isShader("vertex"),"vWPosition");break;case THREE.PositionNode.VIEW:c=a.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case THREE.PositionNode.PROJECTION:c=a.isShader("vertex")?"(projectionMatrix * modelViewMatrix * vec4( position, 1.0 ))":"vec4( 0.0 )"}return a.format(c,this.getType(a),b)},THREE.ReflectNode=function(a){THREE.TempNode.call(this,"v3",{unique:!0}),this.scope=a||THREE.ReflectNode.CUBE},THREE.ReflectNode.CUBE="cube",THREE.ReflectNode.SPHERE="sphere",THREE.ReflectNode.VECTOR="vector",THREE.ReflectNode.prototype=Object.create(THREE.TempNode.prototype),THREE.ReflectNode.prototype.constructor=THREE.ReflectNode,THREE.ReflectNode.prototype.getType=function(a){switch(this.scope){case THREE.CameraNode.SPHERE:return"v2"}return this.type},THREE.ReflectNode.prototype.generate=function(a,b){var c;switch(this.scope){case THREE.ReflectNode.VECTOR:a.material.addFragmentNode("vec3 reflectVec = inverseTransformDirection( reflect( -geometry.viewDir, geometry.normal ), viewMatrix );"),c="reflectVec";break;case THREE.ReflectNode.CUBE:var d=new THREE.ReflectNode(THREE.ReflectNode.VECTOR).build(a,"v3");a.material.addFragmentNode("vec3 reflectCubeVec = vec3( -1.0 * "+d+".x, "+d+".yz );"),c="reflectCubeVec";break;case THREE.ReflectNode.SPHERE:var d=new THREE.ReflectNode(THREE.ReflectNode.VECTOR).build(a,"v3");a.material.addFragmentNode("vec3 reflectSphereVec = normalize((viewMatrix * vec4("+d+", 0.0 )).xyz + vec3(0.0,0.0,1.0)).xy * 0.5 + 0.5;"),c="reflectSphereVec"}return a.format(c,this.getType(this.type),b)},THREE.ScreenUVNode=function(a){THREE.TempNode.call(this,"v2"),this.resolution=a},THREE.ScreenUVNode.prototype=Object.create(THREE.TempNode.prototype),THREE.ScreenUVNode.prototype.constructor=THREE.ScreenUVNode,THREE.ScreenUVNode.prototype.generate=function(a,b){var c;a.material;return a.isShader("fragment")?c="(gl_FragCoord.xy/"+this.resolution.build(a,"v2")+")":(console.warn("THREE.ScreenUVNode is not compatible with "+a.shader+" shader."),c="vec2( 0.0 )"),a.format(c,this.getType(a),b)},THREE.UVNode=function(a){THREE.TempNode.call(this,"v2",{shared:!1}),this.index=a||0},THREE.UVNode.vertexDict=["uv","uv2"],THREE.UVNode.fragmentDict=["vUv","vUv2"],THREE.UVNode.prototype=Object.create(THREE.TempNode.prototype),THREE.UVNode.prototype.constructor=THREE.UVNode,THREE.UVNode.prototype.generate=function(a,b){var c,d=a.material;return d.requestAttrib.uv[this.index]=!0,c=a.isShader("vertex")?THREE.UVNode.vertexDict[this.index]:THREE.UVNode.fragmentDict[this.index],a.format(c,this.getType(a),b)},THREE.BuilderNode=function(a){this.material=a,this.caches=[],this.isVerify=!1,this.addCache()},THREE.BuilderNode.prototype={constructor:THREE.BuilderNode,addCache:function(a,b){return this.caches.push({name:a||"",requires:b||{}}),this.updateCache()},removeCache:function(){return this.caches.pop(),this.updateCache()},isCache:function(a){for(var b=this.caches.length;b--;)if(this.caches[b].name==a)return!0;return!1},updateCache:function(){var a=this.caches[this.caches.length-1];return this.cache=a.name,this.requires=a.requires,this},require:function(a,b){return this.requires[a]=b,this},include:function(a){return this.material.include(this.shader,a),this},colorToVector:function(a){return a.replace("r","x").replace("g","y").replace("b","z").replace("a","w")},getFormatConstructor:function(a){return THREE.BuilderNode.constructors[a-1]},getFormatName:function(a){return a.replace(/c/g,"v3").replace(/fv1|iv1/g,"v1")},isFormatMatrix:function(a){return/^m/.test(a)},getFormatLength:function(a){return parseInt(this.getFormatName(a).substr(1))},getFormatByLength:function(a){return 1==a?"fv1":"v"+a},format:function(a,b,c){var d=this.getFormatName(b+"="+c);switch(d){case"v1=v2":return"vec2("+a+")";case"v1=v3":return"vec3("+a+")";case"v1=v4":return"vec4("+a+")";case"v2=v1":return a+".x";case"v2=v3":return"vec3("+a+",0.0)";case"v2=v4":return"vec4("+a+",0.0,1.0)";case"v3=v1":return a+".x";case"v3=v2":return a+".xy";case"v3=v4":return"vec4("+a+",1.0)";case"v4=v1":return a+".x";case"v4=v2":return a+".xy";case"v4=v3":return a+".xyz"}return a},getTypeByFormat:function(a){return THREE.BuilderNode.type[a]},getUuid:function(a,b){return b=void 0!==b?b:!0,b&&this.cache&&(a=this.cache+"-"+a),a},getElementByIndex:function(a){return THREE.BuilderNode.elements[a]},getIndexByElement:function(a){return THREE.BuilderNode.elements.indexOf(a)},isShader:function(a){return this.shader==a||this.isVerify},setShader:function(a){return this.shader=a,this}},THREE.BuilderNode.type={"float":"fv1",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4"},THREE.BuilderNode.constructors=["","vec2","vec3","vec4"],THREE.BuilderNode.elements=["x","y","z","w"],THREE.ConstNode=function(a,b){THREE.TempNode.call(this),this.parse(a||THREE.ConstNode.PI,b)},THREE.ConstNode.PI="PI",THREE.ConstNode.PI2="PI2",THREE.ConstNode.RECIPROCAL_PI="RECIPROCAL_PI",THREE.ConstNode.RECIPROCAL_PI2="RECIPROCAL_PI2",THREE.ConstNode.LOG2="LOG2",THREE.ConstNode.EPSILON="EPSILON",THREE.ConstNode.prototype=Object.create(THREE.TempNode.prototype),THREE.ConstNode.prototype.constructor=THREE.ConstNode,THREE.ConstNode.prototype.parse=function(a,b){var c,d,e=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=(.*?)\;/i,f=a.match(e);f&&f.length>1?(d=f[1],c=f[2],b?this.src="#define "+c+" "+f[3]:this.src="const "+d+" "+c+" = "+f[3]+";"):(c=a,d="fv1"),this.name=c,this.type=d},THREE.ConstNode.prototype.generate=function(a,b){return a.format(this.name,this.getType(a),b)},THREE.FunctionCallNode=function(a){THREE.TempNode.call(this),this.setFunction(a)},THREE.FunctionCallNode.prototype=Object.create(THREE.TempNode.prototype),THREE.FunctionCallNode.prototype.constructor=THREE.FunctionCallNode,THREE.FunctionCallNode.prototype.setFunction=function(a){this.inputs=[],this.value=a},THREE.FunctionCallNode.prototype.getFunction=function(){return this.value},THREE.FunctionCallNode.prototype.getType=function(a){return this.value.getType(a)},THREE.FunctionCallNode.prototype.generate=function(a,b){var c=(a.material,this.getType(a)),d=this.value;a.include(d);for(var e=d.name+"(",f=[],g=0;g<d.inputs.length;g++){var h=d.inputs[g],i=this.inputs[g]||this.inputs[h.name];f.push(i.build(a,a.getTypeByFormat(h.type)))}return e+=f.join(",")+")",a.format(e,c,b)},THREE.FunctionNode=function(a,b,c){THREE.GLNode.call(this),this.parse(a||"",b,c)},THREE.FunctionNode.prototype=Object.create(THREE.GLNode.prototype),THREE.FunctionNode.prototype.constructor=THREE.FunctionNode,THREE.FunctionNode.prototype.parseReference=function(a){switch(a){case"uv":return(new THREE.UVNode).name;case"uv2":return new THREE.UVNode(1).name;
case"position":return(new THREE.PositionNode).name;case"worldPosition":return new THREE.PositionNode(THREE.PositionNode.WORLD).name;case"normal":return(new THREE.NormalNode).name;case"normalPosition":return new THREE.NormalNode(THREE.NormalNode.WORLD).name;case"viewPosition":return new THREE.PositionNode(THREE.NormalNode.VIEW).name;case"viewNormal":return new THREE.NormalNode(THREE.NormalNode.VIEW).name}return a},THREE.FunctionNode.prototype.getTypeNode=function(a,b){return a.getTypeByFormat(b)||b},THREE.FunctionNode.prototype.getInputByName=function(a){for(var b=this.inputs.length;b--;)if(this.inputs[b].name===a)return this.inputs[b]},THREE.FunctionNode.prototype.getType=function(a){return this.getTypeNode(a,this.type)},THREE.FunctionNode.prototype.getInclude=function(a){for(var b=this.includes.length;b--;)if(this.includes[b].name===a)return this.includes[b]},THREE.FunctionNode.prototype.parse=function(a,b,c){var d=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\((.*?)\)/i,e=/[a-z_0-9]+/gi;this.includes=b||[],this.extensions=c||{};var f=a.match(d);if(this.inputs=[],f&&4==f.length){this.type=f[1],this.name=f[2];var g=f[3].match(e);if(g)for(var h=0;h<g.length;){var i,j,k=g[h++];"in"==k||"out"==k||"inout"==k?i=g[h++]:(i=k,k=""),j=g[h++],this.inputs.push({name:j,type:i,qualifier:k})}for(var f,l=0;f=e.exec(a);){var m=f[0],n=this.parseReference(m);m!=n&&(a=a.substring(0,f.index+l)+n+a.substring(f.index+m.length+l),l+=n.length-m.length),void 0===this.getInclude(n)&&THREE.NodeLib.contains(n)&&this.includes.push(THREE.NodeLib.get(n))}this.src=a}else this.type="",this.name=""},THREE.InputNode=function(a,b){THREE.TempNode.call(this,a,b)},THREE.InputNode.prototype=Object.create(THREE.TempNode.prototype),THREE.InputNode.prototype.constructor=THREE.InputNode,THREE.InputNode.prototype.generate=function(a,b,c,d,e,f){var g=a.material;c=a.getUuid(c||this.getUuid()),d=d||this.getType(a);var h=g.getDataNode(c);return a.isShader("vertex")?(h.vertex||(h.vertex=g.createVertexUniform(d,this.value,e,f)),a.format(h.vertex.name,d,b)):(h.fragment||(h.fragment=g.createFragmentUniform(d,this.value,e,f)),a.format(h.fragment.name,d,b))},THREE.ColorNode=function(a){THREE.InputNode.call(this,"c",{share:!1}),this.value=new THREE.Color(a||0)},THREE.ColorNode.prototype=Object.create(THREE.InputNode.prototype),THREE.ColorNode.prototype.constructor=THREE.ColorNode,THREE.NodeMaterial.addShortcuts(THREE.ColorNode.prototype,"value",["r","g","b"]),THREE.CubeTextureNode=function(a,b,c){THREE.InputNode.call(this,"v4"),this.value=a,this.coord=b||new THREE.ReflectNode,this.bias=c},THREE.CubeTextureNode.prototype=Object.create(THREE.InputNode.prototype),THREE.CubeTextureNode.prototype.constructor=THREE.CubeTextureNode,THREE.CubeTextureNode.prototype.getTexture=function(a,b){return THREE.InputNode.prototype.generate.call(this,a,b,this.value.uuid,"t")},THREE.CubeTextureNode.prototype.generate=function(a,b){var c=this.getTexture(a,b),d=this.coord.build(a,"v3"),e=this.bias?this.bias.build(a,"fv1"):void 0;void 0==e&&a.requires.bias&&(e=a.requires.bias.build(a,"fv1"));var f;return f=e?"texCubeBias("+c+","+d+","+e+")":"texCube("+c+","+d+")",a.format(f,this.type,b)},THREE.FloatNode=function(a){THREE.InputNode.call(this,"fv1",{share:!1}),this.value=[a||0]},THREE.FloatNode.prototype=Object.create(THREE.InputNode.prototype),THREE.FloatNode.prototype.constructor=THREE.FloatNode,Object.defineProperties(THREE.FloatNode.prototype,{number:{get:function(){return this.value[0]},set:function(a){this.value[0]=a}}}),THREE.IntNode=function(a){THREE.InputNode.call(this,"fv1",{share:!1}),this.value=[Math.floor(a||0)]},THREE.IntNode.prototype=Object.create(THREE.InputNode.prototype),THREE.IntNode.prototype.constructor=THREE.IntNode,Object.defineProperties(THREE.IntNode.prototype,{number:{get:function(){return this.value[0]},set:function(a){this.value[0]=Math.floor(a)}}}),THREE.Matrix4Node=function(a){THREE.InputNode.call(this,"m4",{share:!1}),this.value=a||new THREE.Matrix4},THREE.Matrix4Node.prototype=Object.create(THREE.InputNode.prototype),THREE.Matrix4Node.prototype.constructor=THREE.Matrix4Node,THREE.MirrorNode=function(a,b,c){THREE.TempNode.call(this,"v4"),this.mirror=a instanceof THREE.Mirror?a:new THREE.Mirror(a,b,c),this.textureMatrix=new THREE.Matrix4Node(this.mirror.textureMatrix),this.worldPosition=new THREE.PositionNode(THREE.PositionNode.WORLD),this.coord=new THREE.OperatorNode(this.textureMatrix,this.worldPosition,THREE.OperatorNode.MUL),this.coordResult=new THREE.OperatorNode(null,this.coord,THREE.OperatorNode.ADD),this.texture=new THREE.TextureNode(this.mirror.texture,this.coord,null,!0)},THREE.MirrorNode.prototype=Object.create(THREE.TempNode.prototype),THREE.MirrorNode.prototype.constructor=THREE.MirrorNode,THREE.MirrorNode.prototype.generate=function(a,b){a.material;if(a.isShader("fragment")){this.coordResult.a=this.offset,this.texture.coord=this.offset?this.coordResult:this.coord;var c=this.texture.build(a,this.type);return a.format(c,this.type,b)}return console.warn("THREE.MirrorNode is not compatible with "+a.shader+" shader."),a.format("vec4(0.0)",this.type,b)},THREE.TextureNode=function(a,b,c,d){THREE.InputNode.call(this,"v4"),this.value=a,this.coord=b||new THREE.UVNode,this.bias=c,this.project=void 0!==d?d:!1},THREE.TextureNode.prototype=Object.create(THREE.InputNode.prototype),THREE.TextureNode.prototype.constructor=THREE.TextureNode,THREE.TextureNode.prototype.getTexture=function(a,b){return THREE.InputNode.prototype.generate.call(this,a,b,this.value.uuid,"t")},THREE.TextureNode.prototype.generate=function(a,b){var c=this.getTexture(a,b),d=this.coord.build(a,this.project?"v4":"v2"),e=this.bias?this.bias.build(a,"fv1"):void 0;void 0==e&&a.requires.bias&&(e=a.requires.bias.build(a,"fv1"));var f,g;return f=this.project?"texture2DProj":e?"tex2DBias":"tex2D",g=e?f+"("+c+","+d+","+e+")":f+"("+c+","+d+")",a.format(g,this.type,b)},THREE.ScreenNode=function(a){THREE.TextureNode.call(this,void 0,a)},THREE.ScreenNode.prototype=Object.create(THREE.TextureNode.prototype),THREE.ScreenNode.prototype.constructor=THREE.ScreenNode,THREE.ScreenNode.prototype.isUnique=function(){return!0},THREE.ScreenNode.prototype.getTexture=function(a,b){return THREE.InputNode.prototype.generate.call(this,a,b,this.getUuid(),"t","renderTexture")},THREE.Vector2Node=function(a,b){THREE.InputNode.call(this,"v2",{share:!1}),this.value=new THREE.Vector2(a,b)},THREE.Vector2Node.prototype=Object.create(THREE.InputNode.prototype),THREE.Vector2Node.prototype.constructor=THREE.Vector2Node,THREE.NodeMaterial.addShortcuts(THREE.Vector2Node.prototype,"value",["x","y"]),THREE.Vector3Node=function(a,b,c){THREE.InputNode.call(this,"v3",{share:!1}),this.type="v3",this.value=new THREE.Vector3(a,b,c)},THREE.Vector3Node.prototype=Object.create(THREE.InputNode.prototype),THREE.Vector3Node.prototype.constructor=THREE.Vector3Node,THREE.NodeMaterial.addShortcuts(THREE.Vector3Node.prototype,"value",["x","y","z"]),THREE.Vector4Node=function(a,b,c,d){THREE.InputNode.call(this,"v4",{share:!1}),this.value=new THREE.Vector4(a,b,c,d)},THREE.Vector4Node.prototype=Object.create(THREE.InputNode.prototype),THREE.Vector4Node.prototype.constructor=THREE.Vector4Node,THREE.NodeMaterial.addShortcuts(THREE.Vector4Node.prototype,"value",["x","y","z","w"]),THREE.PhongNode=function(){THREE.GLNode.call(this),this.color=new THREE.ColorNode(15658734),this.specular=new THREE.ColorNode(1118481),this.shininess=new THREE.FloatNode(30)},THREE.PhongNode.prototype=Object.create(THREE.GLNode.prototype),THREE.PhongNode.prototype.constructor=THREE.PhongNode,THREE.PhongNode.prototype.build=function(a){var b,c=a.material;if(c.define("PHONG"),c.define("ALPHATEST","0.0"),c.requestAttrib.light=!0,a.isShader("vertex")){var d=this.transform?this.transform.verifyAndBuildCode(a,"v3","transform"):void 0;c.mergeUniform(THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.ambient,THREE.UniformsLib.lights])),c.addVertexPars(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","	varying vec3 vNormal;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex].join("\n"));var e=[THREE.ShaderChunk.beginnormal_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"#ifndef FLAT_SHADED","	vNormal = normalize( transformedNormal );","#endif",THREE.ShaderChunk.begin_vertex];d&&e.push(d.code,"transformed = "+d.result+";"),e.push(THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"	vViewPosition = - mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex),b=e.join("\n")}else{this.color.verify(a),this.specular.verify(a),this.shininess.verify(a),this.alpha&&this.alpha.verify(a),this.light&&this.light.verify(a,"light"),this.ao&&this.ao.verify(a),this.ambient&&this.ambient.verify(a),this.shadow&&this.shadow.verify(a),this.emissive&&this.emissive.verify(a),this.normal&&this.normal.verify(a),this.normalScale&&this.normal&&this.normalScale.verify(a),this.environment&&this.environment.verify(a),this.environmentAlpha&&this.environment&&this.environmentAlpha.verify(a);var f=this.color.buildCode(a,"c"),g=this.specular.buildCode(a,"c"),h=this.shininess.buildCode(a,"fv1"),i=this.alpha?this.alpha.buildCode(a,"fv1"):void 0,j=this.light?this.light.buildCode(a,"v3","light"):void 0,k=this.ao?this.ao.buildCode(a,"fv1"):void 0,l=this.ambient?this.ambient.buildCode(a,"c"):void 0,m=this.shadow?this.shadow.buildCode(a,"c"):void 0,n=this.emissive?this.emissive.buildCode(a,"c"):void 0,o=this.normal?this.normal.buildCode(a,"v3"):void 0,p=this.normalScale&&this.normal?this.normalScale.buildCode(a,"v2"):void 0,q=this.environment?this.environment.buildCode(a,"c"):void 0,r=this.environmentAlpha&&this.environment?this.environmentAlpha.buildCode(a,"fv1"):void 0;c.requestAttrib.transparent=void 0!=i,c.addFragmentPars([THREE.ShaderChunk.common,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.bsdfs,THREE.ShaderChunk.ambient_pars,THREE.ShaderChunk.lights_pars,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment].join("\n"));var e=[THREE.ShaderChunk.normal_fragment,"	BlinnPhongMaterial material;",f.code,"	vec3 diffuseColor = "+f.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",THREE.ShaderChunk.logdepthbuf_fragment,g.code,"	vec3 specular = "+g.result+";",h.code,"	float shininess = max(0.0001,"+h.result+");","	float specularStrength = 1.0;"];i&&e.push(i.code,"if ( "+i.result+" <= ALPHATEST ) discard;"),o&&(a.include("perturbNormal2Arb"),e.push(o.code),p&&e.push(p.code),e.push("normal = perturbNormal2Arb(-vViewPosition,normal,"+o.result+","+(new THREE.UVNode).build(a,"v2")+","+(p?p.result:"vec2( 1.0 )")+");")),e.push("material.diffuseColor = "+(j?"vec3( 1.0 )":"diffuseColor")+";"),e.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;",THREE.ShaderChunk.lights_template),j&&(e.push(j.code,"reflectedLight.directDiffuse = "+j.result+";"),e.push("reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),k&&e.push(k.code,"reflectedLight.indirectDiffuse *= "+k.result+";"),l&&e.push(l.code,"reflectedLight.indirectDiffuse += "+l.result+";"),m&&e.push(m.code,"reflectedLight.directDiffuse *= "+m.result+";","reflectedLight.directSpecular *= "+m.result+";"),n&&e.push(n.code,"reflectedLight.directDiffuse += "+n.result+";"),e.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;"),q&&(e.push(q.code),r?e.push(r.code,"outgoingLight = mix(outgoingLight,"+q.result+","+r.result+");"):e.push("outgoingLight = "+q.result+";")),e.push(THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment),i?e.push("gl_FragColor = vec4( outgoingLight, "+i.result+" );"):e.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),b=e.join("\n")}return b},THREE.PhongNodeMaterial=function(){this.node=new THREE.PhongNode,THREE.NodeMaterial.call(this,this.node,this.node)},THREE.PhongNodeMaterial.prototype=Object.create(THREE.NodeMaterial.prototype),THREE.PhongNodeMaterial.prototype.constructor=THREE.PhongNodeMaterial,THREE.NodeMaterial.addShortcuts(THREE.PhongNodeMaterial.prototype,"node",["color","alpha","specular","shininess","normal","normalScale","emissive","ambient","light","shadow","ao","environment","environmentAlpha","transform"]),THREE.StandardNode=function(){THREE.GLNode.call(this),this.color=new THREE.ColorNode(15658734),this.roughness=new THREE.FloatNode(.5),this.metalness=new THREE.FloatNode(.5)},THREE.StandardNode.prototype=Object.create(THREE.GLNode.prototype),THREE.StandardNode.prototype.constructor=THREE.StandardNode,THREE.StandardNode.prototype.build=function(a){var b,c=a.material;if(c.define("PHYSICAL"),c.define("ALPHATEST","0.0"),c.requestAttrib.light=!0,a.isShader("vertex")){var d=this.transform?this.transform.verifyAndBuildCode(a,"v3","transform"):void 0;c.mergeUniform(THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.ambient,THREE.UniformsLib.lights])),c.addVertexPars(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","	varying vec3 vNormal;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex].join("\n"));var e=[THREE.ShaderChunk.beginnormal_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"#ifndef FLAT_SHADED","	vNormal = normalize( transformedNormal );","#endif",THREE.ShaderChunk.begin_vertex];d&&e.push(d.code,"transformed = "+d.result+";"),e.push(THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"	vViewPosition = - mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex),b=e.join("\n")}else{var f={bias:new THREE.RoughnessToBlinnExponentNode};this.color.verify(a),this.roughness.verify(a),this.metalness.verify(a),this.alpha&&this.alpha.verify(a),this.light&&this.light.verify(a,"light"),this.ao&&this.ao.verify(a),this.ambient&&this.ambient.verify(a),this.shadow&&this.shadow.verify(a),this.emissive&&this.emissive.verify(a),this.normal&&this.normal.verify(a),this.normalScale&&this.normal&&this.normalScale.verify(a),this.environment&&this.environment.verify(a,"env",f);var g=this.color.buildCode(a,"c"),h=this.roughness.buildCode(a,"fv1"),i=this.metalness.buildCode(a,"fv1"),j=this.reflectivity?this.reflectivity.buildCode(a,"fv1"):void 0,k=this.alpha?this.alpha.buildCode(a,"fv1"):void 0,l=this.light?this.light.buildCode(a,"v3","light"):void 0,m=this.ao?this.ao.buildCode(a,"fv1"):void 0,n=this.ambient?this.ambient.buildCode(a,"c"):void 0,o=this.shadow?this.shadow.buildCode(a,"c"):void 0,p=this.emissive?this.emissive.buildCode(a,"c"):void 0,q=this.normal?this.normal.buildCode(a,"v3"):void 0,r=this.normalScale&&this.normal?this.normalScale.buildCode(a,"v2"):void 0,s=this.environment?this.environment.buildCode(a,"c","env",f):void 0;c.requestAttrib.transparent=void 0!=k,c.addFragmentPars(["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","	varying vec3 vNormal;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.bsdfs,THREE.ShaderChunk.lights_pars,THREE.ShaderChunk.lights_physical_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment].join("\n"));var e=[THREE.ShaderChunk.normal_fragment,"	PhysicalMaterial material;","	material.diffuseColor = vec3( 1.0 );",g.code,"	vec3 diffuseColor = "+g.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",THREE.ShaderChunk.logdepthbuf_fragment,h.code,"	float roughnessFactor = "+h.result+";",i.code,"	float metalnessFactor = "+i.result+";"];k&&e.push(k.code,"if ( "+k.result+" <= ALPHATEST ) discard;"),q&&(a.include("perturbNormal2Arb"),e.push(q.code),r&&e.push(r.code),e.push("normal = perturbNormal2Arb(-vViewPosition,normal,"+q.result+","+(new THREE.UVNode).build(a,"v2")+","+(r?r.result:"vec2( 1.0 )")+");")),e.push("material.diffuseColor = "+(l?"vec3( 1.0 )":"diffuseColor * (1.0 - metalnessFactor)")+";"),e.push("material.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );"),j?e.push("material.specularColor = mix( vec3( 0.16 * pow2( "+j.builder(a,"fv1")+" ) ), diffuseColor, metalnessFactor );"):e.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),e.push(THREE.ShaderChunk.lights_template),l&&(e.push(l.code,"reflectedLight.directDiffuse = "+l.result+";"),e.push("diffuseColor *= 1.0 - metalnessFactor;","reflectedLight.directDiffuse *= diffuseColor;","reflectedLight.indirectDiffuse *= diffuseColor;")),m&&e.push(m.code,"reflectedLight.indirectDiffuse *= "+m.result+";"),n&&e.push(n.code,"reflectedLight.indirectDiffuse += "+n.result+";"),o&&e.push(o.code,"reflectedLight.directDiffuse *= "+o.result+";","reflectedLight.directSpecular *= "+o.result+";"),p&&e.push(p.code,"reflectedLight.directDiffuse += "+p.result+";"),s&&e.push(s.code,"RE_IndirectSpecular("+s.result+", geometry, material, reflectedLight );"),e.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;"),e.push(THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment),k?e.push("gl_FragColor = vec4( outgoingLight, "+k.result+" );"):e.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),b=e.join("\n")}return b},THREE.StandardNodeMaterial=function(){this.node=new THREE.StandardNode,THREE.NodeMaterial.call(this,this.node,this.node)},THREE.StandardNodeMaterial.prototype=Object.create(THREE.NodeMaterial.prototype),THREE.StandardNodeMaterial.prototype.constructor=THREE.StandardNodeMaterial,THREE.NodeMaterial.addShortcuts(THREE.StandardNodeMaterial.prototype,"node",["color","alpha","roughness","metalness","normal","normalScale","emissive","ambient","light","shadow","ao","environment","transform"]),THREE.Math1Node=function(a,b){THREE.TempNode.call(this),this.a=a,this.method=b||THREE.Math1Node.SIN},THREE.Math1Node.RAD="radians",THREE.Math1Node.DEG="degrees",THREE.Math1Node.EXP="exp",THREE.Math1Node.EXP2="exp2",THREE.Math1Node.LOG="log",THREE.Math1Node.LOG2="log2",THREE.Math1Node.SQRT="sqrt",THREE.Math1Node.INV_SQRT="inversesqrt",THREE.Math1Node.FLOOR="floor",THREE.Math1Node.CEIL="ceil",THREE.Math1Node.NORMALIZE="normalize",THREE.Math1Node.FRACT="fract",THREE.Math1Node.SAT="saturate",THREE.Math1Node.SIN="sin",THREE.Math1Node.COS="cos",THREE.Math1Node.TAN="tan",THREE.Math1Node.ASIN="asin",THREE.Math1Node.ACOS="acos",THREE.Math1Node.ARCTAN="atan",THREE.Math1Node.ABS="abs",THREE.Math1Node.SIGN="sign",THREE.Math1Node.LENGTH="length",THREE.Math1Node.NEGATE="negate",THREE.Math1Node.INVERT="invert",THREE.Math1Node.prototype=Object.create(THREE.TempNode.prototype),THREE.Math1Node.prototype.constructor=THREE.Math1Node,THREE.Math1Node.prototype.getType=function(a){switch(this.method){case THREE.Math1Node.LENGTH:return"fv1"}return this.a.getType(a)},THREE.Math1Node.prototype.generate=function(a,b){var c=(a.material,this.getType(a)),d=this.a.build(a,c);switch(this.method){case THREE.Math1Node.NEGATE:d="(-"+d+")";break;case THREE.Math1Node.INVERT:d="(1.0-"+d+")";break;default:d=this.method+"("+d+")"}return a.format(d,c,b)},THREE.Math2Node=function(a,b,c){THREE.TempNode.call(this),this.a=a,this.b=b,this.method=c||THREE.Math2Node.DISTANCE},THREE.Math2Node.MIN="min",THREE.Math2Node.MAX="max",THREE.Math2Node.MOD="mod",THREE.Math2Node.STEP="step",THREE.Math2Node.REFLECT="reflect",THREE.Math2Node.DISTANCE="distance",THREE.Math2Node.DOT="dot",THREE.Math2Node.CROSS="cross",THREE.Math2Node.POW="pow",THREE.Math2Node.prototype=Object.create(THREE.TempNode.prototype),THREE.Math2Node.prototype.constructor=THREE.Math2Node,THREE.Math2Node.prototype.getInputType=function(a){return a.getFormatLength(this.b.getType(a))>a.getFormatLength(this.a.getType(a))?this.b.getType(a):this.a.getType(a)},THREE.Math2Node.prototype.getType=function(a){switch(this.method){case THREE.Math2Node.DISTANCE:case THREE.Math2Node.DOT:return"fv1";case THREE.Math2Node.CROSS:return"v3"}return this.getInputType(a)},THREE.Math2Node.prototype.generate=function(a,b){var c,d,e=(a.material,this.getInputType(a)),f=a.getFormatLength(this.a.getType(a)),g=a.getFormatLength(this.b.getType(a));switch(this.method){case THREE.Math2Node.CROSS:c=this.a.build(a,"v3"),d=this.b.build(a,"v3");break;case THREE.Math2Node.STEP:c=this.a.build(a,1==f?"fv1":e),d=this.b.build(a,e);break;case THREE.Math2Node.MIN:case THREE.Math2Node.MAX:case THREE.Math2Node.MOD:c=this.a.build(a,e),d=this.b.build(a,1==g?"fv1":e);break;default:c=this.a.build(a,e),d=this.b.build(a,e)}return a.format(this.method+"("+c+","+d+")",this.getType(a),b)},THREE.Math3Node=function(a,b,c,d){THREE.TempNode.call(this),this.a=a,this.b=b,this.c=c,this.method=d||THREE.Math3Node.MIX},THREE.Math3Node.MIX="mix",THREE.Math3Node.REFRACT="refract",THREE.Math3Node.SMOOTHSTEP="smoothstep",THREE.Math3Node.FACEFORWARD="faceforward",THREE.Math3Node.prototype=Object.create(THREE.TempNode.prototype),THREE.Math3Node.prototype.constructor=THREE.Math3Node,THREE.Math3Node.prototype.getType=function(a){var b=a.getFormatLength(this.a.getType(a)),c=a.getFormatLength(this.b.getType(a)),d=a.getFormatLength(this.c.getType(a));return b>c?b>d?this.a.getType(a):this.c.getType(a):c>d?this.b.getType(a):this.c.getType(a)},THREE.Math3Node.prototype.generate=function(a,b){var c,d,e,f=(a.material,this.getType(a)),g=(a.getFormatLength(this.a.getType(a)),a.getFormatLength(this.b.getType(a)),a.getFormatLength(this.c.getType(a)));switch(this.method){case THREE.Math3Node.REFRACT:c=this.a.build(a,f),d=this.b.build(a,f),e=this.c.build(a,"fv1");break;case THREE.Math3Node.MIX:c=this.a.build(a,f),d=this.b.build(a,f),e=this.c.build(a,1==g?"fv1":f);break;default:c=this.a.build(a,f),d=this.b.build(a,f),e=this.c.build(a,f)}return a.format(this.method+"("+c+","+d+","+e+")",f,b)},THREE.OperatorNode=function(a,b,c){THREE.TempNode.call(this),this.a=a,this.b=b,this.op=c||THREE.OperatorNode.ADD},THREE.OperatorNode.ADD="+",THREE.OperatorNode.SUB="-",THREE.OperatorNode.MUL="*",THREE.OperatorNode.DIV="/",THREE.OperatorNode.prototype=Object.create(THREE.TempNode.prototype),THREE.OperatorNode.prototype.constructor=THREE.OperatorNode,THREE.OperatorNode.prototype.getType=function(a){var b=this.a.getType(a),c=this.b.getType(a);return a.isFormatMatrix(b)?"v4":a.getFormatLength(c)>a.getFormatLength(b)?c:b},THREE.OperatorNode.prototype.generate=function(a,b){var c=a.material,d=(c.getDataNode(this.uuid),this.getType(a)),e=this.a.build(a,d),f=this.b.build(a,d);return a.format("("+e+this.op+f+")",d,b)},THREE.NodeLib={nodes:{},add:function(a){this.nodes[a.name]=a},remove:function(a){delete this.nodes[a.name]},get:function(a){return this.nodes[a]},contains:function(a){return void 0!=this.nodes[a]}},THREE.NodeLib.add(new THREE.ConstNode("vec3 LUMA = vec3(0.2125, 0.7154, 0.0721);")),THREE.NodeLib.add(new THREE.FunctionNode(["float depthcolor( float mNear, float mFar ) {","#ifdef USE_LOGDEPTHBUF_EXT","float depth = gl_FragDepthEXT / gl_FragCoord.w;","#else","float depth = gl_FragCoord.z / gl_FragCoord.w;","#endif","return 1.0 - smoothstep( mNear, mFar, depth );","}"].join("\n"))),THREE.NodeLib.add(new THREE.FunctionNode(["vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 map, vec2 mUv, vec2 scale ) {","vec3 q0 = dFdx( eye_pos );","vec3 q1 = dFdy( eye_pos );","vec2 st0 = dFdx( mUv.st );","vec2 st1 = dFdy( mUv.st );","vec3 S = normalize( q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = map * 2.0 - 1.0;","mapN.xy = scale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}"].join("\n"),null,{derivatives:!0})),THREE.NodeLib.add(new THREE.FunctionNode(["float snoise(vec2 co) {","return fract( sin( dot(co.xy, vec2(12.9898,78.233) ) ) * 43758.5453 );","}"].join("\n"))),THREE.NodeLib.add(new THREE.FunctionNode(["vec3 hue_rgb(vec3 rgb, float adjustment) {","const mat3 RGBtoYIQ = mat3(0.299, 0.587, 0.114, 0.595716, -0.274453, -0.321263, 0.211456, -0.522591, 0.311135);","const mat3 YIQtoRGB = mat3(1.0, 0.9563, 0.6210, 1.0, -0.2721, -0.6474, 1.0, -1.107, 1.7046);","vec3 yiq = RGBtoYIQ * rgb;","float hue = atan(yiq.z, yiq.y) + adjustment;","float chroma = sqrt(yiq.z * yiq.z + yiq.y * yiq.y);","return YIQtoRGB * vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));","}"].join("\n"))),THREE.NodeLib.add(new THREE.FunctionNode(["vec3 saturation_rgb(vec3 rgb, float adjustment) {","vec3 intensity = vec3(dot(rgb, LUMA));","return mix(intensity, rgb, adjustment);","}"].join("\n"))),THREE.NodeLib.add(new THREE.FunctionNode(["float luminance_rgb(vec3 rgb) {","return dot(rgb, LUMA);","}"].join("\n"))),THREE.NodeLib.add(new THREE.FunctionNode(["vec3 vibrance_rgb(vec3 rgb, float adjustment) {","float average = (rgb.r + rgb.g + rgb.b) / 3.0;","float mx = max(rgb.r, max(rgb.g, rgb.b));","float amt = (mx - average) * (-3.0 * adjustment);","return mix(rgb.rgb, vec3(mx), amt);","}"].join("\n"))),THREE.ShaderPass&&(THREE.NodePass=function(){THREE.ShaderPass.call(this),this.textureID="renderTexture",this.fragment=new THREE.RawNode(new THREE.ScreenNode),this.node=new THREE.NodeMaterial,this.node.fragment=this.fragment,this.build()},THREE.NodePass.prototype=Object.create(THREE.ShaderPass.prototype),THREE.NodePass.prototype.constructor=THREE.NodePass,THREE.NodeMaterial.addShortcuts(THREE.NodePass.prototype,"fragment",["value"]),THREE.NodePass.prototype.build=function(){this.node.build(),this.uniforms=this.node.uniforms,this.material=this.node}),THREE.RawNode=function(a){THREE.GLNode.call(this,"v4"),this.value=a},THREE.RawNode.prototype=Object.create(THREE.GLNode.prototype),THREE.RawNode.prototype.constructor=THREE.RawNode,THREE.GLNode.prototype.generate=function(a){var b=(a.material,this.value.verifyAndBuildCode(a,this.type)),c=b.code+"\n";return c+="vertex"==a.shader?"gl_Position = "+b.result+";":"gl_FragColor = "+b.result+";"},THREE.ColorAdjustmentNode=function(a,b,c){THREE.TempNode.call(this,"v3"),this.rgb=a,this.adjustment=b,this.method=c||THREE.ColorAdjustmentNode.SATURATION},THREE.ColorAdjustmentNode.SATURATION="saturation",THREE.ColorAdjustmentNode.HUE="hue",THREE.ColorAdjustmentNode.VIBRANCE="vibrance",THREE.ColorAdjustmentNode.BRIGHTNESS="brightness",THREE.ColorAdjustmentNode.CONTRAST="contrast",THREE.ColorAdjustmentNode.prototype=Object.create(THREE.TempNode.prototype),THREE.ColorAdjustmentNode.prototype.constructor=THREE.ColorAdjustmentNode,THREE.ColorAdjustmentNode.prototype.generate=function(a,b){var c,d=this.rgb.build(a,"v3"),e=this.adjustment.build(a,"fv1");switch(this.method){case THREE.ColorAdjustmentNode.SATURATION:c="saturation_rgb";break;case THREE.ColorAdjustmentNode.HUE:c="hue_rgb";break;case THREE.ColorAdjustmentNode.VIBRANCE:c="vibrance_rgb";break;case THREE.ColorAdjustmentNode.BRIGHTNESS:return a.format("("+d+"+"+e+")",this.getType(a),b);case THREE.ColorAdjustmentNode.CONTRAST:return a.format("("+d+"*"+e+")",this.getType(a),b)}return a.include(c),a.format(c+"("+d+","+e+")",this.getType(a),b)},THREE.JoinNode=function(a,b,c,d){THREE.TempNode.call(this,"fv1"),this.x=a,this.y=b,this.z=c,this.w=d},THREE.JoinNode.inputs=["x","y","z","w"],THREE.JoinNode.prototype=Object.create(THREE.TempNode.prototype),THREE.JoinNode.prototype.constructor=THREE.JoinNode,THREE.JoinNode.prototype.getNumElements=function(){for(var a=THREE.JoinNode.inputs,b=a.length;b--;)if(void 0!==this[a[b]]){++b;break}return Math.max(b,2)},THREE.JoinNode.prototype.getType=function(a){return a.getFormatByLength(this.getNumElements())},THREE.JoinNode.prototype.generate=function(a,b){for(var c=(a.material,this.getType(a)),d=this.getNumElements(),e=THREE.JoinNode.inputs,f=[],g=0;d>g;g++){var h=this[e[g]];f.push(h?h.build(a,"fv1"):"0.")}var i=a.getFormatConstructor(d)+"("+f.join(",")+")";return a.format(i,c,b)},THREE.LuminanceNode=function(a){THREE.TempNode.call(this,"fv1"),this.rgb=a},THREE.LuminanceNode.prototype=Object.create(THREE.TempNode.prototype),THREE.LuminanceNode.prototype.constructor=THREE.LuminanceNode,THREE.LuminanceNode.prototype.generate=function(a,b){return a.include("luminance_rgb"),a.format("luminance_rgb("+this.rgb.build(a,"v3")+")",this.getType(a),b)},THREE.NoiseNode=function(a){THREE.TempNode.call(this,"fv1"),this.coord=a},THREE.NoiseNode.prototype=Object.create(THREE.TempNode.prototype),THREE.NoiseNode.prototype.constructor=THREE.NoiseNode,THREE.NoiseNode.prototype.generate=function(a,b){return a.include("snoise"),a.format("snoise("+this.coord.build(a,"v2")+")",this.getType(a),b)},THREE.NormalMapNode=function(a,b,c,d,e){THREE.TempNode.call(this,"v3"),this.value=a,this.scale=c||new THREE.FloatNode(1),this.normal=d||new THREE.NormalNode(THREE.NormalNode.LOCAL),this.position=e||new THREE.PositionNode(THREE.NormalNode.VIEW)},THREE.NormalMapNode.prototype=Object.create(THREE.TempNode.prototype),THREE.NormalMapNode.prototype.constructor=THREE.NormalMapNode,THREE.NormalMapNode.prototype.generate=function(a,b){a.material;return a.include("perturbNormal2Arb"),a.isShader("fragment")?a.format("perturbNormal2Arb(-"+this.position.build(a,"v3")+","+this.normal.build(a,"v3")+","+this.value.build(a,"v3")+","+this.value.coord.build(a,"v2")+","+this.scale.build(a,"v2")+")",this.getType(a),b):(console.warn("THREE.NormalMapNode is not compatible with "+a.shader+" shader."),a.format("vec3( 0.0 )",this.getType(a),b))},THREE.ResolutionNode=function(a){THREE.Vector2Node.call(this),this.requestUpdate=!0,this.renderer=a},THREE.ResolutionNode.prototype=Object.create(THREE.Vector2Node.prototype),THREE.ResolutionNode.prototype.constructor=THREE.ResolutionNode,THREE.ResolutionNode.prototype.updateAnimation=function(a){var b=this.renderer.getSize();this.x=b.width,this.y=b.height},THREE.RoughnessToBlinnExponentNode=function(){THREE.TempNode.call(this,"fv1")},THREE.RoughnessToBlinnExponentNode.getSpecularMIPLevel=new THREE.FunctionNode(["float getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {","float maxMIPLevelScalar = float( maxMIPLevel );","float desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );","return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );","}"].join("\n")),THREE.RoughnessToBlinnExponentNode.prototype=Object.create(THREE.TempNode.prototype),THREE.RoughnessToBlinnExponentNode.prototype.constructor=THREE.RoughnessToBlinnExponentNode,THREE.RoughnessToBlinnExponentNode.prototype.generate=function(a,b){var c=a.material;return a.isShader("fragment")?c.isDefined("PHYSICAL")?(a.include(THREE.RoughnessToBlinnExponentNode.getSpecularMIPLevel),a.format("getSpecularMIPLevel( Material_BlinnShininessExponent( material ), 8 )",this.type,b)):(console.warn("THREE.RoughnessToBlinnExponentNode is only compatible with PhysicalMaterial."),a.format("0.0",this.type,b)):(console.warn("THREE.RoughnessToBlinnExponentNode is not compatible with "+a.shader+" shader."),a.format("0.0",this.type,b))},THREE.SwitchNode=function(a,b){THREE.GLNode.call(this),this.node=a,this.components=b||"x"},THREE.SwitchNode.prototype=Object.create(THREE.GLNode.prototype),THREE.SwitchNode.prototype.constructor=THREE.SwitchNode,THREE.SwitchNode.prototype.getType=function(a){return a.getFormatByLength(this.components.length)},THREE.SwitchNode.prototype.generate=function(a,b){var c=this.node.getType(a),d=a.getFormatLength(c)-1,e=this.node.build(a,c);if(d>0){var f,g=0,h=a.colorToVector(this.components),i=h.length;
for(f=0;i>f;f++)g=Math.max(g,a.getIndexByElement(h.charAt(f)));for(g>d&&(g=d),e+=".",f=0;i>f;f++){var j=(h.charAt(f),a.getIndexByElement(h.charAt(f)));j>g&&(j=g),e+=a.getElementByIndex(j)}return a.format(e,this.getType(a),b)}return a.format(e,c,b)},THREE.TimerNode=function(a,b){THREE.FloatNode.call(this,a),this.requestUpdate=!0,this.scale=void 0!==b?b:1},THREE.TimerNode.prototype=Object.create(THREE.FloatNode.prototype),THREE.TimerNode.prototype.constructor=THREE.TimerNode,THREE.TimerNode.prototype.updateAnimation=function(a){this.number+=a*this.scale},THREE.VelocityNode=function(a,b){THREE.Vector3Node.call(this),this.requestUpdate=!0,this.target=a,this.position=this.target.position.clone(),this.velocity=new THREE.Vector3,this.moment=new THREE.Vector3,this.params=b||{}},THREE.VelocityNode.prototype=Object.create(THREE.Vector3Node.prototype),THREE.VelocityNode.prototype.constructor=THREE.VelocityNode,THREE.VelocityNode.prototype.updateAnimation=function(a){switch(this.velocity.subVectors(this.target.position,this.position),this.position.copy(this.target.position),this.params.type){case"elastic":a*=this.params.fps||60;var b=Math.pow(this.params.spring,a),c=Math.pow(this.params.friction,a);this.moment.x+=this.velocity.x*b,this.moment.y+=this.velocity.y*b,this.moment.z+=this.velocity.z*b,this.moment.x*=c,this.moment.y*=c,this.moment.z*=c,this.value.copy(this.moment);break;default:this.value.copy(this.velocity)}};var SEA3D={VERSION:18e3};SEA3D.getVersion=function(){var a=SEA3D.VERSION.toString(),b=a.length;return a.substring(0,b-4)+"."+a.substring(b-4,b-3)+"."+a.substring(b-3,b-2)+"."+parseFloat(a.substring(b-2,b)).toString()},console.log("SEA3D "+SEA3D.getVersion()),SEA3D.Stream=function(a){this.position=0,this.buffer=a||new ArrayBuffer},SEA3D.Stream.NONE=0,SEA3D.Stream.BOOLEAN=1,SEA3D.Stream.BYTE=2,SEA3D.Stream.UBYTE=3,SEA3D.Stream.SHORT=4,SEA3D.Stream.USHORT=5,SEA3D.Stream.INT24=6,SEA3D.Stream.UINT24=7,SEA3D.Stream.INT=8,SEA3D.Stream.UINT=9,SEA3D.Stream.FLOAT=10,SEA3D.Stream.DOUBLE=11,SEA3D.Stream.DECIMAL=12,SEA3D.Stream.VECTOR3D=74,SEA3D.Stream.VECTOR4D=106,SEA3D.Stream.STRING_TINY=128,SEA3D.Stream.STRING_SHORT=129,SEA3D.Stream.STRING_LONG=130,SEA3D.Stream.ASSET=200,SEA3D.Stream.GROUP=255,SEA3D.Stream.BLEND_MODE=["normal","add","subtract","multiply","dividing","mix","alpha","screen","darken","overlay","colorburn","linearburn","lighten","colordodge","lineardodge","softlight","hardlight","pinlight","spotlight","spotlightblend","hardmix","average","difference","exclusion","hue","saturation","color","value","linearlight","grainextract","reflect","glow","darkercolor","lightercolor","phoenix","negation"],SEA3D.Stream.INTERPOLATION_TABLE=["normal","linear","sine.in","sine.out","sine.inout","cubic.in","cubic.out","cubic.inout","quint.in","quint.out","quint.inout","circ.in","circ.out","circ.inout","back.in","back.out","back.inout","quad.in","quad.out","quad.inout","quart.in","quart.out","quart.inout","expo.in","expo.out","expo.inout","elastic.in","elastic.out","elastic.inout","bounce.in","bounce.out","bounce.inout"],SEA3D.Stream.sizeOf=function(a){return 0==a?0:a>=1&&31>=a?1:a>=32&&63>=a?2:a>=64&&95>=a?3:a>=96&&125>=a?4:-1},SEA3D.Stream.prototype={constructor:SEA3D.Stream,set buffer(a){this.buf=a,this.length=a.byteLength,this.data=new DataView(a)},get buffer(){return this.buf},get bytesAvailable(){return this.length-this.position}},SEA3D.Stream.prototype.getByte=function(a){return this.data.getInt8(a)},SEA3D.Stream.prototype.readBytes=function(a){var b=this.buf.slice(this.position,this.position+a);return this.position+=a,b},SEA3D.Stream.prototype.readByte=function(){return this.data.getInt8(this.position++)},SEA3D.Stream.prototype.readUByte=function(){return this.data.getUint8(this.position++)},SEA3D.Stream.prototype.readBool=function(){return 0!=this.data.getInt8(this.position++)},SEA3D.Stream.prototype.readShort=function(){var a=this.data.getInt16(this.position,!0);return this.position+=2,a},SEA3D.Stream.prototype.readUShort=function(){var a=this.data.getUint16(this.position,!0);return this.position+=2,a},SEA3D.Stream.prototype.readUInt24=function(){var a=16777215&this.data.getUint32(this.position,!0);return this.position+=3,a},SEA3D.Stream.prototype.readUInt24F=function(){return this.readUShort()|this.readUByte()<<16},SEA3D.Stream.prototype.readInt=function(){var a=this.data.getInt32(this.position,!0);return this.position+=4,a},SEA3D.Stream.prototype.readUInt=function(){var a=this.data.getUint32(this.position,!0);return this.position+=4,a},SEA3D.Stream.prototype.readFloat=function(){var a=this.data.getFloat32(this.position,!0);return this.position+=4,a},SEA3D.Stream.prototype.readUInteger=function(){var a=this.readUByte(),b=127&a;return 0!=(128&a)&&(a=this.readUByte(),b|=(127&a)<<7,0!=(128&a)&&(a=this.readUByte(),b|=(127&a)<<13)),b},SEA3D.Stream.prototype.readVector2=function(){return{x:this.readFloat(),y:this.readFloat()}},SEA3D.Stream.prototype.readVector3=function(){return{x:this.readFloat(),y:this.readFloat(),z:this.readFloat()}},SEA3D.Stream.prototype.readVector4=function(){return{x:this.readFloat(),y:this.readFloat(),z:this.readFloat(),w:this.readFloat()}},SEA3D.Stream.prototype.readMatrix=function(){var a=new Float32Array(16);return a[0]=this.readFloat(),a[1]=this.readFloat(),a[2]=this.readFloat(),a[3]=0,a[4]=this.readFloat(),a[5]=this.readFloat(),a[6]=this.readFloat(),a[7]=0,a[8]=this.readFloat(),a[9]=this.readFloat(),a[10]=this.readFloat(),a[11]=0,a[12]=this.readFloat(),a[13]=this.readFloat(),a[14]=this.readFloat(),a[15]=1,a},SEA3D.Stream.prototype.readUTF=function(a){return String.fromCharCode.apply(void 0,new Uint16Array(new Uint8Array(this.readBytes(a))))},SEA3D.Stream.prototype.readExt=function(){return this.readUTF(4).replace(/\0/g,"")},SEA3D.Stream.prototype.readUTF8=function(){return this.readUTF(this.readUByte())},SEA3D.Stream.prototype.readUTF8Short=function(){return this.readUTF(this.readUShort())},SEA3D.Stream.prototype.readUTF8Long=function(){return this.readUTF(this.readUInt())},SEA3D.Stream.prototype.readUByteArray=function(a){var b=new Uint8Array(a);return SEA3D.Stream.memcpy(b.buffer,0,this.buffer,this.position,a),this.position+=a,b},SEA3D.Stream.prototype.readUShortArray=function(a){var b=new Uint16Array(a),c=2*a;return SEA3D.Stream.memcpy(b.buffer,0,this.buffer,this.position,c),this.position+=c,b},SEA3D.Stream.prototype.readUInt24Array=function(a){for(var b=new Uint32Array(a),c=0;a>c;c++)b[c]=this.readUInt24();return b},SEA3D.Stream.prototype.readUIntArray=function(a){var b=new Uint32Array(a),c=4*a;return SEA3D.Stream.memcpy(b.buffer,0,this.buffer,this.position,c),this.position+=c,b},SEA3D.Stream.prototype.readFloatArray=function(a){var b=new Float32Array(a),c=4*a;return SEA3D.Stream.memcpy(b.buffer,0,this.buffer,this.position,c),this.position+=c,b},SEA3D.Stream.prototype.readBlendMode=function(){return SEA3D.Stream.BLEND_MODE[this.readUByte()]},SEA3D.Stream.prototype.readInterpolation=function(){return SEA3D.Stream.INTERPOLATION_TABLE[this.readUByte()]},SEA3D.Stream.prototype.readTags=function(a){for(var b=this.readUByte(),c=0;b>c;++c){var d=this.readUShort(),e=this.readUInt(),f=this.position;a(d,data,e),this.position=f+=e}},SEA3D.Stream.prototype.readProperties=function(a){var b=this.readUByte(),c={},d={};c.__type=d;for(var e=0;b>e;e++){var f=this.readUTF8(),g=this.readUByte();c[f]=this.readToken(g,a),d[f]=g}return c},SEA3D.Stream.prototype.readAnimationList=function(a){for(var b=[],c=this.readUByte(),d=0;c>d;){var e=this.readUByte(),f={};f.relative=0!=(1&e),2&e&&(f.timeScale=this.readFloat()),f.tag=a.getObject(this.readUInt()),b[d++]=f}return b},SEA3D.Stream.prototype.readScriptList=function(a){for(var b=[],c=this.readUByte(),d=0;c>d;){var e=this.readUByte(),f={};if(f.priority=1&e|2&e,4&e){var g=this.readUByte();f.params={};for(var h=0;g>h;h++){var i=this.readUTF8();f.params[i]=this.readObject(a)}}8&e&&(f.method=this.readUTF8()),f.tag=a.getObject(this.readUInt()),b[d++]=f}return b},SEA3D.Stream.prototype.readObject=function(a){return this.readToken(this.readUByte(),a)},SEA3D.Stream.prototype.readToken=function(a,b){switch(a){case SEA3D.Stream.BOOLEAN:return this.readBool();case SEA3D.Stream.UBYTE:return this.readUByte();case SEA3D.Stream.USHORT:return this.readUShort();case SEA3D.Stream.UINT24:return this.readUInt24();case SEA3D.Stream.INT:return this.readInt();case SEA3D.Stream.UINT:return this.readUInt();case SEA3D.Stream.FLOAT:return this.readFloat();case SEA3D.Stream.VECTOR3D:return this.readVector3();case SEA3D.Stream.VECTOR4D:return this.readVector4();case SEA3D.Stream.STRING_TINY:return this.readUTF8();case SEA3D.Stream.STRING_SHORT:return this.readUTF8Short();case SEA3D.Stream.STRING_LONG:return this.readUTF8Long();case SEA3D.Stream.ASSET:var c=this.readUInt();return c>0?b.getObject(c-1).tag:null;default:console.error("DataType not found!")}return null},SEA3D.Stream.prototype.readVector=function(a,b,c){var d=SEA3D.Stream.sizeOf(a),e=c*d,f=e+b*d;switch(a){case SEA3D.Stream.BOOLEAN:return this.readUByteArray(f);case SEA3D.Stream.UBYTE:return this.readUByteArray(f);case SEA3D.Stream.USHORT:return this.readUShortArray(f);case SEA3D.Stream.UINT24:return this.readUInt24Array(f);case SEA3D.Stream.UINT:return this.readUIntArray(f);case SEA3D.Stream.FLOAT:return this.readFloatArray(f);case SEA3D.Stream.VECTOR3D:return this.readFloatArray(f);case SEA3D.Stream.VECTOR4D:return this.readFloatArray(f)}},SEA3D.Stream.prototype.append=function(a){var b=new ArrayBuffer(this.data.byteLength+a.byteLength);b.set(new ArrayBuffer(this.data),0),b.set(new ArrayBuffer(a),this.data.byteLength),this.data=b},SEA3D.Stream.prototype.concat=function(a,b){return new SEA3D.Stream(this.buffer.slice(a,a+b))},SEA3D.Stream.memcpy=function(a,b,c,d,e){var f=new Uint8Array(a,b,e),g=new Uint8Array(c,d,e);f.set(g)},SEA3D.UByteArray=function(){this.ubytes=[],this.length=0},SEA3D.UByteArray.prototype={constructor:SEA3D.UByteArray,add:function(a){this.ubytes.push(a),this.length+=a.byteLength},toBuffer:function(){for(var a=new Uint8Array(this.length),b=0,c=0;b<this.ubytes.length;b++)a.set(this.ubytes[b],c),c+=this.ubytes[b].byteLength;return a.buffer}},SEA3D.Math={DEGREES:180/Math.PI,RADIANS:Math.PI/180},SEA3D.Math.angle=function(a){var b=180,c=0>a;return a=(c?-a:a)%360,a>b&&(a=-b+(a-b)),c?-a:a},SEA3D.Math.lerpAngle=function(a,b,c){return Math.abs(a-b)>180&&(a>b?b+=360:b-=360),a+=(b-a)*c,SEA3D.Math.angle(a)},SEA3D.Math.lerpColor=function(a,b,c){var d=a>>24&255,e=a>>16&255,f=a>>8&255,g=255&a,h=b>>24&255,i=b>>16&255,j=b>>8&255,k=255&b;return d+=(h-d)*c,e+=(i-e)*c,f+=(j-f)*c,g+=(k-g)*c,d<<24|e<<16|f<<8|g},SEA3D.Math.lerp=function(a,b,c){return a+(b-a)*c},SEA3D.Math.lerp1x=function(a,b,c){a[0]+=(b[0]-a[0])*c},SEA3D.Math.lerp3x=function(a,b,c){a[0]+=(b[0]-a[0])*c,a[1]+=(b[1]-a[1])*c,a[2]+=(b[2]-a[2])*c},SEA3D.Math.lerpAng1x=function(a,b,c){a[0]=SEA3D.Math.lerpAngle(a[0],b[0],c)},SEA3D.Math.lerpColor1x=function(a,b,c){a[0]=SEA3D.Math.lerpColor(a[0],b[0],c)},SEA3D.Math.lerpQuat4x=function(a,b,c){var d,e,f,g,h,i=a[0],j=a[1],k=a[2],l=a[3],m=b[0],n=b[1],o=b[2],p=b[3];0>i*m+j*n+k*o+l*p&&(m=-m,n=-n,o=-o,p=-p),d=i+c*(m-i),e=j+c*(n-j),f=k+c*(o-k),g=l+c*(p-l),h=1/Math.sqrt(g*g+d*d+e*e+f*f),a[0]=d*h,a[1]=e*h,a[2]=f*h,a[3]=g*h},SEA3D.Timer=function(){this.time=this.start=Date.now()},SEA3D.Timer.prototype={constructor:SEA3D.Timer,get now(){return Date.now()},get deltaTime(){return Date.now()-this.time},get elapsedTime(){return Date.now()-this.start},update:function(){this.time=Date.now()}},SEA3D.Object=function(a,b,c,d){this.name=a,this.data=b,this.type=c,this.sea3d=d},SEA3D.GeometryBase=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,this.attrib=b.readUShort(),this.isBig=0!=(1&this.attrib),b.readVInt=this.isBig?b.readUInt:b.readUShort,this.numVertex=b.readVInt(),this.length=3*this.numVertex},SEA3D.Geometry=function(a,b,c){SEA3D.GeometryBase.call(this,a,b,c);var d,e,f;if(4&this.attrib&&(this.normal=b.readFloatArray(this.length)),8&this.attrib&&(this.tangent=b.readFloatArray(this.length)),32&this.attrib)for(this.uv=[],this.uv.length=b.readUByte(),f=2*this.numVertex,d=0;d<this.uv.length;)this.uv[d++]=b.readFloatArray(f);if(64&this.attrib){this.jointPerVertex=b.readUByte();var g=this.numVertex*this.jointPerVertex;this.joint=b.readUShortArray(g),this.weight=b.readFloatArray(g)}if(128&this.attrib){var h=b.readUByte();for(this.numColor=((64&h)>>6|(128&h)>>6)+1,this.color=[],d=0,f=15&h;f>d;d++)this.color.push(b.readFloatArray(this.numVertex*this.numColor))}this.vertex=b.readFloatArray(this.length);var i=b.readUByte();if(this.groups=[],1024&this.attrib){for(d=0,f=0;i>d;d++)e=3*b.readVInt(),this.groups.push({start:f,count:e}),f+=e;this.indexes=this.isBig?b.readUIntArray(f):b.readUShortArray(f)}else{var j=this.isBig?4:2,k=new SEA3D.UByteArray;for(d=0,e=0;i>d;d++)f=3*b.readVInt(),this.groups.push({start:e,count:f}),e+=f,k.add(b.readUByteArray(f*j));this.indexes=this.isBig?new Uint32Array(k.toBuffer()):new Uint16Array(k.toBuffer())}},SEA3D.Geometry.prototype=Object.create(SEA3D.GeometryBase.prototype),SEA3D.Geometry.prototype.constructor=SEA3D.Geometry,SEA3D.Geometry.prototype.type="geo",SEA3D.GeometryDeltaBase=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,this.attrib=b.readUShort(),this.numVertex=b.readUInteger(),this.length=3*this.numVertex,1&this.attrib?(b.readNumber=b.readByte,this.numDiv=127.5):(b.readNumber=b.readShort,numDiv=32767.5)},SEA3D.GeometryDelta=function(a,b,c){SEA3D.GeometryDeltaBase.call(this,a,b,c);var d,e,f,g,h,i;if(4&this.attrib)for(g=b.readFloat(),this.normal=new Float32Array(this.length),d=0;d<this.length;)this.normal[d++]=b.readNumber()/this.numDiv*g;if(8&this.attrib)for(g=b.readFloat(),this.tangent=new Float32Array(this.length),d=0;d<this.length;)this.tangent[d++]=b.readNumber()/this.numDiv*g;if(32&this.attrib){this.uv=[],this.uv.length=b.readUByte();var j=2*this.numVertex;for(d=0;d<this.uv.length;)for(g=b.readFloat(),this.uv[d++]=i=new Float32Array(j),e=0;j>e;)i[e++]=b.readNumber()/this.numDiv*g}if(64&this.attrib){this.jointPerVertex=b.readUByte();var k=this.numVertex*this.jointPerVertex;for(this.joint=new Uint16Array(k),this.weight=new Float32Array(k),d=0;k>d;)this.joint[d++]=b.readUInteger();for(d=0;k>d;)this.weight[d++]=b.readNumber()/this.numDiv*1}if(128&this.attrib){var l=b.readUByte(),m=((64&l)>>6|(128&l)>>6)+1,n=4*this.numVertex;for(this.color=[],this.color.length=15&l,this.numColor=4,d=0;d<this.color.length;d++){var o=new Float32Array(n);switch(m){case 1:for(e=0;n>e;)o[e++]=b.readUByte()/255,o[e++]=0,o[e++]=0,o[e++]=1;break;case 2:for(e=0;n>e;)o[e++]=b.readUByte()/255,o[e++]=b.readUByte()/255,o[e++]=0,o[e++]=1;break;case 3:for(e=0;n>e;)o[e++]=b.readUByte()/255,o[e++]=b.readUByte()/255,o[e++]=b.readUByte()/255,o[e++]=1;break;case 4:for(e=0;n>e;)o[e++]=b.readUByte()/255,o[e++]=b.readUByte()/255,o[e++]=b.readUByte()/255,o[e++]=b.readUByte()/255}this.color[d]=o}}for(g=b.readFloat(),this.vertex=new Float32Array(this.length),d=0;d<this.length;)this.vertex[d++]=b.readNumber()/this.numDiv*g;var p=b.readUByte();for(this.indexes=i=[],this.groups=[],e=0,d=0;p>d;d++)for(h=3*b.readVInt(),this.groups.push({start:e,count:h}),h+=e;h>e;)i[e++]=b.readVInt();var p=b.readUByte();if(this.indexes=i=[],this.groups=[],2&this.attrib)for(d=0;p>d;d++){for(h=b.readUInteger(),f=i.length,e=0;h>e;e++){var q=b.readUInteger(),r=b.readUInteger(),s=b.readUInteger(),t=b.readUInteger();i.push(q),i.push(r),i.push(s),t>0&&(i.push(s),i.push(t+1),i.push(q))}this.groups.push({start:f,count:i.length-f})}else for(e=0,d=0;p>d;d++)for(h=3*b.readUInteger(),this.groups.push({start:e,count:h}),h+=e;h>e;)i[e++]=b.readUInteger()},SEA3D.GeometryDeltaBase.prototype=Object.create(SEA3D.GeometryDeltaBase.prototype),SEA3D.GeometryDeltaBase.prototype.constructor=SEA3D.GeometryDelta,SEA3D.GeometryDelta.prototype.type="geDL",SEA3D.Object3D=function(a,b,c){if(this.name=a,this.data=b,this.sea3d=c,this.isStatic=!1,this.visible=!0,this.attrib=b.readUShort(),1&this.attrib&&(this.parent=c.getObject(b.readUInt())),2&this.attrib&&(this.animations=b.readAnimationList(c)),4&this.attrib&&(this.scripts=b.readScriptList(c)),16&this.attrib&&(this.properties=c.getObject(b.readUInt())),32&this.attrib){var d=b.readUByte();this.isStatic=0!=(1&d),this.visible=0!=(2&d)}},SEA3D.Object3D.prototype.readTag=function(a,b,c){},SEA3D.Entity3D=function(a,b,c){if(SEA3D.Object3D.call(this,a,b,c),this.castShadows=!0,64&this.attrib){var d=b.readUByte();this.castShadows=0==(1&d)}},SEA3D.Entity3D.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.Entity3D.prototype.constructor=SEA3D.Entity3D,SEA3D.Sound3D=function(a,b,c){SEA3D.Object3D.call(this,a,b,c),this.autoPlay=0!=(64&this.attrib),128&this.attrib&&(this.mixer=c.getObject(b.readUInt())),this.sound=c.getObject(b.readUInt()),this.volume=b.readFloat()},SEA3D.Sound3D.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.Sound3D.prototype.constructor=SEA3D.Sound3D,SEA3D.SoundPoint=function(a,b,c){SEA3D.Sound3D.call(this,a,b,c),this.position=b.readVector3(),this.distance=b.readFloat(),b.readTags(this.readTag.bind(this))},SEA3D.SoundPoint.prototype=Object.create(SEA3D.Sound3D.prototype),SEA3D.SoundPoint.prototype.constructor=SEA3D.SoundPoint,SEA3D.SoundPoint.prototype.type="sp",SEA3D.Container3D=function(a,b,c){SEA3D.Object3D.call(this,a,b,c),this.transform=b.readMatrix(),b.readTags(this.readTag.bind(this))},SEA3D.Container3D.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.Container3D.prototype.constructor=SEA3D.Container3D,SEA3D.Container3D.prototype.type="c3d",SEA3D.TextureURL=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,this.url=b.readUTF(b.length)},SEA3D.TextureURL.prototype.type="urlT",SEA3D.Actions=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,this.count=b.readUInt(),this.actions=[];for(var d=0;d<this.count;d++){var e=b.readUByte(),f=b.readUShort(),g=b.readUShort(),h=b.position,i=this.actions[d]={kind:f};switch(1&e&&(i.range=[b.readUInt(),b.readUInt()]),2&e&&(i.time=b.readUInt()),4&e&&(i.intrpl=b.readInterpolation(),0==i.intrpl.indexOf("back.")?i.intrplParam0=b.readFloat():0==i.intrpl.indexOf("elastic.")&&(i.intrplParam0=b.readFloat(),i.intrplParam1=b.readFloat())),f){case SEA3D.Actions.RTT_TARGET:i.source=c.getObject(b.readUInt()),i.target=c.getObject(b.readUInt());break;case SEA3D.Actions.LOOK_AT:i.source=c.getObject(b.readUInt()),i.target=c.getObject(b.readUInt());break;case SEA3D.Actions.PLAY_SOUND:i.sound=c.getObject(b.readUInt()),i.offset=b.readUInt();break;case SEA3D.Actions.PLAY_ANIMATION:i.object=c.getObject(b.readUInt()),i.name=b.readUTF8();break;case SEA3D.Actions.FOG:i.color=b.readUInt24(),i.min=b.readFloat(),i.max=b.readFloat();break;case SEA3D.Actions.ENVIRONMENT:i.texture=c.getObject(b.readUInt());break;case SEA3D.Actions.ENVIRONMENT_COLOR:i.color=b.readUInt24F();break;case SEA3D.Actions.CAMERA:i.camera=c.getObject(b.readUInt());break;case SEA3D.Actions.SCRIPTS:i.scripts=b.readScriptList(c);break;case SEA3D.Actions.CLASS_OF:i.classof=c.getObject(b.readUInt());break;default:console.log('Action "'+f+'" not found.')}b.position=h+g}},SEA3D.Actions.SCENE=0,SEA3D.Actions.ENVIRONMENT_COLOR=1,SEA3D.Actions.ENVIRONMENT=2,SEA3D.Actions.FOG=3,SEA3D.Actions.PLAY_ANIMATION=4,SEA3D.Actions.PLAY_SOUND=5,SEA3D.Actions.ANIMATION_AUDIO_SYNC=6,SEA3D.Actions.LOOK_AT=7,SEA3D.Actions.RTT_TARGET=8,SEA3D.Actions.CAMERA=9,SEA3D.Actions.SCRIPTS=10,SEA3D.Actions.CLASS_OF=11,SEA3D.Actions.prototype.type="act",SEA3D.Properties=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,this.tag=b.readProperties(c),this.tag.__name=a},SEA3D.Properties.prototype.type="prop",SEA3D.FileInfo=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,this.tag=b.readProperties(c),this.tag.__name=a,c.info=this.tag},SEA3D.FileInfo.prototype.type="info",SEA3D.JavaScript=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,this.src=b.readUTF(b.length)},SEA3D.JavaScript.prototype.type="js",SEA3D.JavaScriptMethod=function(a,b,c){this.name=a,this.data=b,this.sea3d=c;var d=b.readUShort();this.methods={};for(var e=0;d>e;e++){var f=(b.readUByte(),b.readUTF8());this.methods[f]={src:b.readUTF8Long()}}},SEA3D.JavaScriptMethod.prototype.type="jsm",SEA3D.GLSL=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,this.src=b.readUTF(b.length)},SEA3D.GLSL.prototype.type="glsl",SEA3D.Dummy=function(a,b,c){SEA3D.Object3D.call(this,a,b,c),this.transform=b.readMatrix(),this.width=b.readFloat(),this.height=b.readFloat(),this.depth=b.readFloat(),b.readTags(this.readTag.bind(this))},SEA3D.Dummy.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.Dummy.prototype.constructor=SEA3D.Dummy,SEA3D.Dummy.prototype.type="dmy",SEA3D.Line=function(a,b,c){SEA3D.Object3D.call(this,a,b,c),this.count=3*(64&this.attrib?b.readUInt():b.readUShort()),this.closed=0!=(128&this.attrib),this.transform=b.readMatrix(),this.vertex=[];for(var d=0;d<this.count;)this.vertex[d++]=b.readFloat();b.readTags(this.readTag.bind(this))},SEA3D.Line.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.Line.prototype.constructor=SEA3D.Line,SEA3D.Line.prototype.type="line",SEA3D.Sprite=function(a,b,c){SEA3D.Object3D.call(this,a,b,c),256&this.attrib&&(this.material=c.getObject(b.readUInt())),this.position=b.readVector3(),this.width=b.readFloat(),this.height=b.readFloat(),b.readTags(this.readTag.bind(this))},SEA3D.Sprite.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.Sprite.prototype.constructor=SEA3D.Sprite,SEA3D.Sprite.prototype.type="m2d",SEA3D.Mesh=function(a,b,c){if(SEA3D.Entity3D.call(this,a,b,c),256&this.attrib){this.material=[];var d=b.readUByte();if(1==d)this.material[0]=c.getObject(b.readUInt());else for(var e=0;d>e;){var f=b.readUInt();f>0?this.material[e++]=c.getObject(f-1):this.material[e++]=void 0}}if(512&this.attrib){this.modifiers=[];for(var d=b.readUByte(),e=0;d>e;e++)this.modifiers[e]=c.getObject(b.readUInt())}1024&this.attrib&&(this.reference={type:b.readUByte(),ref:c.getObject(b.readUInt())}),this.transform=b.readMatrix(),this.geometry=c.getObject(b.readUInt()),b.readTags(this.readTag.bind(this))},SEA3D.Mesh.prototype=Object.create(SEA3D.Entity3D.prototype),SEA3D.Mesh.prototype.constructor=SEA3D.Mesh,SEA3D.Mesh.prototype.type="m3d",SEA3D.Skeleton=function(a,b,c){this.name=a,this.data=b,this.sea3d=c;var d=b.readUShort();this.joint=[];for(var e=0;d>e;e++)this.joint[e]={name:b.readUTF8(),parentIndex:b.readUShort()-1,inverseBindMatrix:b.readMatrix()}},SEA3D.Skeleton.prototype.type="skl",SEA3D.SkeletonLocal=function(a,b,c){this.name=a,this.data=b,this.sea3d=c;var d=b.readUShort();this.joint=[];for(var e=0;d>e;e++)this.joint[e]={name:b.readUTF8(),parentIndex:b.readUShort()-1,x:b.readFloat(),y:b.readFloat(),z:b.readFloat(),qx:b.readFloat(),qy:b.readFloat(),qz:b.readFloat(),qw:b.readFloat()}},SEA3D.SkeletonLocal.prototype.type="sklq",SEA3D.AnimationBase=function(a,b,c){this.name=a,this.data=b,this.sea3d=c;var d=b.readUByte();if(this.sequence=[],1&d)for(var e=b.readUShort(),f=0;e>f;f++)d=b.readUByte(),this.sequence[f]={name:b.readUTF8(),start:b.readUInt(),count:b.readUInt(),repeat:0!=(1&d),intrpl:0==(2&d)};this.frameRate=b.readUByte(),this.numFrames=b.readUInt(),0==this.sequence.length&&(this.sequence[0]={name:"root",start:0,count:this.numFrames,repeat:!0,intrpl:!0})},SEA3D.Animation=function(a,b,c){SEA3D.AnimationBase.call(this,a,b,c),this.dataList=[];for(var d=0,e=b.readUByte();e>d;d++){var f=b.readUShort(),g=b.readUByte(),h=b.readVector(g,this.numFrames,0);this.dataList.push({kind:f,type:g,blockSize:SEA3D.Stream.sizeOf(g),data:h})}},SEA3D.Animation.POSITION=0,SEA3D.Animation.ROTATION=1,SEA3D.Animation.SCALE=2,SEA3D.Animation.COLOR=3,SEA3D.Animation.MULTIPLIER=4,SEA3D.Animation.ATTENUATION_START=5,SEA3D.Animation.ATTENUATION_END=6,SEA3D.Animation.FOV=7,SEA3D.Animation.OFFSET_U=8,SEA3D.Animation.OFFSET_V=9,SEA3D.Animation.SCALE_U=10,SEA3D.Animation.SCALE_V=11,SEA3D.Animation.ANGLE=12,SEA3D.Animation.ALPHA=13,SEA3D.Animation.VOLUME=14,SEA3D.Animation.DefaultLerpFuncs=[SEA3D.Math.lerp3x,SEA3D.Math.lerpQuat4x,SEA3D.Math.lerp3x,SEA3D.Math.lerpColor1x,SEA3D.Math.lerp1x,SEA3D.Math.lerp1x,SEA3D.Math.lerp1x,SEA3D.Math.lerp1x,SEA3D.Math.lerp1x,SEA3D.Math.lerp1x,SEA3D.Math.lerp1x,SEA3D.Math.lerp1x,SEA3D.Math.lerpAng1x,SEA3D.Math.lerp1x,SEA3D.Math.lerp1x],SEA3D.Animation.prototype=Object.create(SEA3D.AnimationBase.prototype),SEA3D.Animation.prototype.constructor=SEA3D.Animation,SEA3D.Animation.prototype.type="anm",SEA3D.SkeletonAnimation=function(a,b,c){SEA3D.AnimationBase.call(this,a,b,c),this.name=a,this.data=b,this.sea3d=c,this.numJoints=b.readUShort(),this.raw=b.readFloatArray(this.numFrames*this.numJoints*7)},SEA3D.SkeletonAnimation.prototype.type="skla",SEA3D.Morph=function(a,b,c){SEA3D.GeometryBase.call(this,a,b,c);var d=0!=(2&this.attrib),e=0!=(4&this.attrib),f=b.readUShort();this.node=[];for(var g=0;f>g;g++){var h,i,j=b.readUTF8();d&&(h=b.readFloatArray(this.length)),e&&(i=b.readFloatArray(this.length)),this.node[g]={vertex:h,normal:i,name:j}}},SEA3D.Morph.prototype=Object.create(SEA3D.GeometryBase.prototype),SEA3D.Morph.prototype.constructor=SEA3D.Morph,SEA3D.Morph.prototype.type="mph",SEA3D.VertexAnimation=function(a,b,c){SEA3D.AnimationBase.call(this,a,b,c);var d=b.readUByte();this.isBig=0!=(1&d),b.readVInt=this.isBig?b.readUInt:b.readUShort,this.numVertex=b.readVInt(),this.length=3*this.numVertex;var e=0!=(2&d),f=0!=(4&d);this.frame=[];var g,h,i;for(g=0;g<this.numFrames;g++)e&&(h=b.readFloatArray(this.length)),f&&(i=b.readFloatArray(this.length)),this.frame[g]={vertex:h,normal:i}},SEA3D.VertexAnimation.prototype=Object.create(SEA3D.AnimationBase.prototype),SEA3D.VertexAnimation.prototype.constructor=SEA3D.VertexAnimation,SEA3D.VertexAnimation.prototype.type="vtxa",SEA3D.Camera=function(a,b,c){SEA3D.Object3D.call(this,a,b,c),64&this.attrib&&(this.dof={distance:b.readFloat(),range:b.readFloat()}),this.transform=b.readMatrix(),this.fov=b.readFloat(),b.readTags(this.readTag.bind(this))},SEA3D.Camera.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.Camera.prototype.constructor=SEA3D.Camera,SEA3D.Camera.prototype.type="cam",SEA3D.OrthographicCamera=function(a,b,c){SEA3D.Object3D.call(this,a,b,c),this.transform=b.readMatrix(),this.height=b.readFloat(),b.readTags(this.readTag.bind(this))},SEA3D.OrthographicCamera.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.OrthographicCamera.prototype.constructor=SEA3D.OrthographicCamera,SEA3D.OrthographicCamera.prototype.type="camo",SEA3D.JointObject=function(a,b,c){SEA3D.Object3D.call(this,a,b,c),this.target=c.getObject(b.readUInt()),this.joint=b.readUShort(),b.readTags(this.readTag.bind(this))},SEA3D.JointObject.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.JointObject.prototype.constructor=SEA3D.JointObject,SEA3D.JointObject.prototype.type="jnt",SEA3D.Light=function(a,b,c){if(SEA3D.Object3D.call(this,a,b,c),this.attenStart=Number.MAX_VALUE,this.attenEnd=Number.MAX_VALUE,64&this.attrib){var d=b.readUByte();this.shadow={},this.shadow.opacity=1&d?b.readFloat():1,this.shadow.color=2&d?b.readUInt24():0}512&this.attrib&&(this.attenStart=b.readFloat(),this.attenEnd=b.readFloat()),this.color=b.readUInt24(),this.multiplier=b.readFloat()},SEA3D.Light.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.Light.prototype.constructor=SEA3D.Light,SEA3D.PointLight=function(a,b,c){SEA3D.Light.call(this,a,b,c),128&this.attrib&&(this.attenuation={start:b.readFloat(),end:b.readFloat()}),this.position=b.readVector3(),b.readTags(this.readTag.bind(this))},SEA3D.PointLight.prototype=Object.create(SEA3D.Light.prototype),SEA3D.PointLight.prototype.constructor=SEA3D.PointLight,SEA3D.PointLight.prototype.type="plht",SEA3D.HemisphereLight=function(a,b,c){SEA3D.Light.call(this,a,b,c),128&this.attrib&&(this.attenuation={start:b.readFloat(),end:b.readFloat()}),this.secondColor=b.readUInt24(),b.readTags(this.readTag.bind(this))},SEA3D.HemisphereLight.prototype=Object.create(SEA3D.Light.prototype),SEA3D.HemisphereLight.prototype.constructor=SEA3D.HemisphereLight,SEA3D.HemisphereLight.prototype.type="hlht",SEA3D.AmbientLight=function(a,b,c){SEA3D.Light.call(this,a,b,c),b.readTags(this.readTag.bind(this))},SEA3D.AmbientLight.prototype=Object.create(SEA3D.Light.prototype),SEA3D.AmbientLight.prototype.constructor=SEA3D.AmbientLight,SEA3D.AmbientLight.prototype.type="alht",SEA3D.DirectionalLight=function(a,b,c){SEA3D.Light.call(this,a,b,c),this.transform=b.readMatrix(),b.readTags(this.readTag.bind(this))},SEA3D.DirectionalLight.prototype=Object.create(SEA3D.Light.prototype),SEA3D.DirectionalLight.prototype.constructor=SEA3D.DirectionalLight,SEA3D.DirectionalLight.prototype.type="dlht",SEA3D.Material=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,this.technique=[],this.attrib=b.readUShort(),this.alpha=1,this.blendMode="normal",this.alphaThreshold=.5,this.physical=!1,this.anisotropy=!1,this.bothSides=0!=(1&this.attrib),this.receiveLights=0==(2&this.attrib),this.receiveShadows=0==(4&this.attrib),this.receiveFog=0==(8&this.attrib),this.smooth=0==(16&this.attrib),32&this.attrib&&(this.alpha=b.readFloat()),64&this.attrib&&(this.blendMode=b.readBlendMode()),128&this.attrib&&(this.animations=b.readAnimationList(c)),this.depthMask=0==(256&this.attrib),this.depthTest=0==(512&this.attrib);for(var d=b.readUByte(),e=0;d>e;++e){var f,g,h=b.readUShort(),i=b.readUShort(),j=b.position;switch(h){case SEA3D.Material.PHONG:f={ambientColor:b.readUInt24(),diffuseColor:b.readUInt24(),specularColor:b.readUInt24(),specular:b.readFloat(),gloss:b.readFloat()};break;case SEA3D.Material.PHYSICAL:this.physical=!0,f={color:b.readUInt24(),roughness:b.readFloat(),metalness:b.readFloat()};break;case SEA3D.Material.ANISOTROPIC:this.anisotropy=!0;break;case SEA3D.Material.COMPOSITE_TEXTURE:f={composite:c.getObject(b.readUInt())};break;case SEA3D.Material.DIFFUSE_MAP:f={texture:c.getObject(b.readUInt())};break;case SEA3D.Material.SPECULAR_MAP:f={texture:c.getObject(b.readUInt())};break;case SEA3D.Material.NORMAL_MAP:f={texture:c.getObject(b.readUInt())};break;case SEA3D.Material.REFLECTION:case SEA3D.Material.FRESNEL_REFLECTION:f={texture:c.getObject(b.readUInt()),alpha:b.readFloat()},h==SEA3D.Material.FRESNEL_REFLECTION&&(f.power=b.readFloat(),f.normal=b.readFloat());break;case SEA3D.Material.REFRACTION:f={texture:c.getObject(b.readUInt()),alpha:b.readFloat(),ior:b.readFloat()};break;case SEA3D.Material.RIM:f={color:b.readUInt24(),strength:b.readFloat(),power:b.readFloat(),blendMode:b.readBlendMode()};break;case SEA3D.Material.LIGHT_MAP:f={texture:c.getObject(b.readUInt()),channel:b.readUByte(),blendMode:b.readBlendMode()};break;case SEA3D.Material.DETAIL_MAP:f={texture:c.getObject(b.readUInt()),scale:b.readFloat(),blendMode:b.readBlendMode()};break;case SEA3D.Material.CEL:f={color:b.readUInt24(),levels:b.readUByte(),size:b.readFloat(),specularCutOff:b.readFloat(),smoothness:b.readFloat()};break;case SEA3D.Material.TRANSLUCENT:f={translucency:b.readFloat(),scattering:b.readFloat()};break;case SEA3D.Material.BLEND_NORMAL_MAP:g=b.readUByte(),f={texture:c.getObject(b.readUInt()),secondaryTexture:c.getObject(b.readUInt())},1&g?(f.offsetX0=b.readFloat(),f.offsetY0=b.readFloat(),f.offsetX1=b.readFloat(),f.offsetY1=b.readFloat()):f.offsetX0=f.offsetY0=f.offsetX1=f.offsetY1=0,f.animate=2&g;break;case SEA3D.Material.MIRROR_REFLECTION:f={texture:c.getObject(b.readUInt()),alpha:b.readFloat()};break;case SEA3D.Material.AMBIENT_MAP:f={texture:c.getObject(b.readUInt())};break;case SEA3D.Material.ALPHA_MAP:f={texture:c.getObject(b.readUInt())};break;case SEA3D.Material.EMISSIVE:f={color:b.readUInt24()};break;case SEA3D.Material.EMISSIVE_MAP:f={texture:c.getObject(b.readUInt())};break;case SEA3D.Material.ROUGHNESS_MAP:case SEA3D.Material.METALNESS_MAP:f={texture:c.getObject(b.readUInt())};break;case SEA3D.Material.VERTEX_COLOR:f={blendMode:b.readBlendMode()};break;case SEA3D.Material.WRAP_LIGHTING:f={color:b.readUInt24(),strength:b.readFloat()};break;case SEA3D.Material.COLOR_REPLACE:g=b.readUByte(),f={red:b.readUInt24(),green:b.readUInt24(),blue:b.readUInt24F()},1&g&&(f.mask=c.getObject(b.readUInt())),2&g&&(f.alpha=b.readFloat());break;case SEA3D.Material.REFLECTION_SPHERICAL:f={texture:c.getObject(b.readUInt()),
alpha:b.readFloat()};break;default:console.warn("SEA3D: MaterialTechnique not found:",h.toString(16)),b.position=j+=i;continue}f.kind=h,this.technique.push(f),b.position=j+=i}},SEA3D.Material.PHONG=0,SEA3D.Material.COMPOSITE_TEXTURE=1,SEA3D.Material.DIFFUSE_MAP=2,SEA3D.Material.SPECULAR_MAP=3,SEA3D.Material.REFLECTION=4,SEA3D.Material.REFRACTION=5,SEA3D.Material.NORMAL_MAP=6,SEA3D.Material.FRESNEL_REFLECTION=7,SEA3D.Material.RIM=8,SEA3D.Material.LIGHT_MAP=9,SEA3D.Material.DETAIL_MAP=10,SEA3D.Material.CEL=11,SEA3D.Material.TRANSLUCENT=12,SEA3D.Material.BLEND_NORMAL_MAP=13,SEA3D.Material.MIRROR_REFLECTION=14,SEA3D.Material.AMBIENT_MAP=15,SEA3D.Material.ALPHA_MAP=16,SEA3D.Material.EMISSIVE_MAP=17,SEA3D.Material.VERTEX_COLOR=18,SEA3D.Material.WRAP_LIGHTING=19,SEA3D.Material.COLOR_REPLACE=20,SEA3D.Material.REFLECTION_SPHERICAL=21,SEA3D.Material.ANISOTROPIC=22,SEA3D.Material.EMISSIVE=23,SEA3D.Material.PHYSICAL=24,SEA3D.Material.ROUGHNESS_MAP=25,SEA3D.Material.METALNESS_MAP=26,SEA3D.Material.prototype.type="mat",SEA3D.Composite=function(a,b,c){this.name=a,this.data=b,this.sea3d=c;var d=b.readUByte();this.layer=[];for(var e=0;d>e;e++)this.layer[e]=new SEA3D.Composite.prototype.Layer(b,c)},SEA3D.Composite.prototype.getLayerByName=function(a){for(var b=0;b<this.layer.length;b++)if(this.layer[b].name==a)return this.layer[b]},SEA3D.Composite.prototype.Layer=function(a,b){var c=a.readUShort();1&c?this.texture=new SEA3D.Composite.LayerBitmap(a,b):this.color=a.readUInt24(),2&c&&(this.mask=new SEA3D.Composite.LayerBitmap(a,b)),4&c&&(this.name=a.readUTF8()),this.blendMode=8&c?a.readBlendMode():"normal",this.opacity=16&c?a.readFloat():1},SEA3D.Composite.LayerBitmap=function(a,b){this.map=b.getObject(a.readUInt());var c=a.readUShort();this.channel=1&c?a.readUByte():0,this.repeat=c&!1,this.offsetU=4&c?a.readFloat():0,this.offsetV=8&c?a.readFloat():0,this.scaleU=16&c?a.readFloat():1,this.scaleV=32&c?a.readFloat():1,this.rotation=64&c?a.readFloat():0,128&c&&(this.animation=a.readAnimationList(b))},SEA3D.Composite.prototype.type="ctex",SEA3D.Sphere=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,this.radius=b.readFloat()},SEA3D.Sphere.prototype.type="sph",SEA3D.Box=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,this.width=b.readFloat(),this.height=b.readFloat(),this.depth=b.readFloat()},SEA3D.Box.prototype.type="box",SEA3D.Cone=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,this.radius=b.readFloat(),this.height=b.readFloat()},SEA3D.Cone.prototype.type="cone",SEA3D.Capsule=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,this.radius=b.readFloat(),this.height=b.readFloat()},SEA3D.Capsule.prototype.type="cap",SEA3D.Cylinder=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,this.radius=b.readFloat(),this.height=b.readFloat()},SEA3D.Cylinder.prototype.type="cyl",SEA3D.ConvexGeometry=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,this.geometry=c.getObject(b.readUInt()),this.subGeometryIndex=b.readUByte()},SEA3D.ConvexGeometry.prototype.type="gs",SEA3D.TriangleGeometry=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,this.geometry=c.getObject(b.readUInt()),this.subGeometryIndex=b.readUByte()},SEA3D.TriangleGeometry.prototype.type="sgs",SEA3D.Compound=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,this.compounds=[];for(var d=b.readUByte(),e=0;d>e;e++)this.compounds.push({shape:c.getObject(b.readUInt()),transform:b.readMatrix()})},SEA3D.Compound.prototype.type="cmps",SEA3D.Physics=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,this.attrib=b.readUShort(),this.shape=c.getObject(b.readUInt()),1&this.attrib?this.target=c.getObject(b.readUInt()):this.transform=b.readMatrix()},SEA3D.Physics.prototype.readTag=function(a,b,c){},SEA3D.RigidBodyBase=function(a,b,c){SEA3D.Physics.call(this,a,b,c),32&this.attrib?(this.linearDamping=b.readFloat(),this.angularDamping=b.readFloat()):(this.linearDamping=0,this.angularDamping=0),this.mass=b.readFloat(),this.friction=b.readFloat(),this.restitution=b.readFloat()},SEA3D.RigidBodyBase.prototype=Object.create(SEA3D.Physics.prototype),SEA3D.RigidBodyBase.prototype.constructor=SEA3D.RigidBodyBase,SEA3D.RigidBody=function(a,b,c){SEA3D.RigidBodyBase.call(this,a,b,c),b.readTags(this.readTag.bind(this))},SEA3D.RigidBody.prototype=Object.create(SEA3D.RigidBodyBase.prototype),SEA3D.RigidBody.prototype.constructor=SEA3D.RigidBody,SEA3D.RigidBody.prototype.type="rb",SEA3D.CarController=function(a,b,c){SEA3D.RigidBodyBase.call(this,a,b,c),this.suspensionStiffness=b.readFloat(),this.suspensionCompression=b.readFloat(),this.suspensionDamping=b.readFloat(),this.maxSuspensionTravelCm=b.readFloat(),this.frictionSlip=b.readFloat(),this.maxSuspensionForce=b.readFloat(),this.dampingCompression=b.readFloat(),this.dampingRelaxation=b.readFloat();var d=b.readUByte();this.wheel=[];for(var e=0;d>e;e++)this.wheel[e]=new SEA3D.CarController.Wheel(b,c);b.readTags(this.readTag.bind(this))},SEA3D.CarController.Wheel=function(a,b){this.data=a,this.sea3d=b;var c=a.readUShort();this.isFront=0!=(1&c),this.target=b.getObject(a.readUInt()),this.pos=a.readVector3(),this.dir=a.readVector3(),this.axle=a.readVector3(),this.radius=a.readFloat(),this.suspensionRestLength=a.readFloat()},SEA3D.CarController.prototype=Object.create(SEA3D.RigidBodyBase.prototype),SEA3D.CarController.prototype.constructor=SEA3D.CarController,SEA3D.CarController.prototype.type="carc",SEA3D.Constraints=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,this.attrib=b.readUShort(),this.disableCollisionsBetweenBodies=this.attrib&!0,this.targetA=c.getObject(b.readUInt()),this.pointA=b.readVector3(),2&this.attrib&&(this.targetB=c.getObject(b.readUInt()),this.pointB=b.readVector3())},SEA3D.P2PConstraint=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,SEA3D.Constraints.call(this,a,b,c)},SEA3D.P2PConstraint.prototype=Object.create(SEA3D.Constraints.prototype),SEA3D.P2PConstraint.prototype.constructor=SEA3D.P2PConstraint,SEA3D.P2PConstraint.prototype.type="p2pc",SEA3D.HingeConstraint=function(a,b,c){SEA3D.Constraints.call(this,a,b,c),this.axisA=b.readVector3(),1&this.attrib&&(this.axisB=b.readVector3()),4&this.attrib&&(this.limit={low:b.readFloat(),high:b.readFloat(),softness:b.readFloat(),biasFactor:b.readFloat(),relaxationFactor:b.readFloat()}),8&this.attrib&&(this.angularMotor={velocity:b.readFloat(),impulse:b.readFloat()})},SEA3D.HingeConstraint.prototype=Object.create(SEA3D.Constraints.prototype),SEA3D.HingeConstraint.prototype.constructor=SEA3D.HingeConstraint,SEA3D.HingeConstraint.prototype.type="hnec",SEA3D.ConeTwistConstraint=function(a,b,c){SEA3D.Constraints.call(this,a,b,c),this.axisA=b.readVector3(),1&this.attrib&&(this.axisB=b.readVector3()),4&this.attrib&&(this.limit={swingSpan1:b.readFloat(),swingSpan2:b.readFloat(),twistSpan:b.readFloat(),softness:b.readFloat(),biasFactor:b.readFloat(),relaxationFactor:b.readFloat()})},SEA3D.ConeTwistConstraint.prototype=Object.create(SEA3D.Constraints.prototype),SEA3D.ConeTwistConstraint.prototype.constructor=SEA3D.ConeTwistConstraint,SEA3D.ConeTwistConstraint.prototype.type="ctwc",SEA3D.PlanarRender=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,this.attrib=b.readUByte(),this.quality=1&this.attrib|2&this.attrib,this.transform=b.readMatrix()},SEA3D.PlanarRender.prototype.type="rttp",SEA3D.CubeRender=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,this.attrib=b.readUByte(),this.quality=1&this.attrib|2&this.attrib,this.position=b.readVector3()},SEA3D.CubeRender.prototype.type="rttc",SEA3D.CubeMap=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,this.transparent=!1;b.readExt();this.faces=[];for(var d=0;6>d;d++){var e=b.readUInt();this.faces[d]=b.concat(b.position,e),b.position+=e}},SEA3D.CubeMap.prototype.type="cmap",SEA3D.JPEG=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,this.transparent=!1},SEA3D.JPEG.prototype.type="jpg",SEA3D.JPEG_XR=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,this.transparent=!0},SEA3D.JPEG_XR.prototype.type="wdp",SEA3D.PNG=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,this.transparent=6==b.getByte(25)},SEA3D.PNG.prototype.type="png",SEA3D.GIF=function(a,b,c){this.name=a,this.data=b,this.sea3d=c,this.transparent=b.getByte(11)>0},SEA3D.GIF.prototype.type="gif",SEA3D.OGG=function(a,b,c){this.name=a,this.data=b,this.sea3d=c},SEA3D.OGG.prototype.type="ogg",SEA3D.MP3=function(a,b,c){this.name=a,this.data=b,this.sea3d=c},SEA3D.MP3.prototype.type="mp3",SEA3D.File=function(a){this.config={streaming:!0,timeLimit:60},a&&(void 0!==a.streaming&&(this.config.streaming=a.streaming),void 0!==a.timeLimit&&(this.config.timeLimit=a.timeLimit)),this.version=SEA3D.VERSION,this.objects=[],this.typeClass={},this.typeRead={},this.typeUnique={},this.position=this.dataPosition=0,this.scope=this,this.addClass(SEA3D.FileInfo,!0),this.addClass(SEA3D.Geometry,!0),this.addClass(SEA3D.GeometryDelta,!0),this.addClass(SEA3D.Mesh),this.addClass(SEA3D.Sprite),this.addClass(SEA3D.Material),this.addClass(SEA3D.Composite),this.addClass(SEA3D.PointLight),this.addClass(SEA3D.DirectionalLight),this.addClass(SEA3D.HemisphereLight),this.addClass(SEA3D.AmbientLight),this.addClass(SEA3D.Skeleton,!0),this.addClass(SEA3D.SkeletonLocal,!0),this.addClass(SEA3D.SkeletonAnimation,!0),this.addClass(SEA3D.JointObject),this.addClass(SEA3D.Camera),this.addClass(SEA3D.OrthographicCamera),this.addClass(SEA3D.Morph,!0),this.addClass(SEA3D.VertexAnimation,!0),this.addClass(SEA3D.CubeMap,!0),this.addClass(SEA3D.Animation),this.addClass(SEA3D.Dummy),this.addClass(SEA3D.Line),this.addClass(SEA3D.SoundPoint),this.addClass(SEA3D.PlanarRender),this.addClass(SEA3D.CubeRender),this.addClass(SEA3D.Actions),this.addClass(SEA3D.Container3D),this.addClass(SEA3D.Properties),this.addClass(SEA3D.TextureURL,!0),this.addClass(SEA3D.Sphere),this.addClass(SEA3D.Box),this.addClass(SEA3D.Cone),this.addClass(SEA3D.Capsule),this.addClass(SEA3D.Cylinder),this.addClass(SEA3D.ConvexGeometry),this.addClass(SEA3D.TriangleGeometry),this.addClass(SEA3D.Compound),this.addClass(SEA3D.RigidBody),this.addClass(SEA3D.P2PConstraint),this.addClass(SEA3D.HingeConstraint),this.addClass(SEA3D.ConeTwistConstraint),this.addClass(SEA3D.CarController),this.addClass(SEA3D.JPEG,!0),this.addClass(SEA3D.JPEG_XR,!0),this.addClass(SEA3D.PNG,!0),this.addClass(SEA3D.GIF,!0),this.addClass(SEA3D.OGG,!0),this.addClass(SEA3D.MP3,!0),this.addClass(SEA3D.JavaScript,!0),this.addClass(SEA3D.JavaScriptMethod,!0),this.addClass(SEA3D.GLSL,!0)},SEA3D.File.CompressionLibs={},SEA3D.File.DecompressionMethod={},SEA3D.File.setDecompressionEngine=function(a,b,c){SEA3D.File.CompressionLibs[a]=b,SEA3D.File.DecompressionMethod[a]=c},SEA3D.File.prototype.addClass=function(a,b){this.typeClass[a.prototype.type]=a,this.typeUnique[a.prototype.type]=b===!0},SEA3D.File.prototype.readHead=function(){if(this.stream.bytesAvailable<16)return!1;if("SEA"!=this.stream.readUTF(3))throw new Error("Invalid SEA3D format.");if(this.sign=this.stream.readUTF(3),this.version=this.stream.readUInt24(),0!=this.stream.readUByte())throw new Error("Protection algorithm not compatible.");if(this.compressionID=this.stream.readUByte(),this.compressionAlgorithm=SEA3D.File.CompressionLibs[this.compressionID],this.decompressionMethod=SEA3D.File.DecompressionMethod[this.compressionID],this.compressionID>0&&!this.decompressionMethod)throw new Error("Compression algorithm not compatible.");return this.length=this.stream.readUInt(),this.dataPosition=this.stream.position,this.objects.length=0,this.state=this.readBody,this.onHead&&this.onHead({file:this,sign:this.sign}),!0},SEA3D.File.prototype.getObject=function(a){return this.objects[a]},SEA3D.File.prototype.readSEAObject=function(){if(this.stream.bytesAvailable<4)return null;var a=this.stream.readUInt(),b=this.stream.position;if(this.stream.bytesAvailable<a)return null;var c=this.stream.readUByte(),d=this.stream.readExt(),e=null,f=1&c?this.stream.readUTF8():"",g=0!=(2&c),h=0!=(4&c);if(8&c){var i=this.stream.readUShort(),j=this.stream.concat(this.stream.position,i);this.stream.position+=i,g&&this.decompressionMethod&&(j.buffer=this.decompressionMethod(j.buffer)),e=j.readProperties(this)}a-=this.stream.position-b,b=this.stream.position;var k,l=this.stream.concat(b,a);return this.typeClass[d]?(g&&this.decompressionMethod&&(l.buffer=this.decompressionMethod(l.buffer)),k=new this.typeClass[d](f,l,this),this.config.streaming&&h&&this.typeRead[d]&&this.typeRead[d].call(this.scope,k)):(k=new SEA3D.Object(f,l,d,this),console.warn('SEA3D: Unknown format "'+d+'" of file "'+f+'". Add a module referring for this format.')),k.streaming=h,k.metadata=e,this.objects.push(this.objects[k.type+"/"+k.name]=k),this.dataPosition=b+a,++this.position,k},SEA3D.File.prototype.isDone=function(){return this.position==this.length},SEA3D.File.prototype.readBody=function(){for(this.timer.update();this.position<this.length;){if(!(this.timer.deltaTime<this.config.timeLimit))return!1;this.stream.position=this.dataPosition;var a=this.readSEAObject();if(!a)return!1;this.dispatchCompleteObject(a)}return this.state=this.readComplete,!0},SEA3D.File.prototype.parse=function(){this.timer=new SEA3D.Timer,this.position=0,isFinite(this.config.timeLimit)?setTimeout(this.parseObject.bind(this),10):this.parseObject()},SEA3D.File.prototype.parseObject=function(){for(this.timer.update();this.position<this.length&&this.timer.deltaTime<this.config.timeLimit;){var a=this.objects[this.position++],b=a.type;this.typeUnique[b]||delete a.tag,a.streaming&&this.typeRead[b]&&void 0==a.tag&&this.typeRead[b].call(this.scope,a)}if(this.position==this.length){var c=this.timer.elapsedTime,d=c+"ms, "+this.objects.length+" objects";this.onParseComplete?this.onParseComplete({file:this,timeTotal:c,message:d}):console.log("SEA3D Parse Complete:",d)}else this.onParseProgress&&this.onParseProgress({file:this,loaded:this.position,total:this.length,progress:this.position/this.length}),setTimeout(this.parseObject.bind(this),10)},SEA3D.File.prototype.readComplete=function(){this.stream.position=this.dataPosition,6202321!=this.stream.readUInt24F()&&console.warn("SEA3D file is corrupted."),delete this.state,this.dispatchComplete()},SEA3D.File.prototype.readState=function(){for(;this.state&&this.state(););this.state&&(setTimeout(this.readState.bind(this),10),this.dispatchProgress())},SEA3D.File.prototype.read=function(a){this.stream=new SEA3D.Stream(a),this.timer=new SEA3D.Timer,this.state=this.readHead,this.readState()},SEA3D.File.prototype.dispatchCompleteObject=function(a){this.onCompleteObject&&this.onCompleteObject({file:this,object:a})},SEA3D.File.prototype.dispatchProgress=function(){this.onProgress&&this.onProgress({file:this,loaded:this.position,total:this.length,progress:this.position/this.length})},SEA3D.File.prototype.dispatchDownloadProgress=function(a,b){this.onDownloadProgress&&this.onDownloadProgress({file:this,loaded:a,total:b,progress:a/b})},SEA3D.File.prototype.dispatchComplete=function(){var a=this.timer.elapsedTime,b=a+"ms, "+this.objects.length+" objects";this.onComplete?this.onComplete({file:this,timeTotal:a,message:b}):console.log("SEA3D:",b)},SEA3D.File.prototype.dispatchError=function(a,b){this.onError?this.onError({file:this,id:a,message:b}):console.error("SEA3D: #"+a,b)},SEA3D.File.prototype.load=function(a){var b=this,c=new XMLHttpRequest;c.open("GET",a,!0),c.responseType="arraybuffer",c.onprogress=function(a){a.lengthComputable&&b.dispatchDownloadProgress(a.loaded,a.total)},c.onreadystatechange=function(){2===c.readyState||3===c.readyState||4===c.readyState&&(200===c.status||0===c.status?b.read(this.response):this.dispatchError(1001,"Couldn't load ["+a+"] ["+c.status+"]"))},c.send()},THREE.SEA3D=function(a){this.config={id:"",scripts:!0,runScripts:!0,autoPlay:!1,dummys:!0,multiplier:1,bounding:!0,audioRolloffFactor:10,lights:!0,useVertexTexture:!0,forceStatic:!1,streaming:!0,timeLimit:10,stageWidth:window?window.innerWidth:1024,stageHeight:window?window.innerHeight:1024},a&&this.loadConfig(a)},THREE.SEA3D.prototype={constructor:THREE.SEA3D,set container(a){this.config.container=a},get container(){return this.config.container}},Object.assign(THREE.SEA3D.prototype,THREE.EventDispatcher.prototype),THREE.SEA3D.BACKGROUND_COLOR=3355443,THREE.SEA3D.HELPER_COLOR=10140133,THREE.SEA3D.RTT_SIZE=512,THREE.SEA3D.Domain=function(a,b,c){this.id=a,this.objects=b,this.container=c,this.scripts=[],this.global={},this.scriptTargets=[],this.events=new THREE.EventDispatcher},THREE.SEA3D.Domain.prototype={constructor:THREE.SEA3D.Domain,add:function(a){this.scripts.push(a)},remove:function(a){this.scripts.splice(this.scripts.indexOf(a),1)},contains:function(a){return-1!=this.scripts.indexOf(a)},addEvent:function(a,b){this.events.addEventListener(a,b)},hasEvent:function(a,b){return this.events.hasEventListener(a,b)},removeEvent:function(a,b){this.events.removeEventListener(a,b)},print:function(){console.log.apply(console,arguments)},watch:function(){console.log.apply(console,"watch:",arguments)},runScripts:function(){for(var a=0;a<this.scriptTargets.length;a++)this.runJSMList(this.scriptTargets[a])},runJSMList:function(a){for(var b=a.scripts,c=0;c<b.length;c++)this.runJSM(a,b[c]);return b},runJSM:function(a,b){void 0==a.local&&(a.local={});var c={print:this.print,watch:this.watch,sea3d:this,scene:this.container,source:new THREE.SEA3D.ScriptDomain(this,a instanceof THREE.SEA3D.Domain)};Object.freeze(c.source),THREE.SEA3D.ScriptHandler.add(c.source);try{this.methods[b.method](c,this.getReference,this.global,a.local,a,b.params)}catch(d){console.error('SEA3D JavaScript: Error running method "'+b.method+'".'),console.error(d)}},getReference:function(ns){return eval(ns)},disposeList:function(a){if(a&&a.length){a=a.concat();for(var b=a.length;b--;)a[b].dispose()}},dispatchEvent:function(a){a.domain=this;for(var b=this.scripts.concat(),c=b.length;c--;)b[c].dispatchEvent(a);this.events.dispatchEvent(a)},dispose:function(){for(this.disposeList(this.scripts);this.container.children.length;)this.container.remove(this.container.children[0]);for(var a=THREE.SEA3D.EXTENSIONS_DOMAIN.length;a--;){var b=THREE.SEA3D.EXTENSIONS_DOMAIN[a];b.dispose&&b.dispose.call(this)}this.disposeList(this.materials),this.disposeList(this.dummys),this.dispatchEvent({type:"dispose"})}},THREE.SEA3D.DomainManager=function(a){this.domains=[],this.autoDisposeRootDomain=void 0==a},THREE.SEA3D.DomainManager.prototype={constructor:THREE.SEA3D.DomainManager,onDisposeDomain:function(a){this.remove(a.domain),this.autoDisposeRootDomain&&1==this.domains.length&&this.dispose()},add:function(a){this._onDisposeDomain=this._onDisposeDomain||this.onDisposeDomain.bind(this),a.on("dispose",this._onDisposeDomain),this.domains.push(a),this.textures=this.textures||a.textures,this.cubemaps=this.cubemaps||a.cubemaps,this.geometries=this.geometries||a.geometries},remove:function(a){a.removeEvent("dispose",this._onDisposeDomain),this.domains.splice(this.domains.indexOf(a),1)},contains:function(a){return-1!=this.domains.indexOf(a)},disposeList:function(a){if(a&&a.length){a=a.concat();for(var b=a.length;b--;)a[b].dispose()}},dispose:function(){this.disposeList(this.domains),this.disposeList(this.textures),this.disposeList(this.cubemaps),this.disposeList(this.geometries)}},THREE.SEA3D.ScriptDomain=function(a,b){a=a||new THREE.SEA3D.Domain,a.add(this);var c=new THREE.EventDispatcher;this.getId=function(){return a.id},this.isRoot=function(){return b},this.addEvent=function(a,b){c.addEventListener(a,b)},this.hasEvent=function(a,b){return c.hasEventListener(a,b)},this.removeEvent=function(a,b){c.removeEventListener(a,b)},this.dispatchEvent=function(a){a.script=this,c.dispatchEvent(a)},this.dispose=function(){a.remove(this),b&&a.dispose(),this.dispatchEvent({type:"dispose"})}},THREE.SEA3D.ScriptManager=function(){this.scripts=[];var a=function(a){this.remove(a.script)}.bind(this);this.add=function(b){b.addEvent("dispose",a),this.scripts.push(b)},this.remove=function(b){b.removeEvent("dispose",a),this.scripts.splice(this.scripts.indexOf(b),1)},this.contains=function(a){return this.scripts.indexOf(a)>-1},this.dispatchEvent=function(a){for(var b=this.scripts.concat(),c=b.length;c--;)b[c].dispatchEvent(a)}},THREE.SEA3D.ScriptHandler=new THREE.SEA3D.ScriptManager,THREE.SEA3D.ScriptHandler.dispatchUpdate=function(a){this.dispatchEvent({type:"update",delta:a})},THREE.SEA3D.Animator=function(a,b){this.clips=a,this.updateAnimations(b)},THREE.SEA3D.Animator.prototype.update=function(a){return this.mixer.update(a),this.currentAnimationAction.paused&&(this.pause(),this.currentAnimationData.onComplete&&this.currentAnimationData.onComplete(this)),this},THREE.SEA3D.Animator.prototype.updateAnimations=function(a){this.playing&&this.stop(),this.mixer&&THREE.SEA3D.AnimationHandler.removeAnimator(this),this.mixer=a,this.relative=!1,this.playing=!1,this.timeScale=1,this.animations=[],this.animationsData={},this.clips=this instanceof THREE.SEA3D.Animator?this.clips:this.geometry.animations;for(var b=0,c=this.clips;b<c.length;b++){var d=c[b].name;this.animations[d]=this.animations[b]=c[b],this.animationsData[d]=this.animationsData[b]={}}},THREE.SEA3D.Animator.prototype.getStateByName=function(a){return this.animations.indexOf(this.animations[a])},THREE.SEA3D.Animator.prototype.getStateNameByIndex=function(a){return this.animations[a].name},THREE.SEA3D.Animator.prototype.pause=function(){this.playing&&this.currentAnimation&&(THREE.SEA3D.AnimationHandler.removeAnimator(this),this.playing=!1)},THREE.SEA3D.Animator.prototype.resume=function(){return!this.playing&&this.currentAnimation&&(THREE.SEA3D.AnimationHandler.addAnimator(this),this.playing=!0),this},THREE.SEA3D.Animator.prototype.setTimeScale=function(a){this.timeScale=a,this.currentAnimationAction&&this.updateTimeScale()},THREE.SEA3D.Animator.prototype.getTimeScale=function(){return this.timeScale},THREE.SEA3D.Animator.prototype.updateTimeScale=function(){this.currentAnimationAction.setEffectiveTimeScale(this.timeScale*(this.currentAnimation?this.currentAnimation.timeScale:1))},THREE.SEA3D.Animator.prototype.play=function(a,b,c,d){var e=this.animations[a];if(e==this.currentAnimation)return void 0===c&&e.loop||(this.currentAnimationAction.time=void 0!==c?c:this.currentAnimationAction.timeScale>=0?0:this.currentAnimation.duration),this.currentAnimationAction.setEffectiveWeight(void 0!==d?d:1),this.currentAnimationAction.paused=!1,this.resume();if(!e)throw new Error('Animation "'+a+'" not found.');return this.previousAnimation=this.currentAnimation,this.currentAnimation=e,this.previousAnimationAction=this.currentAnimationAction,this.currentAnimationAction=this.mixer.clipAction(e).setLoop(e.loop?THREE.LoopRepeat:THREE.LoopOnce,1/0).reset(),this.currentAnimationAction.clampWhenFinished=!0,this.currentAnimationAction.paused=!1,this.previousAnimationData=this.currentAnimationData,this.currentAnimationData=this.animationsData[a],this.updateTimeScale(),void 0===c&&e.loop||(this.currentAnimationAction.time=void 0!==c?c:this.currentAnimationAction.timeScale>=0?0:this.currentAnimation.duration),this.currentAnimationAction.setEffectiveWeight(void 0!==d?d:1),this.currentAnimationAction.play(),this.playing||this.mixer.update(0),this.playing=!0,this.previousAnimation&&this.previousAnimationAction.crossFadeTo(this.currentAnimationAction,b||0,!0),THREE.SEA3D.AnimationHandler.addAnimator(this),this},THREE.SEA3D.Animator.prototype.stop=function(){return this.currentAnimation&&(this.currentAnimationAction.stop(),THREE.SEA3D.AnimationHandler.removeAnimator(this),this.previousAnimation=this.currentAnimation,this.previousAnimationData=this.currentAnimationData,this.previousAnimationAction=this.currentAnimationAction,delete this.currentAnimationAction,delete this.currentAnimationData,delete this.currentAnimation,this.playing=!1),this},THREE.SEA3D.Animator.prototype.setRelative=function(a){this.relative!=a&&(this.stop(),this.relative=a)},THREE.SEA3D.Animator.prototype.getRelative=function(){return this.relative},THREE.SEA3D.Object3DAnimator=function(a,b){this.object3d=b,THREE.SEA3D.Animator.call(this,a,new THREE.AnimationMixer(b))},THREE.SEA3D.Object3DAnimator.prototype=Object.create(THREE.SEA3D.Animator.prototype),THREE.SEA3D.Object3DAnimator.prototype.constructor=THREE.SEA3D.Object3DAnimator,THREE.SEA3D.Object3DAnimator.prototype.stop=function(){if(this.currentAnimation){var a=this.object3d.animate;a&&this instanceof THREE.SEA3D.Object3DAnimator&&(a.position.set(0,0,0),a.quaternion.set(0,0,0,1),a.scale.set(1,1,1))}THREE.SEA3D.Animator.prototype.stop.call(this)},THREE.SEA3D.Object3DAnimator.prototype.setRelative=function(a){THREE.SEA3D.Animator.prototype.setRelative.call(this,a),this.object3d.setAnimator(this.relative),this.updateAnimations(new THREE.AnimationMixer(this.relative?this.object3d.animate:this.object3d))},THREE.SEA3D.CameraAnimator=function(a,b){THREE.SEA3D.Object3DAnimator.call(this,a,b)},THREE.SEA3D.CameraAnimator.prototype=Object.create(THREE.SEA3D.Object3DAnimator.prototype),THREE.SEA3D.CameraAnimator.prototype.constructor=THREE.SEA3D.CameraAnimator,THREE.SEA3D.SoundAnimator=function(a,b){THREE.SEA3D.Object3DAnimator.call(this,a,b)},THREE.SEA3D.SoundAnimator.prototype=Object.create(THREE.SEA3D.Object3DAnimator.prototype),THREE.SEA3D.SoundAnimator.prototype.constructor=THREE.SEA3D.SoundAnimator,THREE.SEA3D.LightAnimator=function(a,b){THREE.SEA3D.Object3DAnimator.call(this,a,b)},THREE.SEA3D.LightAnimator.prototype=Object.create(THREE.SEA3D.Object3DAnimator.prototype),THREE.SEA3D.LightAnimator.prototype.constructor=THREE.SEA3D.LightAnimator,THREE.SEA3D.Object3D=function(){THREE.Object3D.call(this)},THREE.SEA3D.Object3D.prototype=Object.create(THREE.Object3D.prototype),THREE.SEA3D.Object3D.prototype.constructor=THREE.SEA3D.Object3D,THREE.SEA3D.Object3D.prototype.updateAnimateMatrix=function(a){this.matrixAutoUpdate===!0&&this.updateMatrix(),this.matrixWorldNeedsUpdate!==!0&&a!==!0||(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.animate.updateMatrix(),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.animate.matrix),this.matrixWorldNeedsUpdate=!1,a=!0);for(var b=0,c=this.children.length;c>b;b++)this.children[b].updateMatrixWorld(a)},THREE.SEA3D.Object3D.prototype.setAnimator=function(a){this.getAnimator()!=a&&(a?(this.animate=new THREE.Object3D,this.updateMatrixWorld=THREE.SEA3D.Object3D.prototype.updateAnimateMatrix):(delete this.animate,this.updateMatrixWorld=THREE.Object3D.prototype.updateMatrixWorld),this.matrixWorldNeedsUpdate=!0)},THREE.SEA3D.Object3D.prototype.getAnimator=function(){return void 0!=this.animate},THREE.SEA3D.Dummy=function(a,b,c){this.width=void 0!=a?a:100,this.height=void 0!=b?b:100,this.depth=void 0!=c?c:100;var d=new THREE.BoxGeometry(this.width,this.height,this.depth,1,1,1);d.computeBoundingBox(),d.computeBoundingSphere(),THREE.Mesh.call(this,d,THREE.SEA3D.Dummy.MATERIAL)},THREE.SEA3D.Dummy.prototype=Object.create(THREE.Mesh.prototype),THREE.SEA3D.Dummy.prototype.constructor=THREE.SEA3D.Dummy,Object.assign(THREE.SEA3D.Dummy.prototype,THREE.SEA3D.Object3D.prototype),THREE.SEA3D.Dummy.MATERIAL=new THREE.MeshBasicMaterial({wireframe:!0,color:THREE.SEA3D.HELPER_COLOR}),THREE.SEA3D.Dummy.prototype.copy=function(a){return THREE.Mesh.prototype.copy.call(this,a),this.props=a.props,this.scripts=a.scripts,this.animator&&(this.animator=a.animator.clone(this)),this},THREE.SEA3D.Dummy.prototype.dispose=function(){this.geometry.dispose()},THREE.SEA3D.Mesh=function(a,b){THREE.Mesh.call(this,a,b)},THREE.SEA3D.Mesh.prototype=Object.create(THREE.Mesh.prototype),THREE.SEA3D.Mesh.prototype.constructor=THREE.SEA3D.Mesh,Object.assign(THREE.SEA3D.Mesh.prototype,THREE.SEA3D.Object3D.prototype),THREE.SEA3D.Mesh.prototype.setWeight=function(a,b){this.morphTargetInfluences[this.morphTargetDictionary[a]]=b},THREE.SEA3D.Mesh.prototype.getWeight=function(a){return this.morphTargetInfluences[this.morphTargetDictionary[a]]},THREE.SEA3D.Mesh.prototype.copy=function(a){return THREE.Mesh.prototype.copy.call(this,a),this.props=a.props,this.scripts=a.scripts,this.animator&&(this.animator=a.animator.clone(this)),this},THREE.SEA3D.SkinnedMesh=function(a,b,c){THREE.SkinnedMesh.call(this,a,b,c),this.updateAnimations(new THREE.AnimationMixer(this))},THREE.SEA3D.SkinnedMesh.prototype=Object.create(THREE.SkinnedMesh.prototype),THREE.SEA3D.SkinnedMesh.prototype.constructor=THREE.SEA3D.SkinnedMesh,Object.assign(THREE.SEA3D.SkinnedMesh.prototype,THREE.SEA3D.Object3D.prototype),Object.assign(THREE.SEA3D.SkinnedMesh.prototype,THREE.SEA3D.Animator.prototype),THREE.SEA3D.SkinnedMesh.prototype.boneByName=function(a){for(var b=this.skeleton.bones,c=0,d=b.length;d>c;c++)if(a==b[c].name)return b[c]},THREE.SEA3D.SkinnedMesh.prototype.copy=function(a){return THREE.SkinnedMesh.prototype.copy.call(this,a),this.props=a.props,this.scripts=a.scripts,this.animator&&(this.animator=a.animator.clone(this)),this},THREE.SEA3D.VertexAnimationMesh=function(a,b){THREE.Mesh.call(this,a,b),this.type="MorphAnimMesh",this.updateAnimations(new THREE.AnimationMixer(this))},THREE.SEA3D.VertexAnimationMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.SEA3D.VertexAnimationMesh.prototype.constructor=THREE.SEA3D.VertexAnimationMesh,Object.assign(THREE.SEA3D.VertexAnimationMesh.prototype,THREE.SEA3D.Object3D.prototype),Object.assign(THREE.SEA3D.VertexAnimationMesh.prototype,THREE.SEA3D.Animator.prototype),THREE.SEA3D.VertexAnimationMesh.prototype.copy=function(a){return THREE.Mesh.prototype.copy.call(this,a),this.props=a.props,this.scripts=a.scripts,this.animator&&(this.animator=a.animator.clone(this)),this},THREE.SEA3D.Camera=function(a,b,c,d){THREE.PerspectiveCamera.call(this,a,b,c,d)},THREE.SEA3D.Camera.prototype=Object.create(THREE.PerspectiveCamera.prototype),THREE.SEA3D.Camera.prototype.constructor=THREE.SEA3D.Camera,Object.assign(THREE.SEA3D.Camera.prototype,THREE.SEA3D.Object3D.prototype),THREE.SEA3D.Camera.prototype.copy=function(a){return THREE.PerspectiveCamera.prototype.copy.call(this,a),this.props=a.props,this.scripts=a.scripts,this.animator&&(this.animator=a.animator.clone(this)),this},THREE.SEA3D.OrthographicCamera=function(a,b,c,d,e,f){THREE.OrthographicCamera.call(this,a,b,c,d,e,f)},THREE.SEA3D.OrthographicCamera.prototype=Object.create(THREE.OrthographicCamera.prototype),THREE.SEA3D.OrthographicCamera.prototype.constructor=THREE.SEA3D.OrthographicCamera,Object.assign(THREE.SEA3D.OrthographicCamera.prototype,THREE.SEA3D.Object3D.prototype),THREE.SEA3D.OrthographicCamera.prototype.copy=function(a){return THREE.OrthographicCamera.prototype.copy.call(this,a),this.props=a.props,this.scripts=a.scripts,this.animator&&(this.animator=a.animator.clone(this)),this},THREE.SEA3D.PointLight=function(a,b,c,d){THREE.PointLight.call(this,a,b,c,d)},THREE.SEA3D.PointLight.prototype=Object.create(THREE.PointLight.prototype),THREE.SEA3D.PointLight.prototype.constructor=THREE.SEA3D.PointLight,Object.assign(THREE.SEA3D.PointLight.prototype,THREE.SEA3D.Object3D.prototype),THREE.SEA3D.PointLight.prototype.copy=function(a){return THREE.PointLight.prototype.copy.call(this,a),this.props=a.props,this.scripts=a.scripts,this.animator&&(this.animator=a.animator.clone(this)),this},THREE.SEA3D.AnimationHandler={animators:[],update:function(a){for(var b=0;b<this.animators.length;)this.animators[b++].update(a)},addAnimator:function(a){var b=this.animators.indexOf(a);-1===b&&this.animators.push(a)},removeAnimator:function(a){var b=this.animators.indexOf(a);-1!==b&&this.animators.splice(this.animators.indexOf(a),1)}},THREE.SEA3D.MTXBUF=new THREE.Matrix4,THREE.SEA3D.VECBUF=new THREE.Vector3,THREE.SEA3D.QUABUF=new THREE.Quaternion,THREE.SEA3D.prototype.setShadowMap=function(a){a.shadow.mapSize.width=2048,a.shadow.mapSize.height=1024,a.castShadow=!0,a.shadow.camera.left=-200,a.shadow.camera.right=200,a.shadow.camera.top=200,a.shadow.camera.bottom=-200,a.shadow.camera.near=1,a.shadow.camera.far=3e3,a.shadow.camera.fov=45,a.shadow.bias=-.001},THREE.SEA3D.Domain.prototype.getMesh=THREE.SEA3D.prototype.getMesh=function(a){
return this.objects["m3d/"+a]},THREE.SEA3D.Domain.prototype.getDummy=THREE.SEA3D.prototype.getDummy=function(a){return this.objects["dmy/"+a]},THREE.SEA3D.Domain.prototype.getLine=THREE.SEA3D.prototype.getLine=function(a){return this.objects["line/"+a]},THREE.SEA3D.Domain.prototype.getSound3D=THREE.SEA3D.prototype.getSound3D=function(a){return this.objects["sn3d/"+a]},THREE.SEA3D.Domain.prototype.getMaterial=THREE.SEA3D.prototype.getMaterial=function(a){return this.objects["mat/"+a]},THREE.SEA3D.Domain.prototype.getLight=THREE.SEA3D.prototype.getLight=function(a){return this.objects["lht/"+a]},THREE.SEA3D.Domain.prototype.getGLSL=THREE.SEA3D.prototype.getGLSL=function(a){return this.objects["glsl/"+a]},THREE.SEA3D.Domain.prototype.getCamera=THREE.SEA3D.prototype.getCamera=function(a){return this.objects["cam/"+a]},THREE.SEA3D.Domain.prototype.getTexture=THREE.SEA3D.prototype.getTexture=function(a){return this.objects["tex/"+a]},THREE.SEA3D.Domain.prototype.getCubeMap=THREE.SEA3D.prototype.getCubeMap=function(a){return this.objects["cmap/"+a]},THREE.SEA3D.Domain.prototype.getJointObject=THREE.SEA3D.prototype.getJointObject=function(a){return this.objects["jnt/"+a]},THREE.SEA3D.Domain.prototype.getContainer3D=THREE.SEA3D.prototype.getContainer3D=function(a){return this.objects["c3d/"+a]},THREE.SEA3D.Domain.prototype.getSprite=THREE.SEA3D.prototype.getSprite=function(a){return this.objects["m2d/"+a]},THREE.SEA3D.Domain.prototype.getProperties=THREE.SEA3D.prototype.getProperties=function(a){return this.objects["prop/"+a]},THREE.SEA3D.prototype.isPowerOfTwo=function(a){return a?(a&-a)==a:!1},THREE.SEA3D.prototype.nearestPowerOfTwo=function(a){return Math.pow(2,Math.round(Math.log(a)/Math.LN2))},THREE.SEA3D.prototype.updateTransform=function(a,b){var c=THREE.SEA3D.MTXBUF,d=THREE.SEA3D.VECBUF;b.transform?c.elements.set(b.transform):c.makeTranslation(b.position.x,b.position.y,b.position.z),a.position.setFromMatrixPosition(c),a.scale.setFromMatrixScale(c),c.scale(d.set(1/a.scale.x,1/a.scale.y,1/a.scale.z)),a.rotation.setFromRotationMatrix(c),(this.config.forceStatic||b.isStatic)&&(a.updateMatrix(),a.matrixAutoUpdate=!1)},THREE.SEA3D.prototype.toVector3=function(a){return new THREE.Vector3(a.x,a.y,a.z)},THREE.SEA3D.prototype.updateScene=function(){if(void 0!=this.materials)for(var a=0,b=this.materials.length;b>a;++a)this.materials[a].needsUpdate=!0},THREE.SEA3D.prototype.addSceneObject=function(a){var b=a.tag;b.visible=a.visible,a.parent?a.parent.tag.add(b):this.config.container&&this.config.container.add(b),a.properties&&(b.props=a.properties.tag),a.scripts&&(b.scripts=this.getJSMList(b,a.scripts),this.config.runScripts&&this.domain.runJSMList(b))},THREE.SEA3D.prototype.createObjectURL=function(a,b){return(window.URL||window.webkitURL).createObjectURL(new Blob([a],{type:b}))},THREE.SEA3D.prototype.bufferToTexture=function(a){return this.createObjectURL(a,"image")},THREE.SEA3D.prototype.bufferToSound=function(a){return this.createObjectURL(a,"audio")},THREE.SEA3D.prototype.applyDefaultAnimation=function(a,b){for(var c=a.tag,d=0,e=a.animations?a.animations.length:0;e>d;d++){var f=a.animations[d];switch(f.tag.type){case SEA3D.Animation.prototype.type:return c.animator=new b(f.tag.tag,c),c.animator.setRelative(f.relative),this.config.autoPlay&&c.animator.play(0),c.animator}}},THREE.SEA3D.prototype.readAnimation=function(a){for(var b=[],c=1e3/a.frameRate/1e3,d=0;d<a.sequence.length;d++){for(var e=a.sequence[d],f=[],g=0;g<a.dataList.length;g++){var h,i,j=a.dataList[g],k=j.data,l=e.start*j.blockSize,m=l+e.count*j.blockSize,n=e.intrpl?THREE.InterpolateLinear:!1,o=null;switch(j.kind){case SEA3D.Animation.POSITION:o=".position";break;case SEA3D.Animation.ROTATION:o=".quaternion";break;case SEA3D.Animation.SCALE:o=".scale";break;case SEA3D.Animation.COLOR:o=".color";break;case SEA3D.Animation.MULTIPLIER:o=".intensity";break;case SEA3D.Animation.FOV:o=".fov"}if(o)switch(j.type){case SEA3D.Stream.BYTE:case SEA3D.Stream.UBYTE:case SEA3D.Stream.INT:case SEA3D.Stream.UINT:case SEA3D.Stream.FLOAT:case SEA3D.Stream.DOUBLE:case SEA3D.Stream.DECIMAL:for(var p=k.subarray(l,m),i=new Float32Array(p.length),q=0,h=0;q<i.length;q++)i[q]=h,h+=c;f.push(new THREE.VectorKeyframeTrack(o,i,p,n));break;case SEA3D.Stream.VECTOR3D:for(var p=k.subarray(l,m),i=new Float32Array(p.length/j.blockSize),q=0,h=0;q<i.length;q++)i[q]=h,h+=c;f.push(new THREE.VectorKeyframeTrack(o,i,p,n));break;case SEA3D.Stream.VECTOR4D:for(var p=k.subarray(l,m),i=new Float32Array(p.length/j.blockSize),q=0,h=0;q<i.length;q++)i[q]=h,h+=c;f.push(new THREE.QuaternionKeyframeTrack(o,i,p,n));break;case SEA3D.Stream.INT24:case SEA3D.Stream.UINT24:for(var p=new Float32Array(3*(m-l)),i=new Float32Array(p.length/3),q=0,h=0;q<i.length;q++)p[3*q]=(k[q]>>16&255)/255,p[3*q+1]=(k[q]>>8&255)/255,p[3*q+2]=(255&k[q])/255,i[q]=h,h+=c;f.push(new THREE.VectorKeyframeTrack(o,i,p,n))}}var r=new THREE.AnimationClip(e.name,-1,f);r.loop=e.repeat,r.timeScale=1,b.push(r)}this.domain.animationClips=this.animationClips=this.animationClips||[],this.animationClips.push(this.objects[a.name+".#anm"]=a.tag=b)},THREE.SEA3D.prototype.readGeometryBuffer=function(a){for(var b=new THREE.BufferGeometry,c=0;c<a.groups.length;c++){var d=a.groups[c];b.addGroup(d.start,d.count,c)}b.setIndex(new THREE.BufferAttribute(a.indexes,1)),b.addAttribute("position",new THREE.BufferAttribute(a.vertex,3)),a.uv&&(b.addAttribute("uv",new THREE.BufferAttribute(a.uv[0],2)),a.uv.length>1&&b.addAttribute("uv2",new THREE.BufferAttribute(a.uv[1],2))),a.normal?b.addAttribute("normal",new THREE.BufferAttribute(a.normal,3)):b.computeVertexNormals(),a.tangent4&&b.addAttribute("tangent",new THREE.BufferAttribute(a.tangent4,4)),a.color&&b.addAttribute("color",new THREE.BufferAttribute(a.color[0],a.numColor)),a.joint&&(b.addAttribute("skinIndex",new THREE.Float32Attribute(a.joint,a.jointPerVertex)),b.addAttribute("skinWeight",new THREE.Float32Attribute(a.weight,a.jointPerVertex))),this.config.bounding&&(b.computeBoundingBox(),b.computeBoundingSphere()),b.name=a.name,this.domain.geometries=this.geometries=this.geometries||[],this.geometries.push(this.objects["geo/"+a.name]=a.tag=b)},THREE.SEA3D.prototype.readDummy=function(a){var b=new THREE.SEA3D.Dummy(a.width,a.height,a.depth);b.name=a.name,this.domain.dummys=this.dummys=this.dummys||[],this.dummys.push(this.objects["dmy/"+a.name]=a.tag=b),this.addSceneObject(a),this.updateTransform(b,a),this.applyDefaultAnimation(a,THREE.SEA3D.Object3DAnimator)},THREE.SEA3D.prototype.readLine=function(a){var b=new THREE.BufferGeometry;a.closed&&a.vertex.push(a.vertex[0],a.vertex[1],a.vertex[2]),b.addAttribute("position",new THREE.BufferAttribute(new Float32Array(a.vertex),3));var c=new THREE.Line(b,new THREE.LineBasicMaterial({color:THREE.SEA3D.HELPER_COLOR,linewidth:3}));c.name=a.name,this.lines=this.lines||[],this.lines.push(this.objects["line/"+a.name]=a.tag=c),this.addSceneObject(a),this.updateTransform(c,a),this.applyDefaultAnimation(a,THREE.SEA3D.Object3DAnimator)},THREE.SEA3D.prototype.readContainer3D=function(a){var b=new THREE.SEA3D.Object3D;this.domain.containers=this.containers=this.containers||[],this.containers.push(this.objects["c3d/"+a.name]=a.tag=b),this.addSceneObject(a),this.updateTransform(b,a),this.applyDefaultAnimation(a,THREE.SEA3D.Object3DAnimator)},THREE.SEA3D.prototype.readSprite=function(a){var b;a.material&&(a.material.tag.sprite?b=a.material.tag.sprite:(b=a.material.tag.sprite=new THREE.SpriteMaterial,this.setBlending(b,a.blendMode),b.map=a.material.tag.map,b.map.flipY=!0,b.color.set(a.material.tag.color),b.opacity=a.material.tag.opacity,b.blending=a.material.tag.blending,b.fog=a.material.receiveFog));var c=new THREE.Sprite(b);c.name=a.name,this.domain.sprites=this.sprites=this.sprites||[],this.sprites.push(this.objects["m2d/"+a.name]=a.tag=c),this.addSceneObject(a),this.updateTransform(c,a),c.scale.set(a.width,a.height,1)},THREE.SEA3D.prototype.readMesh=function(a){var b,c,d,e,f,g,h,i,j=a.geometry.tag;for(b=0,c=a.modifiers?a.modifiers.length:0;c>b;b++){var k=a.modifiers[b];switch(k.type){case SEA3D.Skeleton.prototype.type:case SEA3D.SkeletonLocal.prototype.type:f=k,j.bones=f.tag;break;case SEA3D.Morph.prototype.type:i=k,j.morphAttributes=i.tag.attribs,j.morphTargets=i.tag.targets}}for(b=0,c=a.animations?a.animations.length:0;c>b;b++){var l=a.animations[b];switch(l.tag.type){case SEA3D.SkeletonAnimation.prototype.type:g=l.tag,j.animations=this.getSkeletonAnimation(g,f);break;case SEA3D.VertexAnimation.prototype.type:h=l.tag,j.morphAttributes=h.tag.attribs,j.morphTargets=h.tag.targets,j.animations=h.tag.animations}}var m=void 0!=i||void 0!=h,n=i&&void 0!=i.tag.attribs.normal||h&&void 0!=h.tag.attribs.normal;if(a.material)if(a.material.length>1){var o=[];for(b=0;b<a.material.length;b++)o[b]=a.material[b].tag,o[b].skinning=void 0!=f,o[b].morphTargets=m,o[b].morphNormals=n,o[b].vertexColors=a.geometry.color?THREE.VertexColors:THREE.NoColors;e=new THREE.MultiMaterial(o)}else e=a.material[0].tag,e.skinning=void 0!=f,e.morphTargets=m,e.morphNormals=n,e.vertexColors=a.geometry.color?THREE.VertexColors:THREE.NoColors;f?(d=new THREE.SEA3D.SkinnedMesh(j,e,this.config.useVertexTexture),this.config.autoPlay&&g&&d.play(0)):h?(d=new THREE.SEA3D.VertexAnimationMesh(j,e,h.frameRate),this.config.autoPlay&&d.play(0)):d=new THREE.SEA3D.Mesh(j,e),d.name=a.name,d.castShadow=a.castShadows,d.receiveShadow=a.material?a.material[0].receiveShadows:!0,this.domain.meshes=this.meshes=this.meshes||[],this.meshes.push(this.objects["m3d/"+a.name]=a.tag=d),this.addSceneObject(a),this.updateTransform(d,a),this.applyDefaultAnimation(a,THREE.SEA3D.Object3DAnimator)},THREE.SEA3D.prototype.readSoundPoint=function(a){this.audioListener||(this.audioListener=new THREE.AudioListener,this.config.container&&this.config.container.add(this.audioListener));var b=new THREE.SEA3D.PointSound(this.audioListener);(new THREE.AudioLoader).load(a.sound.tag,function(a){b.setBuffer(a)}),b.autoplay=a.autoPlay,b.setLoop(a.autoPlay),b.setVolume(a.volume),b.setRefDistance(a.distance),b.setRolloffFactor(this.config.audioRolloffFactor),b.name=a.name,this.domain.sounds3d=this.sounds3d=this.sounds3d||[],this.sounds3d.push(this.objects["sn3d/"+a.name]=a.tag=b),this.addSceneObject(a),this.updateTransform(b,a),this.applyDefaultAnimation(a,THREE.SEA3D.SoundAnimator)},THREE.SEA3D.prototype.readCubeRender=function(a){var b=new THREE.CubeCamera(.1,5e3,THREE.SEA3D.RTT_SIZE);b.renderTarget.cubeCamera=b,this.domain.cubeRenderers=this.cubeRenderers=this.cubeRenderers||[],this.cubeRenderers.push(this.objects["rttc/"+a.name]=a.tag=b.renderTarget),this.addSceneObject(a),this.updateTransform(b,a),this.applyDefaultAnimation(a,THREE.SEA3D.Object3DAnimator)},THREE.SEA3D.prototype.readImage=function(a){var b=new Image,c=new THREE.Texture;c.name=a.name,c.wrapS=c.wrapT=THREE.RepeatWrapping,c.flipY=!1,c.image=b,b.onload=function(){c.needsUpdate=!0},b.src=this.bufferToTexture(a.data.buffer),this.domain.textures=this.textures=this.textures||[],this.textures.push(this.objects["tex/"+a.name]=a.tag=c)},THREE.SEA3D.prototype.readCubeMap=function(a){var b=[],c=new THREE.CubeTexture,d=[];d[0]=a.faces[1],d[1]=a.faces[0],d[2]=a.faces[3],d[3]=a.faces[2],d[4]=a.faces[5],d[5]=a.faces[4],b.loadedCount=0,c.name=a.name,c.image=b,c.flipY=!1;for(var e=0,f=d.length;f>e;++e){var g=new Image;b[e]=g,g.onload=function(){6==++b.loadedCount&&(c.needsUpdate=!0)},g.src=this.bufferToTexture(d[e].buffer)}this.domain.cubemaps=this.cubemaps=this.cubemaps||[],this.cubemaps.push(this.objects["cmap/"+a.name]=a.tag=c)},THREE.SEA3D.prototype.readSound=function(a){var b=this.bufferToSound(a.data.buffer);this.domain.sounds=this.sounds=this.sounds||[],this.sounds.push(this.objects["snd/"+a.name]=a.tag=b)},THREE.SEA3D.prototype.readTextureURL=function(a){var b=(new THREE.TextureLoader).load(a.url);b.name=a.name,b.wrapS=b.wrapT=THREE.RepeatWrapping,b.flipY=!1,this.domain.textures=this.textures=this.textures||[],this.textures.push(this.objects["tex/"+a.name]=a.tag=b)},THREE.SEA3D.prototype.getJSMList=function(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.tag.type==SEA3D.JavaScriptMethod.prototype.type&&c.push(e)}return this.domain.scriptTargets=this.scriptTargets=this.scriptTargets||[],this.scriptTargets.push(a),c},THREE.SEA3D.prototype.readJavaScriptMethod=function(sea){try{var src="(function() {\nvar $METHOD = {}\n",declare='function($INC, $REF, global, local, $his, $PARAM) {\nvar watch = $INC["watch"],\nscene = $INC["scene"],\nsea3d = $INC["sea3d"],\nprint = $INC["print"];\n';declare+='var $SRC = $INC["source"],\naddEvent = $SRC.addEvent.bind( $SRC ),\nhasEvent = $SRC.hasEvent.bind( $SRC ),\ndispatchEvent = $SRC.dispatchEvent.bind( $SRC ),\nremoveEvent = $SRC.removeEvent.bind( $SRC ),\ndispose = $SRC.dispose.bind( $SRC );\n';for(var name in sea.methods)src+='$METHOD["'+name+'"] = '+declare+sea.methods[name].src+"}\n";src+="return $METHOD; })",this.domain.methods=eval(src)()}catch(e){console.error('SEA3D JavaScriptMethod: Error running "'+sea.name+'".'),console.error(e)}},THREE.SEA3D.prototype.readGLSL=function(a){this.domain.glsl=this.glsl=this.glsl||[],this.glsl.push(this.objects["glsl/"+a.name]=a.tag=a.src)},THREE.SEA3D.prototype.materialTechnique=function(){var a={};return a.onComplete=function(a,b){(b.alpha<1||a.blending>THREE.NormalBlending)&&(a.opacity=b.alpha,a.transparent=!0)},a[SEA3D.Material.PHYSICAL]=function(a,b){a.color.setHex(b.color),a.roughness=b.roughness,a.metalness=b.metalness},a[SEA3D.Material.PHONG]=function(a,b){a.color.setHex(b.diffuseColor),a.specular.setHex(b.specularColor).multiplyScalar(b.specular),a.shininess=b.gloss},a[SEA3D.Material.DIFFUSE_MAP]=function(a,b,c){a.map=b.texture.tag,a.color.setHex(16777215),b.texture.transparent&&(a.transparent=!0,a.alphaTest=c.alphaThreshold)},a[SEA3D.Material.ROUGHNESS_MAP]=function(a,b){a.roughnessMap=b.texture.tag},a[SEA3D.Material.METALNESS_MAP]=function(a,b){a.metalnessMap=b.texture.tag},a[SEA3D.Material.SPECULAR_MAP]=function(a,b){a.specular&&(a.specularMap=b.texture.tag,a.specular.setHex(16777215))},a[SEA3D.Material.NORMAL_MAP]=function(a,b){a.normalMap=b.texture.tag},a[SEA3D.Material.REFLECTION]=a[SEA3D.Material.FRESNEL_REFLECTION]=function(a,b){a.envMap=b.texture.tag,a.envMap.mapping=THREE.CubeReflectionMapping,a.combine=THREE.MixOperation,a.reflectivity=b.alpha},a[SEA3D.Material.REFLECTION_SPHERICAL]=function(a,b){a.envMap=b.texture.tag,a.envMap.mapping=THREE.SphericalReflectionMapping,a.combine=THREE.MixOperation,a.reflectivity=b.alpha},a[SEA3D.Material.REFRACTION_MAP]=function(a,b){a.envMap=b.texture.tag,a.envMap.mapping=THREE.CubeRefractionMapping(),a.refractionRatio=b.ior,a.reflectivity=b.alpha},a[SEA3D.Material.LIGHT_MAP]=function(a,b){"multiply"==b.blendMode?a.aoMap=b.texture.tag:a.lightMap=b.texture.tag},a}(),THREE.SEA3D.prototype.createMaterial=function(a){return a.physical?new THREE.MeshStandardMaterial:new THREE.MeshPhongMaterial},THREE.SEA3D.prototype.setBlending=function(a,b){if("normal"!=b)switch(b){case"add":mat.blending=THREE.AdditiveBlending;break;case"subtract":mat.blending=THREE.SubtractiveBlending;break;case"multiply":mat.blending=THREE.MultiplyBlending;break;case"screen":mat.blending=THREE.CustomBlending,mat.blendSrc=THREE.OneFactor,mat.blendDst=THREE.OneMinusSrcColorFactor,mat.blendEquation=THREE.AddEquation}},THREE.SEA3D.prototype.readMaterial=function(a){var b=this.createMaterial(a);b.name=a.name,b.side=a.bothSides?THREE.DoubleSide:THREE.FrontSide,b.shading=a.smooth?THREE.SmoothShading:THREE.FlatShading,this.setBlending(b,a.blendMode);for(var c=0;c<a.technique.length;c++){var d=a.technique[c];this.materialTechnique[d.kind]&&this.materialTechnique[d.kind].call(this,b,d,a)}this.materialTechnique.onComplete&&this.materialTechnique.onComplete.call(this,b,a),this.domain.materials=this.materials=this.materials||[],this.materials.push(this.objects["mat/"+a.name]=a.tag=b)},THREE.SEA3D.prototype.readPointLight=function(a){var b=new THREE.SEA3D.PointLight(a.color,a.multiplier*this.config.multiplier);b.name=a.name,a.attenuation&&(b.distance=a.attenuation.end),a.shadow&&this.setShadowMap(b),this.domain.lights=this.lights=this.lights||[],this.lights.push(this.objects["lht/"+a.name]=a.tag=b),this.addSceneObject(a),this.updateTransform(b,a),this.applyDefaultAnimation(a,THREE.SEA3D.LightAnimator),this.updateScene()},THREE.SEA3D.prototype.readHemisphereLight=function(a){var b=new THREE.HemisphereLight(a.color,a.secondColor,a.multiplier*this.config.multiplier);b.name=a.name,this.domain.lights=this.lights=this.lights||[],this.lights.push(this.objects["lht/"+a.name]=a.tag=b),this.addSceneObject(a),this.applyDefaultAnimation(a,THREE.SEA3D.LightAnimator),this.updateScene()},THREE.SEA3D.prototype.readAmbientLight=function(a){var b=new THREE.AmbientLight(a.color,a.multiplier*this.config.multiplier);b.name=a.name,this.domain.lights=this.lights=this.lights||[],this.lights.push(this.objects["lht/"+a.name]=a.tag=b),this.addSceneObject(a),this.applyDefaultAnimation(a,THREE.SEA3D.LightAnimator),this.updateScene()},THREE.SEA3D.prototype.readDirectionalLight=function(a){var b=new THREE.DirectionalLight(a.color,a.multiplier*this.config.multiplier);b.name=a.name,a.shadow&&this.setShadowMap(b),this.domain.lights=this.lights=this.lights||[],this.lights.push(this.objects["lht/"+a.name]=a.tag=b),this.addSceneObject(a),this.updateTransform(b,a),this.applyDefaultAnimation(a,THREE.SEA3D.LightAnimator),this.updateScene()},THREE.SEA3D.PointSound=function(a){THREE.PositionalAudio.call(this,a)},THREE.SEA3D.PointSound.prototype=Object.create(THREE.PositionalAudio.prototype),THREE.SEA3D.PointSound.prototype.constructor=THREE.SEA3D.PointSound,Object.assign(THREE.SEA3D.PointSound.prototype,THREE.SEA3D.Object3D.prototype),THREE.SEA3D.PointSound.prototype.copy=function(a){return THREE.PositionalAudio.prototype.copy.call(this,a),this.props=a.props,this.scripts=a.scripts,this.animator&&(this.animator=a.animator.clone(this)),this},THREE.SEA3D.prototype.readCamera=function(a){var b=new THREE.SEA3D.Camera(a.fov);b.name=a.name,this.domain.cameras=this.cameras=this.cameras||[],this.cameras.push(this.objects["cam/"+a.name]=a.tag=b),this.addSceneObject(a),this.updateTransform(b,a),this.applyDefaultAnimation(a,THREE.SEA3D.CameraAnimator)},THREE.SEA3D.prototype.readOrthographicCamera=function(a){var b,c,d;this.config.stageWidth>this.config.stageHeight?(b=this.config.stageWidth/this.config.stageHeight,c=a.height*b,d=a.height):(b=this.config.stageHeight/this.config.stageWidth,c=a.height,d=a.height*b);var e=new THREE.SEA3D.OrthographicCamera(-c,c,d,-d);e.name=a.name,this.domain.cameras=this.cameras=this.cameras||[],this.cameras.push(this.objects["cam/"+a.name]=a.tag=e),this.addSceneObject(a),this.updateTransform(e,a),this.applyDefaultAnimation(a,THREE.SEA3D.CameraAnimator)},THREE.SEA3D.prototype.readSkeletonLocal=function(a){for(var b=[],c=0;c<a.joint.length;c++){var d=a.joint[c];b[c]={name:d.name,pos:[d.x,d.y,d.z],rotq:[d.qx,d.qy,d.qz,d.qw],parent:d.parentIndex}}a.tag=b},THREE.SEA3D.prototype.readJointObject=function(a){var b=a.target.tag,c=b.skeleton.bones[a.joint];this.domain.joints=this.joints=this.joints||[],this.joints.push(this.objects["jnt/"+a.name]=a.tag=c)},THREE.SEA3D.prototype.readMorpher=function(a){for(var b={position:[]},c=[],d=0;d<a.node.length;d++){var e=a.node[d];b.position[d]=new THREE.Float32Attribute(new Float32Array(e.vertex),3),e.normal&&(b.normal=b.normal||[],b.normal[d]=new THREE.Float32Attribute(new Float32Array(e.normal),3)),c[d]={name:e.name}}a.tag={attribs:b,targets:c}},THREE.SEA3D.prototype.getSkeletonAnimation=function(a,b){if(a.tag)return a.tag;for(var c=[],d=1e3/a.frameRate/1e3,e=0;e<a.sequence.length;e++){for(var f=a.sequence[e],g=f.start,h=g+f.count,i={name:f.name,fps:a.frameRate,length:d*f.count,hierarchy:[]},j=a.numJoints,k=a.raw,l=0;j>l;l++){for(var m=b.joint[l],n={parent:m.parentIndex,keys:[]},o=n.keys,p=0,q=g;h>q;q++){var r=q*j*7+7*l;o.push({time:p,pos:[k[r],k[r+1],k[r+2]],rot:[k[r+3],k[r+4],k[r+5],k[r+6]],scl:[1,1,1]}),p+=d}i.hierarchy[l]=n}var s=THREE.AnimationClip.parseAnimation(i,b.tag);s.loop=f.repeat,s.timeScale=1,c.push(s)}return a.tag=c},THREE.SEA3D.prototype.readVertexAnimation=function(a){var b,c,d,e={position:[]},f=[],g=[];for(b=0,d=a.frame.length;d>b;b++){var h=a.frame[b];e.position[b]=new THREE.Float32Attribute(new Float32Array(h.vertex),3),h.normal&&(e.normal=e.normal||[],e.normal[b]=new THREE.Float32Attribute(new Float32Array(h.normal),3)),f[b]={name:b}}for(b=0;b<a.sequence.length;b++){var i=a.sequence[b],j=[];for(c=0;c<i.count;c++)j[c]=f[i.start+c];var k=THREE.AnimationClip.CreateFromMorphTargetSequence(i.name,j,a.frameRate);k.loop=i.repeat,k.timeScale=1,g.push(k)}a.tag={attribs:e,targets:f,animations:g}},THREE.SEA3D.prototype.readActions=function(a){for(var b=0;b<a.actions.length;b++){var c=a.actions[b];switch(c.kind){case SEA3D.Actions.SCRIPTS:this.domain.scripts=this.getJSMList(this.domain,c.scripts),this.config.runScripts&&this.domain.runJSMList(obj3d)}}},THREE.SEA3D.Event={LOAD_PROGRESS:"sea3d_progress",DOWNLOAD_PROGRESS:"sea3d_download",COMPLETE:"sea3d_complete",OBJECT_COMPLETE:"sea3d_object",PARSE_PROGRESS:"parse_progress",PARSE_COMPLETE:"parse_complete",ERROR:"sea3d_error"},THREE.SEA3D.prototype.onProgress=void 0,THREE.SEA3D.prototype.onComplete=function(a){a.file=this.scope,a.type=THREE.SEA3D.Event.COMPLETE,a.file.dispatchEvent(a)},THREE.SEA3D.prototype.onLoadProgress=function(a){a.file=this.scope,a.type=THREE.SEA3D.Event.LOAD_PROGRESS,a.file.dispatchEvent(a),a.file.onProgress&&a.file.onProgress(a)},THREE.SEA3D.prototype.onDownloadProgress=function(a){a.file=this.scope,a.type=THREE.SEA3D.Event.DOWNLOAD_PROGRESS,a.file.dispatchEvent(a),a.file.onProgress&&a.file.onProgress(a)},THREE.SEA3D.prototype.onCompleteObject=function(a){a.file=this.scope,a.type=THREE.SEA3D.Event.OBJECT_COMPLETE,a.file.dispatchEvent(a)},THREE.SEA3D.prototype.onParseProgress=function(a){a.file=this.scope,a.type=THREE.SEA3D.Event.PARSE_PROGRESS,a.file.dispatchEvent(a)},THREE.SEA3D.prototype.onParseComplete=function(a){a.file=this.scope,a.type=THREE.SEA3D.Event.PARSE_COMPLETE,a.file.dispatchEvent(a)},THREE.SEA3D.prototype.onError=function(a){a.file=this.scope,a.type=THREE.SEA3D.Event.ERROR,a.file.dispatchEvent(a)},THREE.SEA3D.prototype.createDomain=function(){return this.domain=new THREE.SEA3D.Domain(this.config.id,this.objects={},this.config.container)},THREE.SEA3D.prototype.clone=function(a,b,c){if(!this.file.isDone())throw new Error("Previous parse is not completed.");this.config.container=a&&void 0!==a.container?a.container:new THREE.Object3D,a&&this.loadConfig(a);var d=this.config.timeLimit;return this.config.timeLimit=a&&void 0!==a.timeLimit?a.timeLimit:1/0,this.parse(b,c),this.config.timeLimit=d,this.domain},THREE.SEA3D.prototype.loadConfig=function(a){for(var b in a)this.config[b]=a[b]},THREE.SEA3D.prototype.parse=function(a,b){delete this.cameras,delete this.containers,delete this.lights,delete this.joints,delete this.meshes,delete this.materials,delete this.animationSets,delete this.sprites,delete this.sounds3d,delete this.cubeRenderers,delete this.sounds,delete this.glsl,delete this.dummy,delete this.domain,this.createDomain(),this.setTypeRead(),this.file.onParseComplete=function(b){this.config.manager&&this.config.manager.add(this.domain),(a||this.onParseComplete).call(this.file,b)}.bind(this),this.file.onParseProgress=b||this.onParseProgress;for(var c=THREE.SEA3D.EXTENSIONS_LOADER.length;c--;){var d=THREE.SEA3D.EXTENSIONS_LOADER[c];d.parse&&d.parse.call(this)}return this.file.parse(),this.domain},THREE.SEA3D.prototype.load=function(a){this.loadBytes(),this.file.load(a)},THREE.SEA3D.prototype.onHead=function(a){if("TJS"!=a.sign)throw new Error("Sign '"+a.sign+"' not supported! Use SEA3D Studio to publish or SEA3DLegacy.js")},THREE.SEA3D.EXTENSIONS_LOADER=[],THREE.SEA3D.EXTENSIONS_DOMAIN=[],THREE.SEA3D.prototype.setTypeRead=function(){this.file.typeRead={},this.file.typeRead[SEA3D.Geometry.prototype.type]=this.file.typeRead[SEA3D.GeometryDelta.prototype.type]=this.readGeometryBuffer,this.file.typeRead[SEA3D.Mesh.prototype.type]=this.readMesh,this.file.typeRead[SEA3D.Sprite.prototype.type]=this.readSprite,this.file.typeRead[SEA3D.Container3D.prototype.type]=this.readContainer3D,this.file.typeRead[SEA3D.Line.prototype.type]=this.readLine,this.file.typeRead[SEA3D.Material.prototype.type]=this.readMaterial,this.file.typeRead[SEA3D.Camera.prototype.type]=this.readCamera,this.file.typeRead[SEA3D.OrthographicCamera.prototype.type]=this.readOrthographicCamera,this.file.typeRead[SEA3D.SkeletonLocal.prototype.type]=this.readSkeletonLocal,this.file.typeRead[SEA3D.JointObject.prototype.type]=this.readJointObject,this.file.typeRead[SEA3D.CubeMap.prototype.type]=this.readCubeMap,this.file.typeRead[SEA3D.CubeRender.prototype.type]=this.readCubeRender,this.file.typeRead[SEA3D.Animation.prototype.type]=this.readAnimation,this.file.typeRead[SEA3D.SoundPoint.prototype.type]=this.readSoundPoint,this.file.typeRead[SEA3D.TextureURL.prototype.type]=this.readTextureURL,this.file.typeRead[SEA3D.Morph.prototype.type]=this.readMorpher,this.file.typeRead[SEA3D.VertexAnimation.prototype.type]=this.readVertexAnimation,this.file.typeRead[SEA3D.Actions.prototype.type]=this.readActions,this.config.dummys&&(this.file.typeRead[SEA3D.Dummy.prototype.type]=this.readDummy),this.config.scripts&&(this.file.typeRead[SEA3D.JavaScriptMethod.prototype.type]=this.readJavaScriptMethod),this.config.lights&&(this.file.typeRead[SEA3D.PointLight.prototype.type]=this.readPointLight,this.file.typeRead[SEA3D.DirectionalLight.prototype.type]=this.readDirectionalLight,this.file.typeRead[SEA3D.HemisphereLight.prototype.type]=this.readHemisphereLight,this.file.typeRead[SEA3D.AmbientLight.prototype.type]=this.readAmbientLight),this.file.typeRead[SEA3D.JPEG.prototype.type]=this.file.typeRead[SEA3D.JPEG_XR.prototype.type]=this.file.typeRead[SEA3D.PNG.prototype.type]=this.file.typeRead[SEA3D.GIF.prototype.type]=this.readImage,this.file.typeRead[SEA3D.MP3.prototype.type]=this.readSound,this.file.typeRead[SEA3D.GLSL.prototype.type]=this.readGLSL;for(var a=THREE.SEA3D.EXTENSIONS_LOADER.length;a--;){var b=THREE.SEA3D.EXTENSIONS_LOADER[a];b.setTypeRead&&b.setTypeRead.call(this)}},THREE.SEA3D.prototype.loadBytes=function(a){this.file=new SEA3D.File,this.file.scope=this,this.file.config=this.config,this.file.onProgress=this.onLoadProgress,this.file.onCompleteObject=this.onCompleteObject,this.file.onDownloadProgress=this.onDownloadProgress,this.file.onParseProgress=this.onParseProgress,this.file.onParseComplete=this.onParseComplete,this.file.onError=this.onError,this.file.onHead=this.onHead,this.file.onComplete=function(a){this.config.manager&&this.config.manager.add(this.domain),this.onComplete.call(this.file,a)}.bind(this),this.createDomain(),this.setTypeRead(),this.file.read(a)},SEA3D.AnimationBlendMethod={LINEAR:"linear",EASING:"easing"},SEA3D.AnimationFrame=function(){this.data=[0,0,0,0]},SEA3D.AnimationFrame.prototype.toVector=function(){return{x:this.data[0],y:this.data[1],z:this.data[2],w:this.data[3]}},SEA3D.AnimationFrame.prototype.toAngles=function(a){var b=this.data[0],c=this.data[1],d=this.data[2],e=this.data[3],f=2*(e*c-d*b);return-1>f?f=-1:f>1&&(f=1),{x:Math.atan2(2*(e*b+c*d),1-2*(b*b+c*c))*a,y:Math.asin(f)*a,z:Math.atan2(2*(e*d+b*c),1-2*(c*c+d*d))*a}},SEA3D.AnimationFrame.prototype.toEuler=function(){return this.toAngles(SEA3D.Math.DEGREES)},SEA3D.AnimationFrame.prototype.toRadians=function(){return this.toAngles(1)},SEA3D.AnimationFrame.prototype.setX=function(a){this.data[0]=a},SEA3D.AnimationFrame.prototype.getX=function(){return this.data[0]},SEA3D.AnimationFrame.prototype.setY=function(a){this.data[1]=a},SEA3D.AnimationFrame.prototype.getY=function(){return this.data[1]},SEA3D.AnimationFrame.prototype.setZ=function(a){this.data[2]=a},SEA3D.AnimationFrame.prototype.getZ=function(){return this.data[2]},SEA3D.AnimationFrame.prototype.setW=function(a){this.data[3]=a},SEA3D.AnimationFrame.prototype.getW=function(){return this.data[3]},SEA3D.AnimationData=function(a,b,c,d){switch(this.kind=a,this.type=b,this.blockLength=SEA3D.Stream.sizeOf(b),this.data=c,this.offset=void 0==d?0:d,this.blockLength){case 1:this.getData=this.getData1x;break;case 2:this.getData=this.getData2x;break;case 3:this.getData=this.getData3x;break;case 4:this.getData=this.getData4x}},SEA3D.AnimationData.prototype.getData1x=function(a,b){a=this.offset+a*this.blockLength,b[0]=this.data[a]},SEA3D.AnimationData.prototype.getData2x=function(a,b){a=this.offset+a*this.blockLength,b[0]=this.data[a],b[1]=this.data[a+1]},SEA3D.AnimationData.prototype.getData3x=function(a,b){a=this.offset+a*this.blockLength,b[0]=this.data[a],b[1]=this.data[a+1],b[2]=this.data[a+2]},SEA3D.AnimationData.prototype.getData4x=function(a,b){a=this.offset+a*this.blockLength,b[0]=this.data[a],b[1]=this.data[a+1],b[2]=this.data[a+2],b[3]=this.data[a+3]},SEA3D.AnimationNode=function(a,b,c,d,e){this.name=a,this.frameRate=b,this.frameMill=1e3/b,this.numFrames=c,this.length=c-1,this.time=0,this.duration=this.length*this.frameMill,this.repeat=d,this.intrpl=e,this.invalidState=!0,this.dataList=[],this.dataListId={},this.buffer=new SEA3D.AnimationFrame,this.percent=0,this.prevFrame=0,this.nextFrame=0,this.frame=0},SEA3D.AnimationNode.prototype.setTime=function(a){this.frame=this.validFrame(a/this.frameMill),this.time=this.frame*this.frameRate,this.invalidState=!0},SEA3D.AnimationNode.prototype.getTime=function(){return this.time},SEA3D.AnimationNode.prototype.setFrame=function(a){this.setTime(a*this.frameMill)},SEA3D.AnimationNode.prototype.getRealFrame=function(){return Math.floor(this.frame)},SEA3D.AnimationNode.prototype.getFrame=function(){return this.frame},SEA3D.AnimationNode.prototype.setPosition=function(a){this.setFrame(a*(this.numFrames-1))},SEA3D.AnimationNode.prototype.getPosition=function(){return this.frame/(this.numFrames-1)},SEA3D.AnimationNode.prototype.validFrame=function(a){var b=0>a;return b&&(a=-a),a>this.length&&(a=this.repeat?a%this.length:this.length),b&&(a=this.length-a),a},SEA3D.AnimationNode.prototype.addData=function(a){this.dataListId[a.kind]=a,this.dataList[this.dataList.length]=a},SEA3D.AnimationNode.prototype.removeData=function(a){delete this.dataListId[a.kind],this.dataList.splice(this.dataList.indexOf(a),1)},SEA3D.AnimationNode.prototype.getDataByKind=function(a){return this.dataListId[a]},SEA3D.AnimationNode.prototype.getFrameAt=function(a,b){return this.dataListId[b].getFrameData(a,this.buffer.data),this.buffer},SEA3D.AnimationNode.prototype.getFrame=function(a){return this.dataListId[a].getFrameData(this.getRealFrame(),this.buffer.data),this.buffer},SEA3D.AnimationNode.prototype.getInterpolationFrame=function(a,b){return 0==this.numFrames?this.buffer:(this.invalidState&&(this.prevFrame=this.getRealFrame(),this.nextFrame=this.validFrame(this.prevFrame+1),this.percent=this.frame-this.prevFrame,this.invalidState=!1),a.getData(this.prevFrame,this.buffer.data),this.percent>0&&(a.getData(this.nextFrame,SEA3D.AnimationNode.FRAME_BUFFER),b(this.buffer.data,SEA3D.AnimationNode.FRAME_BUFFER,this.percent)),this.buffer)},SEA3D.AnimationNode.FRAME_BUFFER=[0,0,0,0],SEA3D.AnimationSet=function(){this.animations=[],this.dataCount=-1},SEA3D.AnimationSet.prototype.addAnimation=function(a){-1==this.dataCount&&(this.dataCount=a.dataList.length),this.animations[a.name]=a,this.animations.push(a)},SEA3D.AnimationSet.prototype.getAnimationByName=function(a){return this.animations[a]},SEA3D.AnimationState=function(a){this.node=a,this.offset=0,this.weight=0,this.time=0},SEA3D.AnimationState.prototype.setTime=function(a){this.node.time=this.time=a},SEA3D.AnimationState.prototype.getTime=function(){return this.time},SEA3D.AnimationState.prototype.setFrame=function(a){this.node.setFrame(a),this.time=this.node.time},SEA3D.AnimationState.prototype.getFrame=function(){return this.update(),this.node.getFrame()},SEA3D.AnimationState.prototype.setPosition=function(a){this.node.setPosition(a),this.time=this.node.time},SEA3D.AnimationState.prototype.getPosition=function(){
return this.update(),this.node.getPosition()},SEA3D.AnimationState.prototype.update=function(){this.node.time!=this.time&&this.node.setTime(this.time)},SEA3D.AnimationHandler=function(a){this.animationSet=a,this.states=SEA3D.AnimationHandler.stateFromAnimations(a.animations),this.timeScale=1,this.time=0,this.numAnimation=a.animations.length,this.relative=!1,this.playing=!1,this.delta=0,this.easeSpeed=2,this.crossfade=0,this.updateAllStates=!1,this.blendMethod=SEA3D.AnimationBlendMethod.LINEAR},SEA3D.AnimationHandler.prototype.update=function(a){this.delta=a,this.time+=a*this.timeScale,this.updateState(),this.updateAnimation()},SEA3D.AnimationHandler.prototype.updateState=function(){var a,b,c;if(this.currentState.node.setTime(this.time-this.currentState.offset),this.currentState.weight<1&&this.crossfade>0){var d=Math.abs(this.delta)/(1e3*this.crossfade),e=1;for(this.blendMethod===SEA3D.AnimationBlendMethod.EASING&&(d*=this.easeSpeed),a=0,b=this.states.length;b>a;++a)c=this.states[a],c.weight>0&&c!==this.currentState&&(this.blendMethod===SEA3D.AnimationBlendMethod.LINEAR?c.weight-=d:this.blendMethod===SEA3D.AnimationBlendMethod.EASING&&(c.weight-=c.weight*d),c.weight<0&&(c.weight=0),e-=c.weight,this.updateAllStates&&c.node.setTime(this.time-c.offset));0>e&&(e=0),this.currentState.weight=e}else for(a=0;a<this.states.length;++a)c=this.states[a],c===this.currentState?c.weight=1:(c.weight=0,this.updateAllStates&&c.node.setTime(this.time))},SEA3D.AnimationHandler.prototype.updateAnimation=function(){for(var a=this.animationSet.dataCount,b=this.animationSet.animations,c=this.currentState.node,d=0;a>d;d++)for(var e=0;e<b.length;e++){var f,g=b[e],h=this.states[e],i=g.dataList[d],j=SEA3D.Animation.DefaultLerpFuncs[i.kind];0==e&&(f=c.getInterpolationFrame(c.dataList[d],j),c.repeat||c.frame!=c.numFrames-1||this.onComplete&&this.onComplete(this)),g!=c&&h.weight>0&&j(f.data,g.getInterpolationFrame(i,j).data,h.weight),this.updateAnimationFrame&&this.updateAnimationFrame(f,i.kind)}},SEA3D.AnimationHandler.prototype.getStateByName=function(a){return this.states[a]},SEA3D.AnimationHandler.prototype.getStateNameByIndex=function(a){return this.animationSet.animations[a].name},SEA3D.AnimationHandler.prototype.play=function(a,b,c){if(this.currentState=this.getStateByName(a),!this.currentState)throw new Error('Animation "'+a+'" not found.');this.crossfade=b,this.currentState.offset=this.time,void 0!==c&&(this.currentState.time=c),this.playing||(SEA3D.AnimationHandler.add(this),this.playing=!0)},SEA3D.AnimationHandler.prototype.resume=function(){this.playing||(SEA3D.AnimationHandler.add(this),this.playing=!0)},SEA3D.AnimationHandler.prototype.pause=function(){this.playing&&(SEA3D.AnimationHandler.remove(this),this.playing=!1)},SEA3D.AnimationHandler.prototype.stop=function(){this.time=0,this.pause()},SEA3D.AnimationHandler.prototype.setRelative=function(a){this.relative=a},SEA3D.AnimationHandler.prototype.getRelative=function(){return this.relative},SEA3D.AnimationHandler.add=function(a){SEA3D.AnimationHandler.animations.push(a)},SEA3D.AnimationHandler.remove=function(a){SEA3D.AnimationHandler.animations.splice(SEA3D.AnimationHandler.animations.indexOf(a),1)},SEA3D.AnimationHandler.stateFromAnimations=function(a){for(var b=[],c=0;c<a.length;c++)b[a[c].name]=b[c]=new SEA3D.AnimationState(a[c]);return b},SEA3D.AnimationHandler.update=function(a){for(var b=0,c=SEA3D.AnimationHandler.animations.length;c>b;b++)SEA3D.AnimationHandler.animations[b].update(1e3*a)},SEA3D.AnimationHandler.setTime=function(a){for(var b=0,c=SEA3D.AnimationHandler.animations.length;c>b;b++)SEA3D.AnimationHandler.animations[b].time=a},SEA3D.AnimationHandler.stop=function(){for(;SEA3D.AnimationHandler.animations.length;)SEA3D.AnimationHandler.animations[0].stop()},SEA3D.AnimationHandler.animations=[],THREE.SEA3D.PhongNodeMaterial=function(){THREE.PhongNodeMaterial.call(this)},THREE.SEA3D.PhongNodeMaterial.prototype=Object.create(THREE.PhongNodeMaterial.prototype),THREE.SEA3D.PhongNodeMaterial.prototype.constructor=THREE.SEA3D.PhongNodeMaterial,THREE.SEA3D.StandardNodeMaterial=function(){THREE.StandardNodeMaterial.call(this)},THREE.SEA3D.StandardNodeMaterial.prototype=Object.create(THREE.StandardNodeMaterial.prototype),THREE.SEA3D.StandardNodeMaterial.prototype.constructor=THREE.SEA3D.StandardNodeMaterial,THREE.SEA3D.PhongMaterial=function(){THREE.PhongNodeMaterial.call(this),THREE.SEA3D.MaterialBuilder.apply.call(this)},THREE.SEA3D.PhongMaterial.prototype=Object.create(THREE.PhongNodeMaterial.prototype),THREE.SEA3D.PhongMaterial.prototype.constructor=THREE.SEA3D.PhongMaterial,THREE.SEA3D.StandardMaterial=function(){THREE.StandardNodeMaterial.call(this),THREE.SEA3D.MaterialBuilder.apply.call(this)},THREE.SEA3D.StandardMaterial.prototype=Object.create(THREE.StandardNodeMaterial.prototype),THREE.SEA3D.StandardMaterial.prototype.constructor=THREE.SEA3D.StandardMaterial,THREE.SEA3D.MaterialBuilder={apply:function(a){Object.defineProperties(this,{enabledRim:{enumerable:!0,get:function(){return null!=this.rimColor},set:function(a){this.enabledRim!=!!a&&(a?(this.rimColor=new THREE.ColorNode(255),this.rimPower=new THREE.FloatNode(3),this.rimIntensityValue=1.3,this.rimViewZ=new THREE.Math2Node(new THREE.NormalNode(THREE.NormalNode.VIEW),new THREE.Vector3Node(0,0,-this.rimIntensityValue),THREE.Math2Node.DOT),this.rimMath=new THREE.OperatorNode(this.rimViewZ,new THREE.FloatNode(this.rimIntensityValue),THREE.OperatorNode.ADD),this.rimPowerMath=new THREE.Math2Node(this.rimMath,this.rimPower,THREE.Math2Node.POW),this.rim=new THREE.OperatorNode(this.rimPowerMath,this.rimColor,THREE.OperatorNode.MUL)):(delete this.rimColor,delete this.rimPower,delete this.rimIntensityValue,delete this.rimViewZ,delete this.rimMath,delete this.rimPowerMath,delete this.rim))}},rimIntensity:{enumerable:!0,get:function(){return this.rimIntensityValue},set:function(a){this.rimIntensityValue=a,this.rimViewZ.b.z=-a,this.rimMath.b.number=a}},enabledFresnel:{enumerable:!0,get:function(){return null!=this.fresnel},set:function(a){this.enabledFresnel!=!!a&&(a?(this.fresnelReflectance=new THREE.FloatNode(1.3),this.fresnelPower=new THREE.FloatNode(1),this.fresnelViewZ=new THREE.Math2Node(new THREE.NormalNode(THREE.NormalNode.VIEW),new THREE.Vector3Node(0,0,-1),THREE.Math2Node.DOT),this.fresnelTheta=new THREE.OperatorNode(this.fresnelViewZ,new THREE.FloatNode(1),THREE.OperatorNode.ADD),this.fresnelThetaPower=new THREE.Math2Node(this.fresnelTheta,this.fresnelPower,THREE.Math2Node.POW),this.fresnel=new THREE.OperatorNode(this.fresnelReflectance,this.fresnelThetaPower,THREE.OperatorNode.MUL)):(delete this.fresnelReflectance,delete this.fresnelPower,delete this.fresnelViewZ,delete this.fresnelTheta,delete this.fresnelThetaPower,delete this.fresnel))}}}),this.build=THREE.SEA3D.MaterialBuilder.build.bind(this)},build:function(){var a=this.enabledRim,b=this.enabledFresnel;a&&(this.ambient=this.rim);var c=this.diffuse,d=this.opacity<1?new THREE.FloatNode(this.opacity):void 0;if(c&&this.diffuseTransparent){var e=new THREE.SwitchNode(c,"a");d=d?new THREE.OperatorNode(d,e,THREE.OperatorNode.MUL):e}this.color=c||new THREE.ColorNode(15658734),d&&(this.alpha=d);var f=this.specularColor;this.specularMap&&(f=new THREE.OperatorNode(f,this.specularMap,THREE.OperatorNode.MUL)),this.specular=f;var g=this.lightMapDiffuse;g&&("add"==this.lightMapBlendMode?this.light=g:this.shadow=g),this.ambientColor&&(this.ambient=new THREE.OperatorNode(this.diffuse,this.ambientColor,THREE.OperatorNode.MUL));var h=this.reflection,i=this.reflectionAlpha;if(h&&(this.environment=h,this.environmentAlpha=i),b){var j=new THREE.Math1Node(this.fresnel,THREE.Math1Node.SAT);this.environmentAlpha&&(j=new THREE.OperatorNode(j,this.environmentAlpha,THREE.OperatorNode.MUL)),this.environmentAlpha=j}THREE.NodeMaterial.prototype.build.call(this)}},THREE.SEA3D.prototype.readNodeMaterial=function(a){var b=a.physical?new THREE.SEA3D.StandardNodeMaterial:new THREE.SEA3D.PhongNodeMaterial;this.domain.materials=this.materials=this.materials||[],this.materials.push(this.objects["mat/"+a.name]=a.tag=b)},THREE.SEA3D.prototype.createMaterial=function(a){return a.physical?new THREE.SEA3D.StandardMaterial:new THREE.SEA3D.PhongMaterial},THREE.SEA3D.prototype.materialTechnique=function(){var a={};return a.onComplete=function(a,b){a.opacity=b.alpha,a.build()},a[SEA3D.Material.PHYSICAL]=function(a,b){a.diffuse=new THREE.ColorNode(b.color),a.roughness.number=b.roughness,a.metalness.number=b.metalness},a[SEA3D.Material.PHONG]=function(a,b){a.ambientColor=new THREE.ColorNode(b.ambientColor),a.diffuse=new THREE.ColorNode(b.diffuseColor),a.specularColor=new THREE.ColorNode(b.specularColor),a.specularColor.value.multiplyScalar(b.specular),a.shininess.number=b.gloss},a[SEA3D.Material.DIFFUSE_MAP]=function(a,b){a.diffuse=new THREE.TextureNode(b.texture.tag),a.diffuseTransparent=b.texture.transparent},a[SEA3D.Material.ROUGHNESS_MAP]=function(a,b){a.roughness=new THREE.TextureNode(b.texture.tag)},a[SEA3D.Material.METALNESS_MAP]=function(a,b){a.metalness=new THREE.TextureNode(b.texture.tag)},a[SEA3D.Material.SPECULAR_MAP]=function(a,b){a.specularMap=new THREE.TextureNode(b.texture.tag)},a[SEA3D.Material.NORMAL_MAP]=function(a,b){a.normal=new THREE.TextureNode(b.texture.tag)},a[SEA3D.Material.REFLECTION]=a[SEA3D.Material.FRESNEL_REFLECTION]=function(a,b){a.reflection=new THREE.CubeTextureNode(b.texture.tag),a.reflectionAlpha=new THREE.FloatNode(b.alpha),b.kind==SEA3D.Material.FRESNEL_REFLECTION&&(a.enabledFresnel=!0,a.fresnelPower.number=b.power,a.fresnelReflectance.number=b.normal+1)},a[SEA3D.Material.REFLECTION_SPHERICAL]=function(a,b){a.reflection=new THREE.TextureNode(b.texture.tag,new THREE.ReflectNode(THREE.ReflectNode.SPHERE)),a.reflectionAlpha=new THREE.FloatNode(b.alpha)},a[SEA3D.Material.RIM]=function(a,b){a.enabledRim=!0,a.rimColor.value.setHex(b.power),a.rimIntensity=b.strength,a.rimPower.number=b.power},a[SEA3D.Material.LIGHT_MAP]=function(a,b){a.lightMapDiffuse=new THREE.TextureNode(b.texture.tag,new THREE.UVNode(b.channel)),a.lightMapBlendMode=b.blendMode},a}();var LZMA=LZMA||{};LZMA.OutWindow=function(){this._windowSize=0},LZMA.OutWindow.prototype.create=function(a){this._buffer&&this._windowSize===a||(this._buffer=[]),this._windowSize=a,this._pos=0,this._streamPos=0},LZMA.OutWindow.prototype.flush=function(){var a=this._pos-this._streamPos;if(0!==a){for(;a--;)this._stream.writeByte(this._buffer[this._streamPos++]);this._pos>=this._windowSize&&(this._pos=0),this._streamPos=this._pos}},LZMA.OutWindow.prototype.releaseStream=function(){this.flush(),this._stream=null},LZMA.OutWindow.prototype.setStream=function(a){this.releaseStream(),this._stream=a},LZMA.OutWindow.prototype.init=function(a){a||(this._streamPos=0,this._pos=0)},LZMA.OutWindow.prototype.copyBlock=function(a,b){var c=this._pos-a-1;for(0>c&&(c+=this._windowSize);b--;)c>=this._windowSize&&(c=0),this._buffer[this._pos++]=this._buffer[c++],this._pos>=this._windowSize&&this.flush()},LZMA.OutWindow.prototype.putByte=function(a){this._buffer[this._pos++]=a,this._pos>=this._windowSize&&this.flush()},LZMA.OutWindow.prototype.getByte=function(a){var b=this._pos-a-1;return 0>b&&(b+=this._windowSize),this._buffer[b]},LZMA.RangeDecoder=function(){},LZMA.RangeDecoder.prototype.setStream=function(a){this._stream=a},LZMA.RangeDecoder.prototype.releaseStream=function(){this._stream=null},LZMA.RangeDecoder.prototype.init=function(){var a=5;for(this._code=0,this._range=-1;a--;)this._code=this._code<<8|this._stream.readByte()},LZMA.RangeDecoder.prototype.decodeDirectBits=function(a){for(var b,c=0,d=a;d--;)this._range>>>=1,b=this._code-this._range>>>31,this._code-=this._range&b-1,c=c<<1|1-b,0===(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8);return c},LZMA.RangeDecoder.prototype.decodeBit=function(a,b){var c=a[b],d=(this._range>>>11)*c;return(2147483648^this._code)<(2147483648^d)?(this._range=d,a[b]+=2048-c>>>5,0===(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),0):(this._range-=d,this._code-=d,a[b]-=c>>>5,0===(4278190080&this._range)&&(this._code=this._code<<8|this._stream.readByte(),this._range<<=8),1)},LZMA.initBitModels=function(a,b){for(;b--;)a[b]=1024},LZMA.BitTreeDecoder=function(a){this._models=[],this._numBitLevels=a},LZMA.BitTreeDecoder.prototype.init=function(){LZMA.initBitModels(this._models,1<<this._numBitLevels)},LZMA.BitTreeDecoder.prototype.decode=function(a){for(var b=1,c=this._numBitLevels;c--;)b=b<<1|a.decodeBit(this._models,b);return b-(1<<this._numBitLevels)},LZMA.BitTreeDecoder.prototype.reverseDecode=function(a){for(var b,c=1,d=0,e=0;e<this._numBitLevels;++e)b=a.decodeBit(this._models,c),c=c<<1|b,d|=b<<e;return d},LZMA.reverseDecode2=function(a,b,c,d){for(var e,f=1,g=0,h=0;d>h;++h)e=c.decodeBit(a,b+f),f=f<<1|e,g|=e<<h;return g},LZMA.LenDecoder=function(){this._choice=[],this._lowCoder=[],this._midCoder=[],this._highCoder=new LZMA.BitTreeDecoder(8),this._numPosStates=0},LZMA.LenDecoder.prototype.create=function(a){for(;this._numPosStates<a;++this._numPosStates)this._lowCoder[this._numPosStates]=new LZMA.BitTreeDecoder(3),this._midCoder[this._numPosStates]=new LZMA.BitTreeDecoder(3)},LZMA.LenDecoder.prototype.init=function(){var a=this._numPosStates;for(LZMA.initBitModels(this._choice,2);a--;)this._lowCoder[a].init(),this._midCoder[a].init();this._highCoder.init()},LZMA.LenDecoder.prototype.decode=function(a,b){return 0===a.decodeBit(this._choice,0)?this._lowCoder[b].decode(a):0===a.decodeBit(this._choice,1)?8+this._midCoder[b].decode(a):16+this._highCoder.decode(a)},LZMA.Decoder2=function(){this._decoders=[]},LZMA.Decoder2.prototype.init=function(){LZMA.initBitModels(this._decoders,768)},LZMA.Decoder2.prototype.decodeNormal=function(a){var b=1;do b=b<<1|a.decodeBit(this._decoders,b);while(256>b);return 255&b},LZMA.Decoder2.prototype.decodeWithMatchByte=function(a,b){var c,d,e=1;do if(c=b>>7&1,b<<=1,d=a.decodeBit(this._decoders,(1+c<<8)+e),e=e<<1|d,c!==d){for(;256>e;)e=e<<1|a.decodeBit(this._decoders,e);break}while(256>e);return 255&e},LZMA.LiteralDecoder=function(){},LZMA.LiteralDecoder.prototype.create=function(a,b){var c;if(!this._coders||this._numPrevBits!==b||this._numPosBits!==a)for(this._numPosBits=a,this._posMask=(1<<a)-1,this._numPrevBits=b,this._coders=[],c=1<<this._numPrevBits+this._numPosBits;c--;)this._coders[c]=new LZMA.Decoder2},LZMA.LiteralDecoder.prototype.init=function(){for(var a=1<<this._numPrevBits+this._numPosBits;a--;)this._coders[a].init()},LZMA.LiteralDecoder.prototype.getDecoder=function(a,b){return this._coders[((a&this._posMask)<<this._numPrevBits)+((255&b)>>>8-this._numPrevBits)]},LZMA.Decoder=function(){this._outWindow=new LZMA.OutWindow,this._rangeDecoder=new LZMA.RangeDecoder,this._isMatchDecoders=[],this._isRepDecoders=[],this._isRepG0Decoders=[],this._isRepG1Decoders=[],this._isRepG2Decoders=[],this._isRep0LongDecoders=[],this._posSlotDecoder=[],this._posDecoders=[],this._posAlignDecoder=new LZMA.BitTreeDecoder(4),this._lenDecoder=new LZMA.LenDecoder,this._repLenDecoder=new LZMA.LenDecoder,this._literalDecoder=new LZMA.LiteralDecoder,this._dictionarySize=-1,this._dictionarySizeCheck=-1,this._posSlotDecoder[0]=new LZMA.BitTreeDecoder(6),this._posSlotDecoder[1]=new LZMA.BitTreeDecoder(6),this._posSlotDecoder[2]=new LZMA.BitTreeDecoder(6),this._posSlotDecoder[3]=new LZMA.BitTreeDecoder(6)},LZMA.Decoder.prototype.setDictionarySize=function(a){return 0>a?!1:(this._dictionarySize!==a&&(this._dictionarySize=a,this._dictionarySizeCheck=Math.max(this._dictionarySize,1),this._outWindow.create(Math.max(this._dictionarySizeCheck,4096))),!0)},LZMA.Decoder.prototype.setLcLpPb=function(a,b,c){var d=1<<c;return a>8||b>4||c>4?!1:(this._literalDecoder.create(b,a),this._lenDecoder.create(d),this._repLenDecoder.create(d),this._posStateMask=d-1,!0)},LZMA.Decoder.prototype.init=function(){var a=4;for(this._outWindow.init(!1),LZMA.initBitModels(this._isMatchDecoders,192),LZMA.initBitModels(this._isRep0LongDecoders,192),LZMA.initBitModels(this._isRepDecoders,12),LZMA.initBitModels(this._isRepG0Decoders,12),LZMA.initBitModels(this._isRepG1Decoders,12),LZMA.initBitModels(this._isRepG2Decoders,12),LZMA.initBitModels(this._posDecoders,114),this._literalDecoder.init();a--;)this._posSlotDecoder[a].init();this._lenDecoder.init(),this._repLenDecoder.init(),this._posAlignDecoder.init(),this._rangeDecoder.init()},LZMA.Decoder.prototype.decode=function(a,b,c){var d,e,f,g,h,i,j=0,k=0,l=0,m=0,n=0,o=0,p=0;for(this._rangeDecoder.setStream(a),this._outWindow.setStream(b),this.init();0>c||c>o;)if(d=o&this._posStateMask,0===this._rangeDecoder.decodeBit(this._isMatchDecoders,(j<<4)+d))e=this._literalDecoder.getDecoder(o++,p),p=j>=7?e.decodeWithMatchByte(this._rangeDecoder,this._outWindow.getByte(k)):e.decodeNormal(this._rangeDecoder),this._outWindow.putByte(p),j=4>j?0:j-(10>j?3:6);else{if(1===this._rangeDecoder.decodeBit(this._isRepDecoders,j))f=0,0===this._rangeDecoder.decodeBit(this._isRepG0Decoders,j)?0===this._rangeDecoder.decodeBit(this._isRep0LongDecoders,(j<<4)+d)&&(j=7>j?9:11,f=1):(0===this._rangeDecoder.decodeBit(this._isRepG1Decoders,j)?g=l:(0===this._rangeDecoder.decodeBit(this._isRepG2Decoders,j)?g=m:(g=n,n=m),m=l),l=k,k=g),0===f&&(f=2+this._repLenDecoder.decode(this._rangeDecoder,d),j=7>j?8:11);else if(n=m,m=l,l=k,f=2+this._lenDecoder.decode(this._rangeDecoder,d),j=7>j?7:10,h=this._posSlotDecoder[5>=f?f-2:3].decode(this._rangeDecoder),h>=4){if(i=(h>>1)-1,k=(2|1&h)<<i,14>h)k+=LZMA.reverseDecode2(this._posDecoders,k-h-1,this._rangeDecoder,i);else if(k+=this._rangeDecoder.decodeDirectBits(i-4)<<4,k+=this._posAlignDecoder.reverseDecode(this._rangeDecoder),0>k){if(-1===k)break;return!1}}else k=h;if(k>=o||k>=this._dictionarySizeCheck)return!1;this._outWindow.copyBlock(k,f),o+=f,p=this._outWindow.getByte(0)}return this._outWindow.flush(),this._outWindow.releaseStream(),this._rangeDecoder.releaseStream(),!0},LZMA.Decoder.prototype.setDecoderProperties=function(a){var b,c,d,e,f;return a.size<5?!1:(b=a.readByte(),c=b%9,b=~~(b/9),d=b%5,e=~~(b/5),this.setLcLpPb(c,d,e)?(f=a.readByte(),f|=a.readByte()<<8,f|=a.readByte()<<16,f+=16777216*a.readByte(),this.setDictionarySize(f)):!1)},LZMA.decompress=function(a,b,c,d){var e=new LZMA.Decoder;if(!e.setDecoderProperties(a))throw"Incorrect stream properties";if(!e.decode(b,c,d))throw"Error in data stream";return!0},LZMA.decompressFile=function(a,b){var c,d=new LZMA.Decoder;if(!d.setDecoderProperties(a))throw"Incorrect stream properties";if(c=a.readByte(),c|=a.readByte()<<8,c|=a.readByte()<<16,c+=16777216*a.readByte(),a.readByte(),a.readByte(),a.readByte(),a.readByte(),!d.decode(a,b,c))throw"Error in data stream";return!0},SEA3D.File.LZMAUncompress=function(a){a=new Uint8Array(a);var b={data:a,position:0,readByte:function(){return this.data[this.position++]}},c={data:[],position:0,writeByte:function(a){this.data[this.position++]=a}};return LZMA.decompressFile(b,c),new Uint8Array(c.data).buffer},SEA3D.File.setDecompressionEngine(2,"lzma",SEA3D.File.LZMAUncompress);